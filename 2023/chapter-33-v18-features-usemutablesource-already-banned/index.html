<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>ç¬¬33ç« â€”V18ç‰¹æ€§ç¯‡-useMutableSourceï¼ˆå·²è¢«å–ç¼”ï¼‰ | æ˜é‡‘å°å†Œ</title><link rel="stylesheet" type="text/css" href="/book/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/book/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/book/favicon.ico"><link rel="apple-touch-icon" href="/book/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/book/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/book/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ç¬¬33ç« â€”V18ç‰¹æ€§ç¯‡-useMutableSourceï¼ˆå·²è¢«å–ç¼”ï¼‰</h1><a id="logo" href="/book/.">æ˜é‡‘å°å†Œ</a><p class="description">å­¦æµ·æ— æ¶¯ï¼Œå…±åŒè¿›æ­¥ï¼</p></div><div id="nav-menu"><a class="current" href="/book/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/book/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/book/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/book/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a><a href="/book/guestbook/"><i class="fa fa-comments"> ç•™è¨€</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ç¬¬33ç« â€”V18ç‰¹æ€§ç¯‡-useMutableSourceï¼ˆå·²è¢«å–ç¼”ï¼‰</h1><div class="post-meta">2023-09-26<span> | </span><span class="category"><a href="/book/categories/%E9%BB%98%E8%AE%A4/">é»˜è®¤</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 3.6k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 14</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%89%8D%E8%A8%80"><span class="toc-text">ä¸€ å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-text">äºŒ åŠŸèƒ½ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-text">åˆ›å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#api%E4%BB%8B%E7%BB%8D"><span class="toc-text">apiä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E4%B8%80"><span class="toc-text">ä¾‹å­ä¸€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E4%BA%8C"><span class="toc-text">ä¾‹å­äºŒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E5%AE%9E%E8%B7%B5"><span class="toc-text">ä¸‰ å®è·µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-text">å›› åŸç†åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-createMutableSource"><span class="toc-text">1 createMutableSource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-useMutableSource"><span class="toc-text">2 useMutableSource</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E6%80%BB%E7%BB%93"><span class="toc-text">äº” æ€»ç»“</span></a></li></ol></div></div><div class="post-content"><h2 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="headerlink" title="ä¸€ å‰è¨€"></a>ä¸€ å‰è¨€</h2><p><code>useMutableSource</code> æœ€æ—©çš„ <a target="_blank" rel="noopener" href="https://github.com/reactjs/rfcs/blob/main/text/0147-use-mutable-source.md">RFC</a> ææ¡ˆåœ¨ 2020å¹´ 2 æœˆä»½å°±å¼€å§‹äº†ã€‚åœ¨ React 18 ä¸­å®ƒå°†ä½œä¸ºæ–°ç‰¹æ€§å‡ºç°ã€‚ç”¨ä¸€æ®µææ¡ˆä¸­çš„æè¿°æ¥æ¦‚æ‹¬ <code>useMutableSource</code>ã€‚</p>
<blockquote>
<p>useMutableSource èƒ½å¤Ÿè®© React ç»„ä»¶åœ¨ Concurrent Mode æ¨¡å¼ä¸‹å®‰å…¨åœ°æœ‰æ•ˆåœ°è¯»å–å¤–æ¥æ•°æ®æºï¼Œåœ¨ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­èƒ½å¤Ÿæ£€æµ‹åˆ°å˜åŒ–ï¼Œå¹¶ä¸”åœ¨æ•°æ®æºå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè°ƒåº¦æ›´æ–°ã€‚</p>
</blockquote>
<p>è¯´èµ·å¤–éƒ¨æ•°æ®æºå°±è¦ä» state å’Œæ›´æ–°è¯´èµ· ï¼Œæ— è®ºæ˜¯ React è¿˜æ˜¯ Vue è¿™ç§ä¼ ç»Ÿ UI æ¡†æ¶ä¸­ï¼Œè™½ç„¶å®ƒä»¬éƒ½é‡‡ç”¨è™šæ‹Ÿ DOM æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èƒ½å¤ŸæŠŠæ›´æ–°å•å…ƒå§”æ‰˜åˆ°è™šæ‹Ÿ DOM èº«ä¸Šæ¥ï¼Œæ‰€ä»¥æ›´æ–°çš„æœ€å°ç²’åº¦è¿˜æ˜¯åœ¨ç»„ä»¶å±‚é¢ä¸Šï¼Œç”±ç»„ä»¶ç»Ÿä¸€ç®¡ç†æ•°æ® stateï¼Œå¹¶å‚ä¸è°ƒåº¦æ›´æ–°ã€‚</p>
<p>å›åˆ°æˆ‘ä»¬çš„ä¸»è§’ React ä¸Šï¼Œæ—¢ç„¶ç”±ç»„ä»¶ component ç®¡æ§ç€çŠ¶æ€ stateã€‚é‚£ä¹ˆåœ¨ v17 å’Œä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒReact æƒ³è¦è§†å›¾ä¸Šçš„æ›´æ–°ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡æ›´æ”¹å†…éƒ¨æ•°æ® state ã€‚çºµè§ˆ React çš„å‡ ç§æ›´æ–°æ–¹å¼ï¼Œæ— ä¸€ç¦»ä¸å¼€è‡ªèº« state ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹ React çš„å‡ ç§æ›´æ–°æ¨¡å¼ã€‚</p>
<ul>
<li>ç»„ä»¶æœ¬èº«æ”¹å˜ state ã€‚å‡½æ•° <code>useState</code> | <code>useReducer</code> ï¼Œç±»ç»„ä»¶ <code>setState</code> | <code>forceUpdate</code> ã€‚</li>
<li><code>props</code> æ”¹å˜ï¼Œç”±ç»„ä»¶æ›´æ–°å¸¦æ¥çš„å­ç»„ä»¶çš„æ›´æ–°ã€‚</li>
<li><code>context</code> æ›´æ–°ï¼Œå¹¶ä¸”è¯¥ç»„ä»¶æ¶ˆè´¹äº†å½“å‰ <code>context</code> ã€‚</li>
</ul>
<p>æ— è®ºæ˜¯ä¸Šé¢å“ªç§æ–¹å¼ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ state çš„å˜åŒ–ã€‚</p>
<ul>
<li><code>props</code> æ”¹å˜æ¥æºäºçˆ¶çº§ç»„ä»¶çš„ <code>state</code> å˜åŒ–ã€‚</li>
<li><code>context</code> å˜åŒ–æ¥æºäº Provider ä¸­ value å˜åŒ–ï¼Œè€Œ value ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿæ˜¯ state æˆ–è€…æ˜¯ state è¡ç”Ÿäº§ç‰©ã€‚</li>
</ul>
<p>ä»ä¸Šé¢å¯ä»¥æ¦‚æ‹¬å‡ºï¼šstateå’Œè§†å›¾æ›´æ–°çš„å…³ç³» <code>Model</code> &#x3D;&gt; <code>View</code> ã€‚ä½†æ˜¯ state ä»…é™äºç»„ä»¶å†…éƒ¨çš„æ•°æ®ï¼Œå¦‚æœ state æ¥æºäºå¤–éƒ¨ï¼ˆè„±ç¦»ç»„ä»¶å±‚é¢ï¼‰ã€‚é‚£ä¹ˆå¦‚ä½•å®Œæˆå¤–éƒ¨æ•°æ®æºè½¬æ¢æˆå†…éƒ¨çŠ¶æ€ï¼Œ å¹¶ä¸”æ•°æ®æºå˜åŒ–ï¼Œç»„ä»¶é‡æ–° render å‘¢ï¼Ÿ</p>
<p>å¸¸è§„æ¨¡å¼ä¸‹ï¼Œå…ˆæŠŠå¤–éƒ¨æ•°æ® external Data é€šè¿‡ selector é€‰æ‹©å™¨æŠŠç»„ä»¶éœ€è¦çš„æ•°æ®æ˜ å°„åˆ° state | props ä¸Šã€‚è¿™ç®—æ˜¯å®Œæˆäº†ä¸€æ­¥ï¼Œæ¥ä¸‹æ¥è¿˜éœ€è¦ subscribe è®¢é˜…å¤–éƒ¨æ•°æ®æºçš„å˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¿˜éœ€è¦è‡ªèº«å»å¼ºåˆ¶æ›´æ–° forceUpdate ã€‚ä¸‹é¢ä¸¤å¹…å›¾è¡¨ç¤ºæ•°æ®æ³¨å…¥å’Œæ•°æ®è®¢é˜…æ›´æ–°ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261730310.jpeg" alt="1.jpg"></p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261730896.jpeg" alt="2.jpg"></p>
<p>å…¸å‹çš„å¤–éƒ¨æ•°æ®æºå°±æ˜¯ redux ä¸­çš„ store ï¼Œredux æ˜¯å¦‚ä½•æŠŠ Store ä¸­çš„ state ï¼Œå®‰å…¨çš„å˜æˆç»„ä»¶çš„ state çš„ã€‚ </p>
<p>æˆ–è®¸æˆ‘å¯ä»¥ç”¨ä¸€æ®µä»£ç æ¥è¡¨ç¤ºä» react-redux ä¸­ state æ”¹å˜åˆ°è§†å›¾æ›´æ–°çš„æµç¨‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer,initState)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">&#123; selector &#125;</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [ state , setReduxState ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(&#123;&#125;)</span><br><span class="line">    <span class="keyword">const</span> contextValue = <span class="title function_">useMemo</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">/* è®¢é˜… store å˜åŒ– */</span></span><br><span class="line">        store.<span class="title function_">subscribe</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">             <span class="comment">/* ç”¨é€‰æ‹©å™¨é€‰æ‹©è®¢é˜… state */</span></span><br><span class="line">             <span class="keyword">const</span> value = <span class="title function_">selector</span>(data.<span class="title function_">getState</span>())</span><br><span class="line">             <span class="comment">/* å¦‚æœå‘ç”Ÿå˜åŒ–  */</span></span><br><span class="line">             <span class="keyword">if</span>(<span class="title function_">ifHasChange</span>(state,value))&#123;</span><br><span class="line">                 <span class="title function_">setReduxState</span>(value)</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,[ store ])    </span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä¾‹å­ä¸­ä»£ç ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ï¼Œä¹Ÿä¸æ˜¯æºä»£ç ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯è®©å¤§å®¶æ¸…æ™°åœ°äº†è§£æµç¨‹ã€‚redux å’Œ react æœ¬è´¨ä¸Šæ˜¯è¿™æ ·å·¥ä½œçš„ã€‚</p>
<ul>
<li>é€šè¿‡ store.subscribe æ¥è®¢é˜… state å˜åŒ–ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šè¦æ¯”ä»£ç ç‰‡æ®µä¸­å¤æ‚çš„å¤šï¼Œé€šè¿‡ selector ï¼ˆé€‰æ‹©å™¨ï¼‰æ‰¾åˆ°ç»„ä»¶éœ€è¦çš„ stateã€‚ æˆ‘åœ¨è¿™é‡Œå…ˆè§£é‡Šä¸€ä¸‹<strong>selector</strong>ï¼Œå› ä¸ºåœ¨ä¸šåŠ¡ç»„ä»¶å¾€å¾€ä¸éœ€è¦æ•´ä¸ª store ä¸­çš„ state å…¨éƒ¨æ•°æ®ï¼Œè€Œæ˜¯ä»…ä»…éœ€è¦ä¸‹é¢çš„éƒ¨åˆ†çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä» state ä¸­é€‰æ‹©â€˜æœ‰ç”¨çš„â€™ï¼Œå¹¶ä¸”å’Œ props åˆå¹¶ï¼Œç»†å¿ƒçš„åŒå­¦åº”è¯¥å‘ç°ï¼Œé€‰æ‹©å™¨éœ€è¦å’Œ <code>react-redux</code> ä¸­ connect ç¬¬ä¸€å‚æ•° mapStateToProps è”åŠ¨ã€‚å¯¹äºç»†èŠ‚ï¼Œæ— å…³ç´§è¦ï¼Œå› ä¸ºä»Šå¤©é‡ç‚¹æ˜¯ <code>useMutableSource</code>ã€‚</li>
</ul>
<p>å¦‚ä¸Šæ˜¯æ²¡æœ‰ <code>useMutableSource</code> çš„æƒ…å†µï¼Œç°åœ¨ç”¨ useMutableSource ä¸åœ¨éœ€è¦æŠŠè®¢é˜…åˆ°æ›´æ–°æµç¨‹äº¤ç»™ç»„ä»¶å¤„ç†ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åˆ›å»º store */</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer,initState)</span><br><span class="line"><span class="comment">/* åˆ›å»ºå¤–éƒ¨æ•°æ®æº */</span></span><br><span class="line"><span class="keyword">const</span> externalDataSource = <span class="title function_">createMutableSource</span>( store ,store.<span class="title function_">getState</span>() )</span><br><span class="line"><span class="comment">/* è®¢é˜…æ›´æ–° */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params">store, callback</span>) =&gt; store.<span class="title function_">subscribe</span>(callback);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">&#123; selector &#125;</span>)&#123;</span><br><span class="line">    <span class="comment">/* è®¢é˜…çš„ state å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç»„ä»¶ä¼šæ›´æ–° */</span></span><br><span class="line">    <span class="keyword">const</span> state = <span class="title function_">useMutableSource</span>(externalDataSource,selector,subscribe)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡ createMutableSource åˆ›å»ºå¤–éƒ¨æ•°æ®æºï¼Œé€šè¿‡ useMutableSource æ¥ä½¿ç”¨å¤–éƒ¨æ•°æ®æºã€‚å¤–éƒ¨æ•°æ®æºå˜åŒ–ï¼Œç»„ä»¶è‡ªåŠ¨æ¸²æŸ“ã€‚</li>
</ul>
<p>å¦‚ä¸Šæ˜¯é€šè¿‡ useMutableSource å®ç°çš„è®¢é˜…æ›´æ–°ï¼Œè¿™æ ·å‡å°‘äº† APP å†…éƒ¨ç»„ä»¶ä»£ç ï¼Œä»£ç å¥å£®æ€§æå‡ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿé™ä½äº†è€¦åˆã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬å…¨æ–¹é¢è®¤è¯†ä¸€ä¸‹è¿™ä¸ª V18 çš„æ–°ç‰¹æ€§ã€‚</p>
<h2 id="äºŒ-åŠŸèƒ½ä»‹ç»"><a href="#äºŒ-åŠŸèƒ½ä»‹ç»" class="headerlink" title="äºŒ åŠŸèƒ½ä»‹ç»"></a>äºŒ åŠŸèƒ½ä»‹ç»</h2><p>å…·ä½“åŠŸèƒ½ä»‹ç»æµç¨‹è¿˜æ˜¯å‚è€ƒæœ€æ–°çš„ RFCï¼Œ createMutableSource å’Œ useMutableSource åœ¨ä¸€å®šçš„ç¨‹åº¦ä¸Šï¼Œæœ‰ç‚¹åƒ <code>createContext</code> å’Œ <code>useContext</code> ï¼Œè§åçŸ¥æ„ï¼Œå°±æ˜¯<strong>åˆ›å»º</strong>ä¸<strong>ä½¿ç”¨</strong>ã€‚ä¸åŒçš„æ˜¯ context éœ€è¦ <code>Provider</code> å»æ³¨å…¥å†…éƒ¨çŠ¶æ€ï¼Œè€Œä»Šå¤©çš„ä¸»è§’æ˜¯æ³¨å…¥å¤–éƒ¨çŠ¶æ€ã€‚é‚£ä¹ˆé¦–å…ˆåº”è¯¥çœ‹ä¸€ä¸‹ä¸¤è€…å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><p>createMutableSource åˆ›å»ºä¸€ä¸ªæ•°æ®æºã€‚å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> externalDataSource = <span class="title function_">createMutableSource</span>( store ,store.<span class="title function_">getState</span>() ) </span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå°±æ˜¯å¤–éƒ¨çš„æ•°æ®æºï¼Œæ¯”å¦‚ redux ä¸­çš„ store,</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼šä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºæ•°æ®æºçš„ç‰ˆæœ¬å·ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„âš ï¸çš„æ˜¯ï¼Œè¦ä¿æŒæ•°æ®æºå’Œæ•°æ®ç‰ˆæœ¬å·çš„ä¸€è‡´æ€§ï¼Œå°±æ˜¯æ•°æ®æºå˜åŒ–äº†ï¼Œé‚£ä¹ˆæ•°æ®ç‰ˆæœ¬å·å°±è¦å˜åŒ–ï¼Œä¸€å®šç¨‹åº¦ä¸Šéµå¾ª <code>immutable</code> åŸåˆ™ï¼ˆä¸å¯å˜æ€§ï¼‰ã€‚å¯ä»¥ç†è§£ä¸ºæ•°æ®ç‰ˆæœ¬å·æ˜¯è¯æ˜æ•°æ®æºå”¯ä¸€æ€§çš„æ ‡ç¤ºã€‚</li>
</ul>
<h3 id="apiä»‹ç»"><a href="#apiä»‹ç»" class="headerlink" title="apiä»‹ç»"></a>apiä»‹ç»</h3><p>useMutableSource å¯ä»¥ä½¿ç”¨éä¼ ç»Ÿçš„æ•°æ®æºã€‚å®ƒçš„åŠŸèƒ½å’Œ Context API  è¿˜æœ‰ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/use-subscription">useSubscription</a> ç±»ä¼¼ã€‚ï¼ˆæ²¡æœ‰ä½¿ç”¨è¿‡ useSubscription çš„åŒå­¦ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹ ï¼‰ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹ useMutableSource çš„åŸºæœ¬ä½¿ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title function_">useMutableSource</span>(source,getSnapShot,subscribe)</span><br></pre></td></tr></table></figure>
<p>useMutableSource æ˜¯ä¸€ä¸ª hooks ï¼Œå®ƒæœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><code>sourceï¼šMutableSource &lt; Source &gt;</code> å¯ä»¥ç†è§£ä¸ºå¸¦è®°å¿†çš„æ•°æ®æºå¯¹è±¡ã€‚</li>
<li><code>getSnapshotï¼š( source : Source ) =&gt; Snapshot</code> ï¼šä¸€ä¸ªå‡½æ•°ï¼Œæ•°æ®æºä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œè·å–å¿«ç…§ä¿¡æ¯ï¼Œå¯ä»¥ç†è§£ä¸º <code>selector</code> ï¼ŒæŠŠå¤–éƒ¨çš„æ•°æ®æºçš„æ•°æ®è¿‡æ»¤ï¼Œæ‰¾å‡ºæƒ³è¦çš„æ•°æ®æºã€‚</li>
<li><code>subscribe: (source: Source, callback: () =&gt; void) =&gt; () =&gt; void</code>ï¼šè®¢é˜…å‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼ŒSource å¯ä»¥ç†è§£ä¸º useMutableSource ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œcallback å¯ä»¥ç†è§£ä¸º useMutableSource ç¬¬äºŒä¸ªå‚æ•°ï¼Œå½“æ•°æ®æºå˜åŒ–çš„æ—¶å€™ï¼Œæ‰§è¡Œå¿«ç…§ï¼Œè·å–æ–°çš„æ•°æ®ã€‚</li>
</ul>
<p><strong>useMutableSource ç‰¹ç‚¹</strong></p>
<p>useMutableSource å’Œ useSubscription åŠŸèƒ½ç±»ä¼¼ï¼š</p>
<ul>
<li>ä¸¤è€…éƒ½éœ€è¦å¸¦æœ‰è®°å¿†åŒ–çš„â€˜é…ç½®åŒ–å¯¹è±¡â€™ï¼Œä»è€Œä»å¤–éƒ¨å–å€¼ã€‚</li>
<li>ä¸¤è€…éƒ½éœ€è¦ä¸€ç§è®¢é˜…å’Œå–æ¶ˆè®¢é˜…æºçš„æ–¹æ³• <code>subscribe</code>ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤– useMutableSource è¿˜æœ‰ä¸€äº›ç‰¹ç‚¹ï¼š</p>
<ul>
<li>useMutableSource éœ€è¦æºä½œä¸ºæ˜¾å¼å‚æ•°ã€‚ä¹Ÿå°±æ˜¯éœ€è¦æŠŠæ•°æ®æºå¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ã€‚</li>
<li>useMutableSource ç”¨ getSnapshot è¯»å–çš„æ•°æ®ï¼Œæ˜¯ä¸å¯å˜çš„ã€‚</li>
</ul>
<p><strong>å…³äº MutableSource ç‰ˆæœ¬å·</strong> <br/><br><code>useMutableSource</code> ä¼šè¿½è¸ª MutableSource çš„ç‰ˆæœ¬å·ï¼Œç„¶åè¯»å–æ•°æ®ï¼Œæ‰€ä»¥å¦‚æœä¸¤è€…ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šé€ æˆè¯»å–å¼‚å¸¸çš„æƒ…å†µã€‚useMutableSource ä¼šæ£€æŸ¥ç‰ˆæœ¬å·ï¼š</p>
<ul>
<li>åœ¨ç¬¬ä¸€æ¬¡ç»„ä»¶æŒ‚è½½çš„æ—¶å€™ï¼Œè¯»å–ç‰ˆæœ¬å·ã€‚</li>
<li>åœ¨ç»„ä»¶ rerender çš„æ—¶å€™ï¼Œç¡®ä¿ç‰ˆæœ¬å·ä¸€è‡´ï¼Œç„¶ååœ¨è¯»å–æ•°æ®ã€‚ä¸ç„¶ä¼šé€ æˆé”™è¯¯å‘ç”Ÿã€‚</li>
<li>ç¡®ä¿æ•°æ®æºå’Œç‰ˆæœ¬å·çš„ä¸€è‡´æ€§ã€‚</li>
</ul>
<p><strong>è®¾è®¡è§„èŒƒ</strong></p>
<p>å½“é€šè¿‡ getSnapshot è¯»å–å¤–éƒ¨æ•°æ®æºçš„æ—¶å€™ï¼Œè¿”å›çš„ value åº”è¯¥æ˜¯ä¸å¯å˜çš„ã€‚</p>
<ul>
<li>âœ… æ­£ç¡®å†™æ³•ï¼šgetSnapshot: source &#x3D;&gt; Array.from(source.friendIDs)</li>
<li>âŒ é”™è¯¯å†™æ³•ï¼šgetSnapshot: source &#x3D;&gt; source.friendIDs</li>
</ul>
<p>æ•°æ®æºå¿…é¡»æœ‰ä¸€ä¸ªå…¨å±€çš„ç‰ˆæœ¬å·ï¼Œè¿™ä¸ªç‰ˆæœ¬å·ä»£è¡¨æ•´ä¸ªæ•°æ®æºï¼š</p>
<ul>
<li>âœ… æ­£ç¡®å†™æ³•ï¼šgetVersion: () &#x3D;&gt; source.version</li>
<li>âŒ é”™è¯¯å†™æ³•ï¼šgetVersion: () &#x3D;&gt; source.user.version</li>
</ul>
<p>æ¥ä¸‹æ¥å‚è€ƒ github ä¸Šçš„ä¾‹å­ï¼Œæˆ‘è®²ä¸€ä¸‹å…·ä½“æ€ä¹ˆä½¿ç”¨ï¼š</p>
<h3 id="ä¾‹å­ä¸€"><a href="#ä¾‹å­ä¸€" class="headerlink" title="ä¾‹å­ä¸€"></a>ä¾‹å­ä¸€</h3><p><strong>ä¾‹å­ä¸€ï¼šè®¢é˜… history æ¨¡å¼ä¸‹è·¯ç”±å˜åŒ–</strong></p>
<p>æ¯”å¦‚æœ‰ä¸€ä¸ªåœºæ™¯å°±æ˜¯åœ¨éäººä¸ºæƒ…å†µä¸‹ï¼Œè®¢é˜…è·¯ç”±å˜åŒ–ï¼Œå±•ç¤ºå¯¹åº”çš„ <code>location.pathname</code>ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ useMutableSource å¤„ç†çš„ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¤–éƒ¨æ•°æ®æºå°±æ˜¯ location ä¿¡æ¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ createMutableSource åˆ›å»ºä¸€ä¸ªå¤–éƒ¨æ•°æ®æºã€‚</span></span><br><span class="line"><span class="comment">// æ•°æ®æºå¯¹è±¡ä¸º windowã€‚</span></span><br><span class="line"><span class="comment">// ç”¨ location.href ä½œä¸ºæ•°æ®æºçš„ç‰ˆæœ¬å·ï¼Œhref å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¯´æ˜æ•°æ®æºå‘ç”Ÿå˜åŒ–ã€‚</span></span><br><span class="line"><span class="keyword">const</span> locationSource = <span class="title function_">createMutableSource</span>(</span><br><span class="line">  <span class="variable language_">window</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¿«ç…§ä¿¡æ¯ï¼Œè¿™é‡Œè·å–çš„æ˜¯ location.pathname å­—æ®µï¼Œè¿™ä¸ªæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œå½“è·¯ç”±å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å¿«ç…§å‡½æ•°ï¼Œæ¥å½¢æˆæ–°çš„å¿«ç…§ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getSnapshot</span> = <span class="variable language_">window</span> =&gt; <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…å‡½æ•°ã€‚</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params"><span class="variable language_">window</span>, callback</span>) =&gt; &#123;</span><br><span class="line">   <span class="comment">//é€šè¿‡ popstate ç›‘å¬ history æ¨¡å¼ä¸‹çš„è·¯ç”±å˜åŒ–ï¼Œè·¯ç”±å˜åŒ–çš„æ—¶å€™ï¼Œæ‰§è¡Œå¿«ç…§å‡½æ•°ï¼Œå¾—åˆ°æ–°çš„å¿«ç…§ä¿¡æ¯ã€‚</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;popstate&quot;</span>, callback);</span><br><span class="line">   <span class="comment">//å–æ¶ˆç›‘å¬</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;popstate&quot;</span>, callback);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡ useMutableSourceï¼ŒæŠŠæ•°æ®æºå¯¹è±¡ï¼Œå¿«ç…§å‡½æ•°ï¼Œè®¢é˜…å‡½æ•°ä¼ å…¥ï¼Œå½¢æˆ pathNameã€‚  </span></span><br><span class="line">  <span class="keyword">const</span> pathName = <span class="title function_">useMutableSource</span>(locationSource, getSnapshot, subscribe);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥æç»˜ä¸€ä¸‹æµç¨‹ï¼š</p>
<ul>
<li>é¦–å…ˆé€šè¿‡ <code>createMutableSource</code> åˆ›å»ºä¸€ä¸ªæ•°æ®æºå¯¹è±¡ï¼Œè¯¥æ•°æ®æºå¯¹è±¡ä¸º windowã€‚ ç”¨ location.href ä½œä¸ºæ•°æ®æºçš„ç‰ˆæœ¬å·ï¼Œhref å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¯´æ˜æ•°æ®æºå‘ç”Ÿå˜åŒ–ã€‚ </li>
<li>è·å–å¿«ç…§ä¿¡æ¯ï¼Œè¿™é‡Œè·å–çš„æ˜¯ location.pathname å­—æ®µï¼Œè¿™ä¸ªæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œå½“è·¯ç”±å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å¿«ç…§å‡½æ•°ï¼Œæ¥å½¢æˆæ–°çš„å¿«ç…§ä¿¡æ¯ã€‚</li>
<li>é€šè¿‡ <code>popstate</code> ç›‘å¬ <code>history</code> æ¨¡å¼ä¸‹çš„è·¯ç”±å˜åŒ–ï¼Œè·¯ç”±å˜åŒ–çš„æ—¶å€™ï¼Œæ‰§è¡Œå¿«ç…§å‡½æ•°ï¼Œå¾—åˆ°æ–°çš„å¿«ç…§ä¿¡æ¯ã€‚</li>
<li>é€šè¿‡ <code>useMutableSource</code> ï¼ŒæŠŠæ•°æ®æºå¯¹è±¡ï¼Œå¿«ç…§å‡½æ•°ï¼Œè®¢é˜…å‡½æ•°ä¼ å…¥ï¼Œå½¢æˆ <code>pathName</code> ã€‚</li>
</ul>
<p>å¯èƒ½è¿™ä¸ªä¾‹å­ğŸŒ°ï¼Œä¸è¶³ä»¥è®©ä½ æ¸…æ¥š useMutableSource çš„ä½œç”¨ï¼Œæˆ‘ä»¬å†ä¸¾ä¸€ä¸ªä¾‹å­çœ‹ä¸€ä¸‹ useMutableSource å¦‚ä½•å’Œ redux å¥‘åˆä½¿ç”¨çš„ã€‚</p>
<h3 id="ä¾‹å­äºŒ"><a href="#ä¾‹å­äºŒ" class="headerlink" title="ä¾‹å­äºŒ"></a>ä¾‹å­äºŒ</h3><p><strong>ä¾‹å­äºŒï¼šredux ä¸­ <code>useMutableSource</code> ä½¿ç”¨</strong></p>
<p>redux å¯ä»¥é€šè¿‡ useMutableSource ç¼–å†™è‡ªå®šä¹‰ hooks â€”â€” <code>useSelector</code>ï¼ŒuseSelector å¯ä»¥è¯»å–æ•°æ®æºçš„çŠ¶æ€ï¼Œå½“æ•°æ®æºæ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°æ‰§è¡Œå¿«ç…§è·å–çŠ¶æ€ï¼Œåšåˆ°è®¢é˜…æ›´æ–°ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ useSelector æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mutableSource = <span class="title function_">createMutableSource</span>(</span><br><span class="line">  reduxStore, <span class="comment">// å°† redux çš„ store ä½œä¸ºæ•°æ®æºã€‚</span></span><br><span class="line">  <span class="comment">// state æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥ä½œä¸ºæ•°æ®æºçš„ç‰ˆæœ¬å·</span></span><br><span class="line">  <span class="function">() =&gt;</span> reduxStore.<span class="title function_">getState</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡åˆ›å»º context ä¿å­˜æ•°æ®æº mutableSourceã€‚</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MutableSourceContext</span> = <span class="title function_">createContext</span>(mutableSource);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜… store å˜åŒ–ã€‚store å˜åŒ–ï¼Œæ‰§è¡Œ getSnapshot</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params">store, callback</span>) =&gt; store.<span class="title function_">subscribe</span>(callback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ hooks useSelector å¯ä»¥åœ¨æ¯ä¸€ä¸ª connect å†…éƒ¨ä½¿ç”¨ï¼Œé€šè¿‡ useContext è·å– æ•°æ®æºå¯¹è±¡ã€‚ </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useSelector</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> mutableSource = <span class="title function_">useContext</span>(<span class="title class_">MutableSourceContext</span>);</span><br><span class="line">   <span class="comment">// ç”¨ useCallback è®© getSnapshot å˜æˆæœ‰è®°å¿†çš„ã€‚ </span></span><br><span class="line">  <span class="keyword">const</span> getSnapshot = <span class="title function_">useCallback</span>(<span class="function"><span class="params">store</span> =&gt;</span> <span class="title function_">selector</span>(store.<span class="title function_">getState</span>()), [</span><br><span class="line">    selector</span><br><span class="line">  ]);</span><br><span class="line">   <span class="comment">// æœ€åæœ¬è´¨ä¸Šç”¨çš„æ˜¯ useMutableSource è®¢é˜… state å˜åŒ–ã€‚  </span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMutableSource</span>(mutableSource, getSnapshot, subscribe);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤§è‡´æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>å°† redux çš„ store ä½œä¸ºæ•°æ®æºå¯¹è±¡ <code>mutableSource</code> ã€‚ state æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥ä½œä¸ºæ•°æ®æºçš„ç‰ˆæœ¬å·ã€‚</li>
<li>é€šè¿‡åˆ›å»º context ä¿å­˜æ•°æ®æºå¯¹è±¡ <code>mutableSource</code>ã€‚</li>
<li>å£°æ˜è®¢é˜…å‡½æ•°ï¼Œè®¢é˜… store å˜åŒ–ã€‚store å˜åŒ–ï¼Œæ‰§è¡Œ <code>getSnapshot</code> ã€‚</li>
<li>è‡ªå®šä¹‰ hooks <code>useSelector</code> å¯ä»¥åœ¨æ¯ä¸€ä¸ª connect å†…éƒ¨ä½¿ç”¨ï¼Œé€šè¿‡ useContext è·å– æ•°æ®æºå¯¹è±¡ã€‚ ç”¨ <code>useCallback</code> è®© getSnapshot å˜æˆæœ‰è®°å¿†çš„ã€‚ </li>
<li>æœ€åæœ¬è´¨ä¸Šç”¨çš„æ˜¯ useMutableSource è®¢é˜…å¤–éƒ¨ state å˜åŒ–ã€‚</li>
</ul>
<p><strong>æ³¨æ„é—®é¢˜</strong> <br/></p>
<ul>
<li>åœ¨åˆ›å»º getSnapshot çš„æ—¶å€™ï¼Œéœ€è¦å°† getSnapshot è®°å¿†åŒ–å¤„ç†ï¼Œå°±åƒä¸Šè¿°æµç¨‹ä¸­çš„ useCallback å¤„ç† getSnapshot ä¸€æ ·ï¼Œå¦‚æœä¸è®°å¿†å¤„ç†ï¼Œé‚£ä¹ˆä¼šè®©ç»„ä»¶é¢‘ç¹æ¸²æŸ“ã€‚</li>
<li>åœ¨æœ€æ–°çš„ react-redux æºç ä¸­ï¼Œå·²ç»ä½¿ç”¨æ–°çš„ apiï¼Œè®¢é˜…å¤–éƒ¨æ•°æ®æºï¼Œä¸è¿‡ä¸æ˜¯ <code>useMutableSource</code> è€Œæ˜¯ <code>useSyncExternalStore</code>ï¼Œå…·ä½“å› ä¸º <code>useMutableSource</code> æ²¡æœ‰æä¾›å†…ç½®çš„ selectorAPIï¼Œéœ€è¦æ¯ä¸€æ¬¡å½“é€‰æ‹©å™¨å˜åŒ–æ—¶å€™é‡æ–°è®¢é˜… storeï¼Œå¦‚æœæ²¡æœ‰ useCallback ç­‰ api è®°å¿†åŒ–å¤„ç†ï¼Œé‚£ä¹ˆå°†é‡æ–°è®¢é˜…ã€‚å…·ä½“å†…å®¹è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/reactwg/react-18/discussions/86">useMutableSource â†’ useSyncExternalStore</a>ã€‚</li>
</ul>
<h2 id="ä¸‰-å®è·µ"><a href="#ä¸‰-å®è·µ" class="headerlink" title="ä¸‰ å®è·µ"></a>ä¸‰ å®è·µ</h2><p>æ¥ä¸‹æ¥æˆ‘ç”¨ä¸€ä¸ªä¾‹å­æ¥å…·ä½“å®è·µä¸€ä¸‹ <code>createMutableSource</code>ï¼Œè®©å¤§å®¶æ›´æ¸…æ™°æµç¨‹ã€‚</p>
<p>è¿™é‡Œè¿˜æ˜¯é‡‡ç”¨ redux å’Œ createMutableSource å®ç°å¤–éƒ¨æ•°æ®æºçš„å¼•ç”¨ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>18.0.0-alpha</code> ç‰ˆæœ¬çš„ <code>react</code> å’Œ <code>react-dom</code> ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261730909.jpeg" alt="3.jpg"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  <span class="title class_">React</span> , &#123;</span><br><span class="line">    unstable_useMutableSource <span class="keyword">as</span> useMutableSource,</span><br><span class="line">    unstable_createMutableSource <span class="keyword">as</span> createMutableSource</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers , createStore  &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* number Reducer */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">numberReducer</span>(<span class="params">state=<span class="number">1</span>,action</span>)&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.<span class="property">type</span>)&#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;ADD&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;DEL&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> state - <span class="number">1</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* æ³¨å†Œreducer */</span></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="title function_">combineReducers</span>(&#123; <span class="attr">number</span>:numberReducer  &#125;)</span><br><span class="line"><span class="comment">/* åˆæˆStore */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Store</span> = <span class="title function_">createStore</span>(rootReducer,&#123; <span class="attr">number</span>: <span class="number">1</span>  &#125;)</span><br><span class="line"><span class="comment">/* æ³¨å†Œå¤–éƒ¨æ•°æ®æº */</span></span><br><span class="line"><span class="keyword">const</span> dataSource = <span class="title function_">createMutableSource</span>( <span class="title class_">Store</span> ,<span class="function">() =&gt;</span> <span class="number">1</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è®¢é˜…å¤–éƒ¨æ•°æ®æº */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params">dataSource,callback</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> unSubScribe = dataSource.<span class="title function_">subscribe</span>(callback)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">unSubScribe</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* <span class="doctag">TODO:</span> æƒ…å†µä¸€ */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">/* è·å–æ•°æ®å¿«ç…§ */</span></span><br><span class="line">     <span class="keyword">const</span> shotSnop = <span class="title class_">React</span>.<span class="title function_">useCallback</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;...data.<span class="title function_">getState</span>()&#125;),[])</span><br><span class="line">    <span class="comment">/*  hooks:ä½¿ç”¨ */</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">useMutableSource</span>(dataSource,shotSnop,subscribe)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span> æ‹¥æŠ± React 18 ğŸ‰ğŸ‰ğŸ‰ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        èµï¼š&#123;data.number&#125; <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>Store.dispatch(&#123; type:&#x27;ADD&#x27; &#125;)&#125; &gt;ç‚¹èµ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€éƒ¨åˆ†ç”¨ <code>combineReducers</code> å’Œ <code>createStore</code> åˆ›å»º redux Store çš„è¿‡ç¨‹ã€‚<br/><br>é‡ç‚¹æ˜¯ç¬¬äºŒéƒ¨åˆ†ï¼š</p>
<ul>
<li>é¦–å…ˆé€šè¿‡ createMutableSource åˆ›å»ºæ•°æ®æºï¼ŒStore ä¸ºæ•°æ®æºï¼Œ<code>data.getState()</code> ä½œä¸ºç‰ˆæœ¬å·ã€‚</li>
<li>ç¬¬äºŒç‚¹å°±æ˜¯å¿«ç…§ä¿¡æ¯ï¼Œè¿™é‡Œçš„å¿«ç…§å°±æ˜¯ store ä¸­çš„ stateã€‚æ‰€ä»¥åœ¨ <code>shotSnop</code> è¿˜æ˜¯é€šè¿‡ getState è·å–çŠ¶æ€ï¼Œæ­£å¸¸æƒ…å†µä¸‹ shotSnop åº”è¯¥ä½œä¸º <code>Selector</code>ï¼Œè¿™é‡ŒæŠŠæ‰€æœ‰çš„ state éƒ½æ˜ å°„å‡ºæ¥äº†ã€‚</li>
<li>ç¬¬ä¸‰å°±æ˜¯é€šè¿‡ <code>useMutableSource</code> æŠŠæ•°æ®æºï¼Œå¿«ç…§ï¼Œè®¢é˜…å‡½æ•°ä¼ å…¥ï¼Œå¾—åˆ°çš„ data å°±æ˜¯å¼•ç”¨çš„å¤–éƒ¨æ•°æ®æºäº†ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261730381.gif" alt="4.gif"></p>
<h2 id="å››-åŸç†åˆ†æ"><a href="#å››-åŸç†åˆ†æ" class="headerlink" title="å›› åŸç†åˆ†æ"></a>å›› åŸç†åˆ†æ</h2><p>useMutableSource å·²ç»åœ¨ React v18 çš„è§„åˆ’ä¹‹ä¸­äº†ï¼Œé‚£ä¹ˆå®ƒçš„å®ç°åŸç†ä»¥åŠç»†èŠ‚ï¼Œåœ¨ V18 æ­£å¼æ¨å‡ºä¹‹å‰å¯ä»¥è¿˜ä¼šæœ‰è°ƒæ•´ï¼Œ</p>
<h3 id="1-createMutableSource"><a href="#1-createMutableSource" class="headerlink" title="1 createMutableSource"></a>1 createMutableSource</h3><blockquote>
<p>react&#x2F;src&#x2F;ReactMutableSource.js -&gt; createMutableSource</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMutableSource</span>(<span class="params">source,getVersion</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> mutableSource = &#123;</span><br><span class="line">        <span class="attr">_getVersion</span>: getVersion,</span><br><span class="line">        <span class="attr">_source</span>: source,</span><br><span class="line">        <span class="attr">_workInProgressVersionPrimary</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">_workInProgressVersionSecondary</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> mutableSource</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>createMutableSource çš„åŸç†éå¸¸ç®€å•ï¼Œå’Œ <code>createContext</code> ï¼Œ <code>createRef</code> ç±»ä¼¼ï¼Œ å°±æ˜¯åˆ›å»ºä¸€ä¸ª <code>createMutableSource</code> å¯¹è±¡ï¼Œ</p>
<h3 id="2-useMutableSource"><a href="#2-useMutableSource" class="headerlink" title="2 useMutableSource"></a>2 useMutableSource</h3><p>å¯¹äº useMutableSource åŸç†ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç„ä¹ï¼ŒåŸæ¥æ˜¯ç”±å¼€å‘è€…è‡ªå·±æŠŠå¤–éƒ¨æ•°æ®æºæ³¨å…¥åˆ° state ä¸­ï¼Œç„¶åå†™è®¢é˜…å‡½æ•°ã€‚ useMutableSource çš„åŸç†å°±æ˜¯æŠŠå¼€å‘è€…è¯¥åšçš„äº‹ï¼Œè‡ªå·±åšäº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ï¼Œè¿™æ ·çœç€å¼€å‘è€…å»å†™ç›¸å…³çš„ä»£ç äº†ã€‚æœ¬è´¨ä¸Šå°±æ˜¯ <strong>useState + useEffect</strong> ï¼š</p>
<ul>
<li>useState è´Ÿè´£æ›´æ–°ã€‚</li>
<li>useEffect è´Ÿè´£è®¢é˜…ã€‚</li>
</ul>
<p>ç„¶åæ¥çœ‹ä¸€ä¸‹åŸç†ã€‚</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberHooks.new.js -&gt; useMutableSource</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useMutableSource</span>(<span class="params">hook,source,getSnapshot</span>)&#123;</span><br><span class="line">    <span class="comment">/* è·å–ç‰ˆæœ¬å· */</span></span><br><span class="line">    <span class="keyword">const</span> getVersion = source.<span class="property">_getVersion</span>;</span><br><span class="line">    <span class="keyword">const</span> version = <span class="title function_">getVersion</span>(source.<span class="property">_source</span>);</span><br><span class="line">    <span class="comment">/* ç”¨ useState ä¿å­˜å½“å‰ Snapshotï¼Œè§¦å‘æ›´æ–°ã€‚ */</span></span><br><span class="line">    <span class="keyword">let</span> [currentSnapshot, setSnapshot] = dispatcher.<span class="title function_">useState</span>(<span class="function">() =&gt;</span></span><br><span class="line">       <span class="title function_">readFromUnsubscribedMutableSource</span>(root, source, getSnapshot),</span><br><span class="line">    );</span><br><span class="line">    dispatcher.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/* åŒ…è£…å‡½æ•°  */</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            <span class="comment">/* è§¦å‘æ›´æ–° */</span></span><br><span class="line">            <span class="title function_">setSnapshot</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* è®¢é˜…æ›´æ–° */</span></span><br><span class="line">        <span class="keyword">const</span> unsubscribe = <span class="title function_">subscribe</span>(source.<span class="property">_source</span>, handleChange);</span><br><span class="line">        <span class="comment">/* å–æ¶ˆè®¢é˜… */</span></span><br><span class="line">        <span class="keyword">return</span> unsubscribe;</span><br><span class="line">    &#125;,[source, subscribe])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­ä¿ç•™äº†æœ€æ ¸å¿ƒçš„é€»è¾‘ï¼š</p>
<ul>
<li>é¦–å…ˆé€šè¿‡ <code>getVersion</code> è·å–æ•°æ®æºç‰ˆæœ¬å·ï¼Œç”¨ <strong><code>useState</code></strong> ä¿å­˜å½“å‰ Snapshotï¼ŒsetSnapshot ç”¨äºè§¦å‘æ›´æ–°ã€‚</li>
<li>åœ¨ <strong><code>useEffect</code></strong> ä¸­ï¼Œè¿›è¡Œè®¢é˜…ï¼Œç»‘å®šçš„æ˜¯åŒ…è£…å¥½çš„ handleChange å‡½æ•°ï¼Œé‡Œé¢è°ƒç”¨ setSnapshot çœŸæ­£çš„æ›´æ–°ç»„ä»¶ã€‚</li>
<li>æ‰€ä»¥ useMutableSource æœ¬è´¨ä¸Šè¿˜æ˜¯ useState ã€‚</li>
</ul>
<h2 id="äº”-æ€»ç»“"><a href="#äº”-æ€»ç»“" class="headerlink" title="äº” æ€»ç»“"></a>äº” æ€»ç»“</h2><p>ä»Šå¤©è®²äº† useMutableSource çš„èƒŒæ™¯ï¼Œç”¨æ³•ï¼Œä»¥åŠåŸç†ã€‚å¸Œæœ›é˜…è¯»çš„åŒå­¦å¯ä»¥å…‹éš†ä¸€ä¸‹ React v18 çš„æ–°ç‰ˆæœ¬ï¼Œå°è¯•ä¸€ä¸‹æ–°ç‰¹æ€§ï¼Œå°†å¯¹ç†è§£ useMutableSource å¾ˆæœ‰å¸®åŠ©ã€‚ä¸‹ä¸€ç« æˆ‘ä»¬å°†ç»§ç»­å›´ç»• React v18 å±•å¼€ã€‚</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/book/tags/React/" rel="tag">React</a></li></ul></div><div class="post-nav"><a class="pre" href="/book/2023/chapter-30-practical-chapter-customized-hooks-practice/">ç¬¬30ç« â€”å®è·µç¯‡-è‡ªå®šä¹‰Hookså®è·µ</a><a class="next" href="/book/2023/chapter-32-principles-the-whole-process-of-grinwork-and-render/">ç¬¬32ç« â€”åŸç†ç¯‡-beginWorkå’Œrenderå…¨æµç¨‹</a></div><script src="https://utteranc.es/client.js" repo="Flashcard8009/book" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="https://avatars.githubusercontent.com/Flashcard8009"/></a><p>To be a better man.</p><a class="info-icon" href="https://github.com/Flashcard8009" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/username" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/book/categories/%E9%BB%98%E8%AE%A4/">é»˜è®¤</a><span class="category-list-count">43</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/book/tags/React/" style="font-size: 15px;">React</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/book/2023/book__react-advanced-practice-guide/">React è¿›é˜¶å®è·µæŒ‡å—</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-05-basic-chapter-deep-tips/">ç¬¬05ç« â€”åŸºç¡€ç¯‡-æ·±å…¥props</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-04-basic-chapter-metaphysics-state/">ç¬¬04ç« â€”åŸºç¡€ç¯‡-ç„å­¦state</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-07-basic-chapter-multifunctional-ref/">ç¬¬07ç« â€”åŸºç¡€ç¯‡-å¤šåŠŸèƒ½Ref</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-06-basic-chapter-understanding-lifecycle/">ç¬¬06ç« â€”åŸºç¡€ç¯‡-ç†è§£lifeCycle</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-08-basic-chapter-provider-context/">ç¬¬08ç« â€”åŸºç¡€ç¯‡-æä¾›è€…context</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-09-fundamentals-modular-css/">ç¬¬09ç« â€”åŸºç¡€ç¯‡-æ¨¡å—åŒ–css</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-10-fundamentals-advanced-components/">ç¬¬10ç« â€”åŸºç¡€ç¯‡-é«˜é˜¶ç»„ä»¶</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-12-optimization-chapter-rendering-tuning/">ç¬¬12ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“è°ƒä¼˜</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-11-optimization-rendering-control/">ç¬¬11ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“æ§åˆ¶</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="/" title="ä¸­æ–‡åšå®¢" target="_blank">ä¸­æ–‡åšå®¢</a><ul></ul><a href="/en" title="EN Blog" target="_blank">EN Blog</a><ul></ul><a href="https://github.com/Flashcard8009" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://www.baidu.com/" title="ç™¾åº¦" target="_blank">ç™¾åº¦</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2023 <a href="/book/." rel="nofollow">æ˜é‡‘å°å†Œ.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/book/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/book/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/book/css/search.css?v=1.0.0"><script type="text/javascript" src="/book/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/book/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/book/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/book/css/copycode.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/book/css/external.css?v=1.0.0"><script type="text/javascript" src="/book/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/book/js/smartresize.js?v=1.0.0"></script></div></body></html>