<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>第25章—实践篇-实现mini-Router | 掘金小册</title><link rel="stylesheet" type="text/css" href="/book/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/book/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/book/favicon.ico"><link rel="apple-touch-icon" href="/book/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/book/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/book/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第25章—实践篇-实现mini-Router</h1><a id="logo" href="/book/.">掘金小册</a><p class="description">学海无涯，共同进步！</p></div><div id="nav-menu"><a class="current" href="/book/."><i class="fa fa-home"> 首页</i></a><a href="/book/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/book/about/"><i class="fa fa-user"> 关于</i></a><a href="/book/atom.xml"><i class="fa fa-rss"> 订阅</i></a><a href="/book/guestbook/"><i class="fa fa-comments"> 留言</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第25章—实践篇-实现mini-Router</h1><div class="post-meta">2023-09-26<span> | </span><span class="category"><a href="/book/categories/%E9%BB%98%E8%AE%A4/">默认</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.6k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 11</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%89%8D%E8%A8%80"><span class="toc-text">一 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-text">二 设计思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BB%BA%E7%AB%8B%E7%9B%AE%E6%A0%87"><span class="toc-text">1 建立目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%BE%E8%AE%A1%E5%8A%9F%E8%83%BD%E5%9B%BE"><span class="toc-text">2 设计功能图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">三 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E5%B1%82%E9%9D%A2"><span class="toc-text">1 组件层面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-hooksAPI%E5%B1%82%E9%9D%A2"><span class="toc-text">2 hooksAPI层面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E5%B1%82%E9%9D%A2"><span class="toc-text">3 高阶组件层面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6"><span class="toc-text">4 入口文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E9%AA%8C%E8%AF%81%E6%95%88%E6%9E%9C"><span class="toc-text">四 验证效果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-text">配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%A1%B5%E9%9D%A2"><span class="toc-text">业务页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%88%E6%9E%9C"><span class="toc-text">效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E6%80%BB%E7%BB%93"><span class="toc-text">五 总结</span></a></li></ol></div></div><div class="post-content"><h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一 前言"></a>一 前言</h2><p>本章节，我们会从 0 到 1 实现一个 React 路由功能，这里可以称之为 <code>mini-Router</code>。实现的过程中会包含如下知识点：</p>
<ul>
<li>路由更新流程与原理；</li>
<li>自定义 hooks 编写与使用；</li>
<li>context 实践；</li>
<li>hoc 编写与使用。</li>
</ul>
<h2 id="二-设计思路"><a href="#二-设计思路" class="headerlink" title="二 设计思路"></a>二 设计思路</h2><p>整个 mini-Router 还是采用 <code>history</code> 库，也就是 mini-Router  需要完成的是 <code>React-Router</code> 和 <code>React-Router-DOM</code> 核心部分。今天编写的 mini-Router 是在 BrowserHistory 模式下。</p>
<h3 id="1-建立目标"><a href="#1-建立目标" class="headerlink" title="1 建立目标"></a>1 建立目标</h3><p>接下来要实现的具体功能如下：</p>
<ul>
<li><p><strong>组件层面：</strong> 在组件层面，需要实现提供路由状态的 Router ，控制渲染的 Route ，匹配唯一路由的 Switch 。</p>
</li>
<li><p><strong>api层面：</strong> 提供获取 history 对象的 useHistory 方法，获取 location 对象的 useLocation 方法。</p>
</li>
<li><p><strong>高阶组件层面：</strong> 对于不是路由的页面，提供 withRouter，能够获取当前路由状态。</p>
</li>
<li><p><strong>额外功能：</strong> 之前有很多同学问过我，在 React 应用中，可不可以提供有方法监听路由改变，所以 mini-Router 需要做的是增加路由监听器，当路由改变，触发路由监听器。</p>
</li>
</ul>
<h3 id="2-设计功能图"><a href="#2-设计功能图" class="headerlink" title="2 设计功能图"></a>2 设计功能图</h3><p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261718243.jpeg" alt="2.jpg"></p>
<h2 id="三-代码实现"><a href="#三-代码实现" class="headerlink" title="三 代码实现"></a>三 代码实现</h2><h3 id="1-组件层面"><a href="#1-组件层面" class="headerlink" title="1 组件层面"></a>1 组件层面</h3><p><strong>提供路由更新派发——Router</strong> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> ,&#123; useCallback, useState , useEffect ,createContext, useMemo  &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory <span class="keyword">as</span> createHistory  &#125; <span class="keyword">from</span> <span class="string">&#x27;history&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">RouterContext</span> = <span class="title function_">createContext</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> rootHistory = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Router</span>(<span class="params">props</span>)&#123;</span><br><span class="line">     <span class="comment">/* 缓存history属性 */</span></span><br><span class="line">     <span class="keyword">const</span> history = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          rootHistory = <span class="title function_">createHistory</span>()</span><br><span class="line">          <span class="keyword">return</span> rootHistory</span><br><span class="line">     &#125;,[])</span><br><span class="line">     <span class="keyword">const</span> [ location, setLocation ] = <span class="title function_">useState</span>(history.<span class="property">location</span>)</span><br><span class="line">     <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="comment">/* 监听location变化，通知更新 */</span></span><br><span class="line">          <span class="keyword">const</span> unlisten = history.<span class="title function_">listen</span>(<span class="function">(<span class="params">location</span>)=&gt;</span>&#123;</span><br><span class="line">               <span class="title function_">setLocation</span>(location)</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">               unlisten &amp;&amp; <span class="title function_">unlisten</span>()</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;,[])</span><br><span class="line">     <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">RouterContext.Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">value</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">location</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">history</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">match:</span> &#123; <span class="attr">path:</span> &#x27;/&#x27;, <span class="attr">url:</span> &#x27;/&#x27;, <span class="attr">params:</span> &#123;&#125;, <span class="attr">isExact:</span> <span class="attr">location.pathname</span> === <span class="string">&#x27;/&#x27;</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;props.children&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">RouterContext.Provider</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Router 设计思路：</p>
<ul>
<li>创建一个 React Context ，用于保存路由状态。用 Provider 传递 context 。</li>
<li>用一个 useMemo 来缓存 BrowserHistory 模式下的产生的路由对象 history ，这里有一个小细节，就是产生 history 的同时，把它赋值给了一个全局变量 rootHistory ，为什么这么做呢，答案一会将揭晓。</li>
<li>通过 useEffect 进行真正的路由监听，当路由改变，通过 useState ，改变 location 对象，会改变 Provider 里面 value 的内容，通知消费 context 的 Route ，Switch 等组件更新。 useEffect 的 destory 用于解绑路由监听器。</li>
</ul>
<p><strong>控制更新——Route</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> , &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; matchPath &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>  <span class="title function_">Route</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">RouterContext</span>)</span><br><span class="line">    <span class="comment">/* 获取location对象 */</span></span><br><span class="line">    <span class="keyword">const</span> location = props.<span class="property">location</span> || context.<span class="property">location</span></span><br><span class="line">    <span class="comment">/* 是否匹配当前路由，如果父级有switch，就会传入computedMatch来精确匹配渲染此路由 */</span></span><br><span class="line">    <span class="keyword">const</span> match = props.<span class="property">computedMatch</span> ? props.<span class="property">computedMatch</span></span><br><span class="line">                 : props.<span class="property">path</span> ?  <span class="title function_">matchPath</span>(location.<span class="property">pathname</span>,props) : context.<span class="property">match</span></span><br><span class="line">     <span class="comment">/* 这个props用于传递给路由组件 */</span></span><br><span class="line">    <span class="keyword">const</span> newRouterProps = &#123; ...context, location, match  &#125;</span><br><span class="line">    <span class="keyword">let</span> &#123; children, component, render  &#125; = props</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children) &amp;&amp; children.<span class="property">length</span> ===<span class="number">0</span> ) children = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> renderChildren = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span>(newRouterProps.<span class="property">match</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(children)&#123;</span><br><span class="line">            <span class="comment">/* 当Router 是 props children 或者 render props 形式。*/</span></span><br><span class="line">            renderChildren =  <span class="keyword">typeof</span> children === <span class="string">&#x27;function&#x27;</span> ? <span class="title function_">children</span>(newRouterProps) : children</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(component)&#123;</span><br><span class="line">            <span class="comment">/*  Route有component属性 */</span></span><br><span class="line">            renderChildren = <span class="title class_">React</span>.<span class="title function_">createElement</span>(component, newRouterProps)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(render)&#123;</span><br><span class="line">            <span class="comment">/*  Route有render属性 */</span></span><br><span class="line">            renderChildren = <span class="title function_">render</span>(newRouterProps)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 逐层传递上下文 */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">RouterContext.Provider</span>  <span class="attr">value</span>=<span class="string">&#123;newRouterProps&#125;</span>  &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;renderChildren&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">RouterContext.Provider</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Route</span></span><br></pre></td></tr></table></figure>

<ul>
<li>用 useContext 提取出路由上下文，当路由状态 location 改变，因为消费context 的组件都会重新渲染，当前Route会组件重新渲染，通过当前的 location 的 pathname 进行匹配，判断当前组件是否渲染，因为 Route 子组件有四种形式，所以会优先进行判断。</li>
<li>为了让 Route 的子组件访问到当前 Route 的信息，所以要选择通过 Provider 逐层传递的特点，再一次传递当前 Route 的信息，这样也能够让嵌套路由更简单的实现。</li>
<li>因为如果父级元素是 Switch ，就不需要匹配路由了，因为这些都是 Switch 该干的活，所以用 computedMatch 来识别是否上一层的 Switch 已经匹配完成了。</li>
</ul>
<p><strong>匹配正确路由—— Switch</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; matchPath &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../component/Router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Switch</span>(<span class="params">props</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">RouterContext</span>)</span><br><span class="line">    <span class="keyword">const</span> location = props.<span class="property">location</span> || context.<span class="property">location</span></span><br><span class="line">    <span class="keyword">let</span> children , match</span><br><span class="line">    <span class="comment">/* 遍历children Route 找到匹配的那一个 */</span></span><br><span class="line">    <span class="title class_">React</span>.<span class="property">Children</span>.<span class="title function_">forEach</span>(props.<span class="property">children</span>,<span class="function"><span class="params">child</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!match &amp;&amp; <span class="title class_">React</span>.<span class="title function_">isValidElement</span>(child) )&#123; <span class="comment">/* 路由匹配并为React.element元素的时候 */</span></span><br><span class="line">           <span class="keyword">const</span> path = child.<span class="property">props</span>.<span class="property">path</span> <span class="comment">//获取Route上的path</span></span><br><span class="line">           children = child <span class="comment">/* 匹配的children */</span></span><br><span class="line">           match = path ? <span class="title function_">matchPath</span>(location.<span class="property">pathname</span>,&#123; ...child.<span class="property">props</span> &#125;) : context.<span class="property">match</span> <span class="comment">/* 计算是否匹配 */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">/* 克隆一份Children，混入 computedMatch 并渲染。 */</span></span><br><span class="line">    <span class="keyword">return</span>  match ? <span class="title class_">React</span>.<span class="title function_">cloneElement</span>(children, &#123; location, <span class="attr">computedMatch</span>: match &#125;) : <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Switch 也要订阅来自 context 的变化，然后对 children 元素，进行唯一性的路由匹配。</li>
<li>通过<code>React.Children.forEach</code>遍历子 Route，然后通过 matchPath 进行匹配，如果匹配到组件，将克隆组件，混入 computedMatch，location 等信息。</li>
</ul>
<h3 id="2-hooksAPI层面"><a href="#2-hooksAPI层面" class="headerlink" title="2 hooksAPI层面"></a>2 hooksAPI层面</h3><p>为了让 mini-Router 每一个组件都能自由获取路由状态，这里编写了两个自定义 hooks。</p>
<p><strong>获取history对象</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterContext</span>  &#125; <span class="keyword">from</span> <span class="string">&#x27;../component/Router&#x27;</span></span><br><span class="line"><span class="comment">/* 用useContext获取上下文中的history对象 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useHistory</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">useContext</span>(<span class="title class_">RouterContext</span>).<span class="property">history</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>用 useContext 获取上下文中的 history 对象。</li>
</ul>
<p><strong>获取 location 对象</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterContext</span>  &#125; <span class="keyword">from</span> <span class="string">&#x27;../component/Router&#x27;</span></span><br><span class="line"><span class="comment">/* 用useContext获取上下文中的location对象 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>  <span class="title function_">useLocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">useContext</span>(<span class="title class_">RouterContext</span>).<span class="property">location</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>用 useContext 获取上下文中的 location 对象。</li>
</ul>
<p>上述的两个 hooks 编写起来非常简单，但是也要注意一个问题，两个 hooks 本质上都是消费了 context ，所以用到上述两个 hook 的组件，当context 变化，都会重新渲染。接下来增加一个新的功能，监听路由改变。</p>
<p><strong>监听路由改变</strong>，和上面两种情况不同，不想订阅 context 变化，而带来的更新作用，另外一点就是这种监听有可能在 Router 包裹的组件层级之外，那么如何达到目的呢？这个时候在 Router 中的 rootHistory 就派上了用场，这个 rootHistory 目的就是为了全局能够便捷的获取 history 对象。接下来具体实现一个监听路由变化的自定义 hooks 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; rootHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;../component/Router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 监听路由改变 */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useListen</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rootHistory) <span class="keyword">return</span> <span class="function">()=&gt;</span> &#123;&#125;</span><br><span class="line">        <span class="comment">/* 绑定路由事件监听器 */</span></span><br><span class="line">        <span class="keyword">const</span> unlisten = rootHistory.<span class="title function_">listen</span>(<span class="function">(<span class="params">location</span>)=&gt;</span>&#123;</span><br><span class="line">             cb &amp;&amp; <span class="title function_">cb</span>(location)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            unlisten &amp;&amp; <span class="title function_">unlisten</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,[])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useListen</span><br></pre></td></tr></table></figure>

<ul>
<li>如果 rootHistory 不存在，那么这个 hooks 也就没有任何作用，直接返回空函数就可以了。</li>
<li>如果 rootHistory 存在，通过 useEffect ，绑定监听器，然后在销毁函数中，解绑监听器。</li>
</ul>
<h3 id="3-高阶组件层面"><a href="#3-高阶组件层面" class="headerlink" title="3 高阶组件层面"></a>3 高阶组件层面</h3><p>希望通过一个 HOC 能够自由获取路由的状态。所以要实现一个 react-router 中 withRouter 功能。</p>
<p><strong>获取路由状态——withRouter</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> , &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> hoistStatics <span class="keyword">from</span> <span class="string">&#x27;hoist-non-react-statics&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RouterContext</span>  &#125; <span class="keyword">from</span> <span class="string">&#x27;../component/Router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">withRouter</span>(<span class="params">Component</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">WrapComponent</span> = (<span class="params">props</span>) =&gt;&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; wrappedComponentRef, ...remainingProps &#125; = props</span><br><span class="line">        <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">RouterContext</span>)</span><br><span class="line">        <span class="keyword">return</span>  <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...remainingProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">ref</span>=<span class="string">&#123;wrappedComponentRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;<span class="attr">...context</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">hoistStatics</span>(<span class="title class_">WrapComponent</span>,<span class="title class_">Component</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>在高阶组件的包装组件中，用useContext获取路由状态，并传递给原始组件。</li>
<li>通过<code>hoist-non-react-statics</code>继承原始组件的静态属性。</li>
</ul>
<h3 id="4-入口文件"><a href="#4-入口文件" class="headerlink" title="4 入口文件"></a>4 入口文件</h3><p>完成了核心 api 和组件，接下来需要出口文件，把这些方法暴露出去。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//component</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> ,&#123; <span class="title class_">RouterContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./component/Router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Route</span> <span class="keyword">from</span> <span class="string">&#x27;./component/Route&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Switch</span> <span class="keyword">from</span> <span class="string">&#x27;./component/Switch&#x27;</span></span><br><span class="line"><span class="comment">//hooks</span></span><br><span class="line"><span class="keyword">import</span> useHistory <span class="keyword">from</span> <span class="string">&#x27;./hooks/useHistory&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useListen <span class="keyword">from</span> <span class="string">&#x27;./hooks/useListen&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useLocation <span class="keyword">from</span> <span class="string">&#x27;./hooks/useLocation&#x27;</span></span><br><span class="line"><span class="comment">//hoc</span></span><br><span class="line"><span class="keyword">import</span> withRouter <span class="keyword">from</span> <span class="string">&#x27;./hoc/withRouter&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    <span class="title class_">Router</span>,</span><br><span class="line">    <span class="title class_">Switch</span>,</span><br><span class="line">    <span class="title class_">Route</span>,</span><br><span class="line">    <span class="title class_">RouterContext</span>,</span><br><span class="line">    useHistory,</span><br><span class="line">    useListen,</span><br><span class="line">    useLocation,</span><br><span class="line">    withRouter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四-验证效果"><a href="#四-验证效果" class="headerlink" title="四 验证效果"></a>四 验证效果</h2><p>一个简单的路由库就实现了，接下来验证一下<code>mini-Router</code>的效果：</p>
<h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Router</span>, <span class="title class_">Route</span>, useHistory, useListen, <span class="title class_">Switch</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 引用业务组件 */</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Detail</span> <span class="keyword">from</span> <span class="string">&#x27;./testPage/detail&#x27;</span>  <span class="comment">/* 详情页 */</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span>  <span class="keyword">from</span> <span class="string">&#x27;./testPage/home&#x27;</span>     <span class="comment">/* 首页 */</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">List</span> <span class="keyword">from</span> <span class="string">&#x27;./testPage/list&#x27;</span>      <span class="comment">/* 列表页 */</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> menusList = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;列表&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&#x27;/list&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;详情&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="string">&#x27;/detail&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Nav</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> history  = <span class="title function_">useHistory</span>()</span><br><span class="line">    <span class="comment">/* 路由跳转 */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">RouterGo</span> = (<span class="params">url</span>) =&gt;  history.<span class="title function_">push</span>(url)</span><br><span class="line">    <span class="keyword">const</span> path = history.<span class="property">location</span>.<span class="property">pathname</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;</span></span><br><span class="line"><span class="language-xml">            menusList.map((item=&gt;<span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;</span>`<span class="attr">nav</span> $&#123; <span class="attr">item.path</span>===<span class="string">path</span> ? &#x27;<span class="attr">active</span>&#x27;  <span class="attr">:</span> &#x27;&#x27; &#125;`&#125; <span class="attr">key</span>=<span class="string">&#123;item.path&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>RouterGo(item.path)&#125; &gt;&#123;item.name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>))</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>  <span class="title function_">Top</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* 路由监听 */</span></span><br><span class="line">    <span class="title function_">useListen</span>(<span class="function">(<span class="params">location</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&#x27;当前路由是：&#x27;</span>, location.<span class="property">pathname</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>--------top------<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;根组件渲染&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Top</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Nav</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span>  <span class="attr">component</span>=<span class="string">&#123;Detail&#125;</span> <span class="attr">path</span>=<span class="string">&quot;/detail&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/list&quot;</span> <span class="attr">render</span>=<span class="string">&#123;(props)</span>=&gt;</span> <span class="tag">&lt;<span class="name">List</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>--------bottom------<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Index</span></span><br></pre></td></tr></table></figure>
<ul>
<li>通过 Router，Route，Switch 给首页，列表，详情三个页面配置路由。</li>
<li>Top 里面进行路由监听，路由变化，组件不渲染。</li>
<li>Nav 里改变路由，切换页面。</li>
</ul>
<h3 id="业务页面"><a href="#业务页面" class="headerlink" title="业务页面"></a>业务页面</h3><p><strong>首页</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        hello,world。</span></span><br><span class="line"><span class="language-xml">        let us learn React!</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">HomeOne</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>高阶组件包裹的 HomeOne</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@withRouter</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeOne</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title class_">RouteGo</span>=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; history &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        history.<span class="title function_">push</span>(<span class="string">&#x27;/detail&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试HOC——withRouter<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.RouteGo&#125;</span> &gt;</span>跳转到详情页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>列表页面</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>React.js<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>Vue.js<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>nodejs<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>详情页面</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>  <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>小册名称：《React进阶实践指南》<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>作者：我不是外星人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261718009.gif" alt="1.gif"></p>
<h2 id="五-总结"><a href="#五-总结" class="headerlink" title="五 总结"></a>五 总结</h2><p>本章节通过实现一个 mini-router，来贯穿前面的章节中的内容。接下来对这节的收获做一个总结：</p>
<ul>
<li>强化 React-Router 的核心原理，Router，Route 等组件。</li>
<li>渲染控制，操作 children 。</li>
<li>高阶组件混入路由状态。</li>
<li>hooks 的使用指南，所有组件都是用 hooks 编写的。</li>
<li>自定义 hooks 的编写。</li>
</ul>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/book/tags/React/" rel="tag">React</a></li></ul></div><div class="post-nav"><a class="pre" href="/book/2023/chapter-23-ecology-react-redux/">第23章—生态篇-React-redux</a><a class="next" href="/book/2023/chapter-26-practice-chapter-form-verification/">第26章—实践篇-表单验证上</a></div><script src="https://utteranc.es/client.js" repo="Flashcard8009/book" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="https://avatars.githubusercontent.com/Flashcard8009"/></a><p>To be a better man.</p><a class="info-icon" href="https://github.com/Flashcard8009" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/username" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/book/categories/%E9%BB%98%E8%AE%A4/">默认</a><span class="category-list-count">43</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/book/tags/React/" style="font-size: 15px;">React</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/book/2023/book__react-advanced-practice-guide/">React 进阶实践指南</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-05-basic-chapter-deep-tips/">第05章—基础篇-深入props</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-04-basic-chapter-metaphysics-state/">第04章—基础篇-玄学state</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-07-basic-chapter-multifunctional-ref/">第07章—基础篇-多功能Ref</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-06-basic-chapter-understanding-lifecycle/">第06章—基础篇-理解lifeCycle</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-08-basic-chapter-provider-context/">第08章—基础篇-提供者context</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-09-fundamentals-modular-css/">第09章—基础篇-模块化css</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-10-fundamentals-advanced-components/">第10章—基础篇-高阶组件</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-12-optimization-chapter-rendering-tuning/">第12章—优化篇-渲染调优</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-11-optimization-rendering-control/">第11章—优化篇-渲染控制</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="/" title="中文博客" target="_blank">中文博客</a><ul></ul><a href="/en" title="EN Blog" target="_blank">EN Blog</a><ul></ul><a href="https://github.com/Flashcard8009" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://www.baidu.com/" title="百度" target="_blank">百度</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/book/." rel="nofollow">掘金小册.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/book/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/book/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/book/css/search.css?v=1.0.0"><script type="text/javascript" src="/book/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/book/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/book/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/book/css/copycode.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/book/css/external.css?v=1.0.0"><script type="text/javascript" src="/book/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/book/js/smartresize.js?v=1.0.0"></script></div></body></html>