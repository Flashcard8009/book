<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>ç¬¬21ç« â€”åŸç†ç¯‡-HooksåŸç† | æ˜é‡‘å°å†Œ</title><link rel="stylesheet" type="text/css" href="/book/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/book/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/book/favicon.ico"><link rel="apple-touch-icon" href="/book/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/book/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/book/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ç¬¬21ç« â€”åŸç†ç¯‡-HooksåŸç†</h1><a id="logo" href="/book/.">æ˜é‡‘å°å†Œ</a><p class="description">å­¦æµ·æ— æ¶¯ï¼Œå…±åŒè¿›æ­¥ï¼</p></div><div id="nav-menu"><a class="current" href="/book/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/book/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/book/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/book/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a><a href="/book/guestbook/"><i class="fa fa-comments"> ç•™è¨€</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ç¬¬21ç« â€”åŸç†ç¯‡-HooksåŸç†</h1><div class="post-meta">2023-09-26<span> | </span><span class="category"><a href="/book/categories/%E9%BB%98%E8%AE%A4/">é»˜è®¤</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.4k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 17</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%89%8D%E8%A8%80"><span class="toc-text">ä¸€å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-hooks%E4%B8%8Efiber%EF%BC%88workInProgress%EF%BC%89"><span class="toc-text">äºŒ hooksä¸fiberï¼ˆworkInProgressï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%A7%A6%E5%8F%91"><span class="toc-text">å‡½æ•°ç»„ä»¶è§¦å‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hooks%E5%88%9D%E5%A7%8B%E5%8C%96-hooks-%E5%A6%82%E4%BD%95%E5%92%8C-fiber-%E5%BB%BA%E7%AB%8B%E8%B5%B7%E5%85%B3%E7%B3%BB"><span class="toc-text">hooksåˆå§‹åŒ–- hooks å¦‚ä½•å’Œ fiber å»ºç«‹èµ·å…³ç³»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hooks%E6%9B%B4%E6%96%B0"><span class="toc-text">hooksæ›´æ–°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E7%8A%B6%E6%80%81%E6%B4%BE%E5%8F%91"><span class="toc-text">ä¸‰ çŠ¶æ€æ´¾å‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E5%A4%84%E7%90%86%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-text">å›› å¤„ç†å‰¯ä½œç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">åˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0"><span class="toc-text">æ›´æ–°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%9A%84effect"><span class="toc-text">ä¸åŒçš„effect</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E7%8A%B6%E6%80%81%E8%8E%B7%E5%8F%96%E4%B8%8E%E7%8A%B6%E6%80%81%E7%BC%93%E5%AD%98"><span class="toc-text">äº” çŠ¶æ€è·å–ä¸çŠ¶æ€ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AF%B9%E4%BA%8E-ref-%E5%A4%84%E7%90%86"><span class="toc-text">1 å¯¹äº ref å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AF%B9%E4%BA%8EuseMemo%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text">2 å¯¹äºuseMemoçš„å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E6%80%BB%E7%BB%93"><span class="toc-text">å…­ æ€»ç»“</span></a></li></ol></div></div><div class="post-content"><h2 id="ä¸€å‰è¨€"><a href="#ä¸€å‰è¨€" class="headerlink" title="ä¸€å‰è¨€"></a>ä¸€å‰è¨€</h2><p><strong>æ¸©é¦¨æç¤ºï¼šè¯·å¸¦ç€é—®é¢˜å»æ€è€ƒï¼Ÿä¸è¦ç›²ç›®çš„çœ‹å“ˆï¼Œæˆ‘åœ¨è¿™é‡Œå…ˆå‡ºå‡ ä¸ªé¢è¯•ä¸­çš„é—®é¢˜ã€‚</strong></p>
<ul>
<li>â‘  React Hooks ä¸ºä»€ä¹ˆå¿…é¡»åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨æ‰§è¡Œï¼ŸReact å¦‚ä½•èƒ½å¤Ÿç›‘å¬ React Hooks åœ¨å¤–éƒ¨æ‰§è¡Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ </li>
<li>â‘¡ React Hooks å¦‚ä½•æŠŠçŠ¶æ€ä¿å­˜èµ·æ¥ï¼Ÿä¿å­˜çš„ä¿¡æ¯å­˜åœ¨äº†å“ªé‡Œï¼Ÿ</li>
<li>â‘¢ React Hooks ä¸ºä»€ä¹ˆä¸èƒ½å†™åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Ÿ </li>
<li>â‘£ useMemo å†…éƒ¨å¼•ç”¨ useRef ä¸ºä»€ä¹ˆä¸éœ€è¦æ·»åŠ ä¾èµ–é¡¹ï¼Œè€Œ useState å°±è¦æ·»åŠ ä¾èµ–é¡¹ã€‚ </li>
<li>â‘¤ useEffect æ·»åŠ ä¾èµ–é¡¹ props.a ï¼Œä¸ºä»€ä¹ˆ props.a æ”¹å˜ï¼ŒuseEffect å›è°ƒå‡½æ•° create é‡æ–°æ‰§è¡Œã€‚ </li>
<li>â‘¥ React å†…éƒ¨å¦‚ä½•åŒºåˆ« useEffect å’Œ useLayoutEffect ï¼Œæ‰§è¡Œæ—¶æœºæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</li>
</ul>
<p>ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬é™†é™†ç»­ç»­è®²è§£äº† React Hooks ä¸­ä¸»è¦ Hooks çš„ä½¿ç”¨ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡æœ¬ç« èŠ‚ï¼ŒæŠŠ Hooks ä½¿ç”¨å’ŒåŸç†ä¸²è”èµ·æ¥ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>
<ol>
<li>èƒ½è®©ä½ åœ¨å®é™…å·¥ä½œåœºæ™¯ä¸­æ›´ç†Ÿç»ƒè¿ç”¨ Hooksï¼›</li>
<li>ä¸€æ¬¡æ€§é€šå…³é¢è¯•ä¸­å…³äº Hooks åŸç†çš„æ‰€æœ‰é—®é¢˜ã€‚</li>
</ol>
<p>ä½ å¯ä»¥æƒ³ä¸€ä¸‹ React ä¸ºä»€ä¹ˆä¼šé€ å‡º Hooks å‘¢ï¼Ÿ</p>
<p>å…ˆè®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ Hooksï¼Œå‡½æ•°ç»„ä»¶èƒ½å¤Ÿåšçš„åªæ˜¯æ¥å— Propsã€æ¸²æŸ“ UI ï¼Œä»¥åŠè§¦å‘çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„äº‹ä»¶ã€‚æ‰€æœ‰çš„å¤„ç†é€»è¾‘éƒ½è¦åœ¨ç±»ç»„ä»¶ä¸­å†™ï¼Œè¿™æ ·ä¼šä½¿ class ç±»ç»„ä»¶å†…éƒ¨é”™ç»¼å¤æ‚ï¼Œæ¯ä¸€ä¸ªç±»ç»„ä»¶éƒ½æœ‰ä¸€å¥—ç‹¬ç‰¹çš„çŠ¶æ€ï¼Œç›¸äº’ä¹‹é—´ä¸èƒ½å¤ç”¨ï¼Œå³ä¾¿æ˜¯ React ä¹‹å‰å‡ºç°è¿‡ mixin ç­‰å¤ç”¨æ–¹å¼ï¼Œä½†æ˜¯ä¼´éšå‡º mixin æ¨¡å¼ä¸‹éšå¼ä¾èµ–ï¼Œä»£ç å†²çªè¦†ç›–ç­‰é—®é¢˜ï¼Œä¹Ÿä¸èƒ½æˆä¸º React çš„ä¸­æµç ¥æŸ±çš„é€»è¾‘å¤ç”¨æ–¹æ¡ˆã€‚æ‰€ä»¥ React æ”¾å¼ƒ mixin è¿™ç§æ–¹å¼ã€‚</p>
<p>ç±»ç»„ä»¶æ˜¯ä¸€ç§é¢å‘å¯¹è±¡æ€æƒ³çš„ä½“ç°ï¼Œç±»ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€ä¼šéšç€åŠŸèƒ½å¢å¼ºè€Œå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œä»£ç ç»´æŠ¤æˆæœ¬ä¹Ÿæ¯”è¾ƒé«˜ï¼Œè€Œä¸”ä¸åˆ©äºåæœŸ tree shakingã€‚æ‰€ä»¥æœ‰å¿…è¦åšå‡ºä¸€å¥—å‡½æ•°ç»„ä»¶ä»£æ›¿ç±»ç»„ä»¶çš„æ–¹æ¡ˆï¼Œäºæ˜¯ Hooks ä¹Ÿå°±ç†æ‰€å½“ç„¶çš„è¯ç”Ÿäº†ã€‚</p>
<p>æ‰€ä»¥ Hooks å‡ºç°æœ¬è´¨ä¸ŠåŸå› æ˜¯ï¼š</p>
<ul>
<li>1 è®©å‡½æ•°ç»„ä»¶ä¹Ÿèƒ½åšç±»ç»„ä»¶çš„äº‹ï¼Œæœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œå¯ä»¥å¤„ç†ä¸€äº›å‰¯ä½œç”¨ï¼Œèƒ½è·å– ref ï¼Œä¹Ÿèƒ½åšæ•°æ®ç¼“å­˜ã€‚</li>
<li>2 è§£å†³é€»è¾‘å¤ç”¨éš¾çš„é—®é¢˜ã€‚</li>
<li>3 æ”¾å¼ƒé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹ã€‚</li>
</ul>
<h2 id="äºŒ-hooksä¸fiberï¼ˆworkInProgressï¼‰"><a href="#äºŒ-hooksä¸fiberï¼ˆworkInProgressï¼‰" class="headerlink" title="äºŒ hooksä¸fiberï¼ˆworkInProgressï¼‰"></a>äºŒ hooksä¸fiberï¼ˆworkInProgressï¼‰</h2><p>ä¹‹å‰ç« èŠ‚è®²è¿‡ï¼Œç±»ç»„ä»¶çš„çŠ¶æ€æ¯”å¦‚ state ï¼Œcontext ï¼Œprops æœ¬è´¨ä¸Šæ˜¯å­˜åœ¨ç±»ç»„ä»¶å¯¹åº”çš„ fiber ä¸Šï¼ŒåŒ…æ‹¬ç”Ÿå‘½å‘¨æœŸæ¯”å¦‚ componentDidMount ï¼Œä¹Ÿæ˜¯ä»¥å‰¯ä½œç”¨ effect å½¢å¼å­˜åœ¨çš„ã€‚é‚£ä¹ˆ Hooks æ—¢ç„¶èµ‹äºˆäº†å‡½æ•°ç»„ä»¶å¦‚ä¸ŠåŠŸèƒ½ï¼Œæ‰€ä»¥ hooks æœ¬è´¨æ˜¯ç¦»ä¸å¼€å‡½æ•°ç»„ä»¶å¯¹åº”çš„ fiber çš„ã€‚ hooks å¯ä»¥ä½œä¸ºå‡½æ•°ç»„ä»¶æœ¬èº«å’Œå‡½æ•°ç»„ä»¶å¯¹åº”çš„ fiber ä¹‹é—´çš„æ²Ÿé€šæ¡¥æ¢ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261715206.jpeg" alt="hook1.jpg"></p>
<p>hooks å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ä¸»è¦ä»¥ä¸‰ç§å¤„ç†ç­–ç•¥å­˜åœ¨ React ä¸­ï¼š</p>
<ul>
<li>1 <code>ContextOnlyDispatcher</code>ï¼š  ç¬¬ä¸€ç§å½¢æ€æ˜¯é˜²æ­¢å¼€å‘è€…åœ¨å‡½æ•°ç»„ä»¶å¤–éƒ¨è°ƒç”¨ hooks ï¼Œæ‰€ä»¥ç¬¬ä¸€ç§å°±æ˜¯æŠ¥é”™å½¢æ€ï¼Œåªè¦å¼€å‘è€…è°ƒç”¨äº†è¿™ä¸ªå½¢æ€ä¸‹çš„ hooks ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>2 <code>HooksDispatcherOnMount</code>ï¼š ç¬¬äºŒç§å½¢æ€æ˜¯å‡½æ•°ç»„ä»¶åˆå§‹åŒ– mount ï¼Œå› ä¸ºä¹‹å‰è®²è¿‡ hooks æ˜¯å‡½æ•°ç»„ä»¶å’Œå¯¹åº” fiber æ¡¥æ¢ï¼Œè¿™ä¸ªæ—¶å€™çš„ hooks ä½œç”¨å°±æ˜¯å»ºç«‹è¿™ä¸ªæ¡¥æ¢ï¼Œåˆæ¬¡å»ºç«‹å…¶ hooks ä¸ fiber ä¹‹é—´çš„å…³ç³»ã€‚</li>
<li>3 <code>HooksDispatcherOnUpdate</code>ï¼šç¬¬ä¸‰ç§å½¢æ€æ˜¯å‡½æ•°ç»„ä»¶çš„æ›´æ–°ï¼Œæ—¢ç„¶ä¸ fiber ä¹‹é—´çš„æ¡¥å·²ç»å»ºå¥½äº†ï¼Œé‚£ä¹ˆç»„ä»¶å†æ›´æ–°ï¼Œå°±éœ€è¦ hooks å»è·å–æˆ–è€…æ›´æ–°ç»´æŠ¤çŠ¶æ€ã€‚</li>
</ul>
<p>ä¸€ä¸ª hooks å¯¹è±¡åº”è¯¥é•¿æˆè¿™æ ·ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HooksDispatcherOnMount</span> = &#123; <span class="comment">/* å‡½æ•°ç»„ä»¶åˆå§‹åŒ–ç”¨çš„ hooks */</span></span><br><span class="line">    <span class="attr">useState</span>: mountState,</span><br><span class="line">    <span class="attr">useEffect</span>: mountEffect,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span>  <span class="title class_">HooksDispatcherOnUpdate</span> =&#123;<span class="comment">/* å‡½æ•°ç»„ä»¶æ›´æ–°ç”¨çš„ hooks */</span></span><br><span class="line">   <span class="attr">useState</span>:updateState,</span><br><span class="line">   <span class="attr">useEffect</span>: updateEffect,</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ContextOnlyDispatcher</span> = &#123;  <span class="comment">/* å½“hooksä¸æ˜¯å‡½æ•°å†…éƒ¨è°ƒç”¨çš„æ—¶å€™ï¼Œè°ƒç”¨è¿™ä¸ªhookså¯¹è±¡ä¸‹çš„hooksï¼Œæ‰€ä»¥æŠ¥é”™ã€‚ */</span></span><br><span class="line">   <span class="attr">useEffect</span>: throwInvalidHookError,</span><br><span class="line">   <span class="attr">useState</span>: throwInvalidHookError,</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°ç»„ä»¶è§¦å‘"><a href="#å‡½æ•°ç»„ä»¶è§¦å‘" class="headerlink" title="å‡½æ•°ç»„ä»¶è§¦å‘"></a>å‡½æ•°ç»„ä»¶è§¦å‘</h3><p>æ‰€æœ‰å‡½æ•°ç»„ä»¶çš„è§¦å‘æ˜¯åœ¨ renderWithHooks æ–¹æ³•ä¸­ï¼Œåœ¨ fiber è°ƒå’Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ° FunctionComponent ç±»å‹çš„ fiberï¼ˆå‡½æ•°ç»„ä»¶ï¼‰ï¼Œå°±ä¼šç”¨ updateFunctionComponent æ›´æ–° fiber ï¼Œåœ¨ updateFunctionComponent å†…éƒ¨å°±ä¼šè°ƒç”¨ renderWithHooks ã€‚</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberHooks.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> currentlyRenderingFiber</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderWithHooks</span>(<span class="params">current,workInProgress,Component,props</span>)&#123;</span><br><span class="line">    currentlyRenderingFiber = workInProgress;</span><br><span class="line">    workInProgress.<span class="property">memoizedState</span> = <span class="literal">null</span>; <span class="comment">/* æ¯ä¸€æ¬¡æ‰§è¡Œå‡½æ•°ç»„ä»¶ä¹‹å‰ï¼Œå…ˆæ¸…ç©ºçŠ¶æ€ ï¼ˆç”¨äºå­˜æ”¾hooksåˆ—è¡¨ï¼‰*/</span></span><br><span class="line">    workInProgress.<span class="property">updateQueue</span> = <span class="literal">null</span>;    <span class="comment">/* æ¸…ç©ºçŠ¶æ€ï¼ˆç”¨äºå­˜æ”¾effect listï¼‰ */</span></span><br><span class="line">    <span class="title class_">ReactCurrentDispatcher</span>.<span class="property">current</span> =  current === <span class="literal">null</span> || current.<span class="property">memoizedState</span> === <span class="literal">null</span> ? <span class="title class_">HooksDispatcherOnMount</span> : <span class="title class_">HooksDispatcherOnUpdate</span> <span class="comment">/* åˆ¤æ–­æ˜¯åˆå§‹åŒ–ç»„ä»¶è¿˜æ˜¯æ›´æ–°ç»„ä»¶ */</span></span><br><span class="line">    <span class="keyword">let</span> children = <span class="title class_">Component</span>(props, secondArg); <span class="comment">/* æ‰§è¡Œæˆ‘ä»¬çœŸæ­£å‡½æ•°ç»„ä»¶ï¼Œæ‰€æœ‰çš„hookså°†ä¾æ¬¡æ‰§è¡Œã€‚ */</span></span><br><span class="line">    <span class="title class_">ReactCurrentDispatcher</span>.<span class="property">current</span> = <span class="title class_">ContextOnlyDispatcher</span>; <span class="comment">/* å°†hookså˜æˆç¬¬ä¸€ç§ï¼Œé˜²æ­¢hooksåœ¨å‡½æ•°ç»„ä»¶å¤–éƒ¨è°ƒç”¨ï¼Œè°ƒç”¨ç›´æ¥æŠ¥é”™ã€‚ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>workInProgress æ­£åœ¨è°ƒå’Œæ›´æ–°å‡½æ•°ç»„ä»¶å¯¹åº”çš„ fiber æ ‘ã€‚</p>
<ul>
<li>å¯¹äºç±»ç»„ä»¶ fiber ï¼Œç”¨ memoizedState ä¿å­˜ state ä¿¡æ¯ï¼Œ<strong>å¯¹äºå‡½æ•°ç»„ä»¶ fiber ï¼Œç”¨ memoizedState ä¿å­˜ hooks ä¿¡æ¯</strong>ã€‚</li>
<li>å¯¹äºå‡½æ•°ç»„ä»¶ fiber ï¼ŒupdateQueue å­˜æ”¾æ¯ä¸ª useEffect&#x2F;useLayoutEffect äº§ç”Ÿçš„å‰¯ä½œç”¨ç»„æˆçš„é“¾è¡¨ã€‚åœ¨ commit é˜¶æ®µæ›´æ–°è¿™äº›å‰¯ä½œç”¨ã€‚ </li>
<li>ç„¶ååˆ¤æ–­ç»„ä»¶æ˜¯åˆå§‹åŒ–æµç¨‹è¿˜æ˜¯æ›´æ–°æµç¨‹ï¼Œå¦‚æœåˆå§‹åŒ–ç”¨  HooksDispatcherOnMount å¯¹è±¡ï¼Œå¦‚æœæ›´æ–°ç”¨ HooksDispatcherOnUpdate å¯¹è±¡ã€‚å‡½æ•°ç»„ä»¶æ‰§è¡Œå®Œæ¯•ï¼Œå°† hooks èµ‹å€¼ç»™ ContextOnlyDispatcher å¯¹è±¡ã€‚<strong>å¼•ç”¨çš„ React hookséƒ½æ˜¯ä» ReactCurrentDispatcher.current ä¸­çš„ï¼Œ React å°±æ˜¯é€šè¿‡èµ‹äºˆ current ä¸åŒçš„ hooks å¯¹è±¡è¾¾åˆ°ç›‘æ§ hooks æ˜¯å¦åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨è°ƒç”¨ã€‚</strong></li>
<li>Component ( props ï¼Œ secondArg ) è¿™ä¸ªæ—¶å€™å‡½æ•°ç»„ä»¶è¢«çœŸæ­£çš„æ‰§è¡Œï¼Œé‡Œé¢æ¯ä¸€ä¸ª hooks ä¹Ÿå°†ä¾æ¬¡æ‰§è¡Œã€‚</li>
<li>æ¯ä¸ª hooks å†…éƒ¨ä¸ºä»€ä¹ˆèƒ½å¤Ÿè¯»å–å½“å‰ fiber ä¿¡æ¯ï¼Œå› ä¸º currentlyRenderingFiber ï¼Œå‡½æ•°ç»„ä»¶åˆå§‹åŒ–å·²ç»æŠŠå½“å‰ fiber èµ‹å€¼ç»™ currentlyRenderingFiber ï¼Œæ¯ä¸ª hooks å†…éƒ¨è¯»å–çš„å°±æ˜¯ currentlyRenderingFiber çš„å†…å®¹ã€‚</li>
</ul>
<h3 id="hooksåˆå§‹åŒ–-hooks-å¦‚ä½•å’Œ-fiber-å»ºç«‹èµ·å…³ç³»"><a href="#hooksåˆå§‹åŒ–-hooks-å¦‚ä½•å’Œ-fiber-å»ºç«‹èµ·å…³ç³»" class="headerlink" title="hooksåˆå§‹åŒ–- hooks å¦‚ä½•å’Œ fiber å»ºç«‹èµ·å…³ç³»"></a>hooksåˆå§‹åŒ–- hooks å¦‚ä½•å’Œ fiber å»ºç«‹èµ·å…³ç³»</h3><p>hooks åˆå§‹åŒ–æµç¨‹ä½¿ç”¨çš„æ˜¯ mountStateï¼ŒmountEffect ç­‰åˆå§‹åŒ–èŠ‚ç‚¹çš„hooksï¼Œå°† hooks å’Œ fiber å»ºç«‹èµ·è”ç³»ï¼Œé‚£ä¹ˆæ˜¯å¦‚ä½•å»ºç«‹èµ·å…³ç³»å‘¢ï¼Œæ¯ä¸€ä¸ªhooks åˆå§‹åŒ–éƒ½ä¼šæ‰§è¡Œ mountWorkInProgressHook ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ã€‚</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberHooks.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountWorkInProgressHook</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hook = &#123;  <span class="attr">memoizedState</span>: <span class="literal">null</span>, <span class="attr">baseState</span>: <span class="literal">null</span>, <span class="attr">baseQueue</span>: <span class="literal">null</span>,<span class="attr">queue</span>: <span class="literal">null</span>, <span class="attr">next</span>: <span class="literal">null</span>,&#125;;</span><br><span class="line">  <span class="keyword">if</span> (workInProgressHook === <span class="literal">null</span>) &#123;  <span class="comment">// åªæœ‰ä¸€ä¸ª hooks</span></span><br><span class="line">    currentlyRenderingFiber.<span class="property">memoizedState</span> = workInProgressHook = hook;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  <span class="comment">// æœ‰å¤šä¸ª hooks</span></span><br><span class="line">    workInProgressHook = workInProgressHook.<span class="property">next</span> = hook;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> workInProgressHook;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå‡½æ•°ç»„ä»¶å¯¹åº” fiber ç”¨ memoizedState ä¿å­˜ hooks ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ª hooks æ‰§è¡Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª hooks å¯¹è±¡ï¼Œhooks å¯¹è±¡ä¸­ï¼Œä¿å­˜ç€å½“å‰ hooks çš„ä¿¡æ¯ï¼Œä¸åŒ hooks ä¿å­˜çš„å½¢å¼ä¸åŒã€‚æ¯ä¸€ä¸ª hooks é€šè¿‡ next é“¾è¡¨å»ºç«‹èµ·å…³ç³»ã€‚</p>
<p>å‡è®¾åœ¨ä¸€ä¸ªç»„ä»¶ä¸­è¿™ä¹ˆå†™</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [ number,setNumber ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>) <span class="comment">// ç¬¬ä¸€ä¸ªhooks</span></span><br><span class="line">    <span class="keyword">const</span> [ num, setNum ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">1</span>)      <span class="comment">// ç¬¬äºŒä¸ªhooks</span></span><br><span class="line">    <span class="keyword">const</span> dom = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>)                 <span class="comment">// ç¬¬ä¸‰ä¸ªhooks</span></span><br><span class="line">    <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;                          <span class="comment">// ç¬¬å››ä¸ªhooks</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(dom.<span class="property">current</span>)</span><br><span class="line">    &#125;,[])</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;dom&#125;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setNumber(number + 1 ) &#125; &gt; &#123; number &#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setNum(num + 1) &#125; &gt; &#123; num &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå¦‚ä¸Šå››ä¸ª hooks ï¼Œåˆå§‹åŒ–ï¼Œæ¯ä¸ª hooks å†…éƒ¨æ‰§è¡Œ  mountWorkInProgressHook ï¼Œç„¶åæ¯ä¸€ä¸ª hook é€šè¿‡ next å’Œä¸‹ä¸€ä¸ª hook å»ºç«‹èµ·å…³è”ï¼Œæœ€ååœ¨ fiber ä¸Šçš„ç»“æ„ä¼šå˜æˆè¿™æ ·ã€‚</p>
<p>æ•ˆæœï¼š</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261715726.jpeg" alt="hook2.jpg"></p>
<h3 id="hooksæ›´æ–°"><a href="#hooksæ›´æ–°" class="headerlink" title="hooksæ›´æ–°"></a>hooksæ›´æ–°</h3><p>æ›´æ–° hooks é€»è¾‘å’Œä¹‹å‰ fiber ç« èŠ‚ä¸­è®²çš„åŒç¼“å†²æ ‘æ›´æ–°å·®ä¸å¤šï¼Œä¼šé¦–å…ˆå–å‡º  workInProgres.alternate é‡Œé¢å¯¹åº”çš„ hook ï¼Œç„¶åæ ¹æ®ä¹‹å‰çš„ hooks å¤åˆ¶ä¸€ä»½ï¼Œå½¢æˆæ–°çš„ hooks é“¾è¡¨å…³ç³»ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­è§£é‡Šäº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯<strong>hooks è§„åˆ™ï¼Œhooks ä¸ºä»€ä¹ˆè¦é€šå¸¸æ”¾åœ¨é¡¶éƒ¨ï¼Œhooks ä¸èƒ½å†™åœ¨ if æ¡ä»¶è¯­å¥ä¸­</strong>ï¼Œå› ä¸ºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé€šè¿‡ if æ¡ä»¶è¯­å¥ï¼Œå¢åŠ æˆ–è€…åˆ é™¤ hooksï¼Œåœ¨å¤ç”¨ hooks è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå¤ç”¨ hooks çŠ¶æ€å’Œå½“å‰ hooks ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¿˜æ˜¯å°†å¦‚ä¸Šçš„ demo è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>å°†ç¬¬ä¸€ä¸ª hooks å˜æˆæ¡ä»¶åˆ¤æ–­å½¢å¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params">&#123; showNumber &#125;</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> number, setNumber</span><br><span class="line">    showNumber &amp;&amp; ([ number,setNumber ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)) <span class="comment">// ç¬¬ä¸€ä¸ªhooks</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶å€™ <code>showNumber = true</code> é‚£ä¹ˆç¬¬ä¸€ä¸ª hooks ä¼šæ¸²æŸ“ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶å€™ï¼Œçˆ¶ç»„ä»¶å°† showNumber è®¾ç½®ä¸º false ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ª hooks å°†ä¸æ‰§è¡Œï¼Œé‚£ä¹ˆæ›´æ–°é€»è¾‘ä¼šå˜æˆè¿™æ ·ã€‚</p>
<table>
<thead>
<tr>
<th>hookå¤ç”¨é¡ºåº</th>
<th>ç¼“å­˜çš„è€hooks</th>
<th>æ–°çš„hooks</th>
</tr>
</thead>
<tbody><tr>
<td>ç¬¬ä¸€æ¬¡hookå¤ç”¨</td>
<td>useState</td>
<td>useState</td>
</tr>
<tr>
<td>ç¬¬äºŒæ¬¡hookå¤ç”¨</td>
<td>useState</td>
<td>useRef</td>
</tr>
</tbody></table>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261715697.jpeg" alt="hook3.jpeg"></p>
<p>ç¬¬äºŒæ¬¡å¤ç”¨æ—¶å€™å·²ç»å‘ç° hooks ç±»å‹ä¸åŒ <code>useState !== useRef</code> ï¼Œé‚£ä¹ˆå·²ç»ç›´æ¥æŠ¥é”™äº†ã€‚æ‰€ä»¥å¼€å‘çš„æ—¶å€™ä¸€å®šæ³¨æ„ hooks é¡ºåºä¸€è‡´æ€§ã€‚</p>
<p>æŠ¥é”™å†…å®¹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261715748.jpeg" alt="hookk4.jpg"></p>
<h2 id="ä¸‰-çŠ¶æ€æ´¾å‘"><a href="#ä¸‰-çŠ¶æ€æ´¾å‘" class="headerlink" title="ä¸‰ çŠ¶æ€æ´¾å‘"></a>ä¸‰ çŠ¶æ€æ´¾å‘</h2><p>useState è§£å†³äº†å‡½æ•°ç»„ä»¶æ²¡æœ‰ state çš„é—®é¢˜ï¼Œè®©æ— çŠ¶æ€ç»„ä»¶æœ‰äº†è‡ªå·±çš„çŠ¶æ€ï¼ŒuseState åœ¨ state ç« èŠ‚å·²ç»è¯´äº†åŸºæœ¬ä½¿ç”¨ï¼Œæ¥ä¸‹æ¥é‡ç‚¹ä»‹ç»åŸç†ä½¿ç”¨ï¼Œ useState å’Œ useReducer åŸç†å¤§åŒå°å¼‚ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯è§¦å‘æ›´æ–°çš„å‡½æ•°éƒ½æ˜¯ dispatchActionã€‚</p>
<p>æ¯”å¦‚ä¸€æ®µä»£ç ä¸­è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [ number,setNumber ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)  </span><br></pre></td></tr></table></figure>
<p>setNumber æœ¬è´¨å°±æ˜¯ dispatchAction ã€‚é¦–å…ˆéœ€è¦çœ‹ä¸€ä¸‹æ‰§è¡Œ <code>useState(0)</code> æœ¬è´¨ä¸Šåšäº†äº›ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberHooks.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountState</span>(<span class="params">initialState</span>)&#123;</span><br><span class="line">     <span class="keyword">const</span> hook = <span class="title function_">mountWorkInProgressHook</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> initialState === <span class="string">&#x27;function&#x27;</span>) &#123;initialState = <span class="title function_">initialState</span>() &#125; <span class="comment">// å¦‚æœ useState ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°å¾—åˆ°åˆå§‹åŒ–state</span></span><br><span class="line">     hook.<span class="property">memoizedState</span> = hook.<span class="property">baseState</span> = initialState;</span><br><span class="line">    <span class="keyword">const</span> queue = (hook.<span class="property">queue</span> = &#123; ... &#125;); <span class="comment">// è´Ÿè´£è®°å½•æ›´æ–°çš„å„ç§çŠ¶æ€ã€‚</span></span><br><span class="line">    <span class="keyword">const</span> dispatch = (queue.<span class="property">dispatch</span> = (dispatchAction.<span class="title function_">bind</span>(  <span class="literal">null</span>,currentlyRenderingFiber,queue, ))) <span class="comment">// dispatchAction ä¸ºæ›´æ–°è°ƒåº¦çš„ä¸»è¦å‡½æ•° </span></span><br><span class="line">    <span class="keyword">return</span> [hook.<span class="property">memoizedState</span>, dispatch];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸Šé¢çš„ state ä¼šè¢«å½“å‰ hooks çš„ <code>memoizedState</code> ä¿å­˜ä¸‹æ¥ï¼Œæ¯ä¸€ä¸ª useState éƒ½ä¼šåˆ›å»ºä¸€ä¸ª <code>queue</code> é‡Œé¢ä¿å­˜äº†æ›´æ–°çš„ä¿¡æ¯ã€‚</li>
<li>æ¯ä¸€ä¸ª useState éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œæ¯”å¦‚å¦‚ä¸Šçš„ setNumber æœ¬è´¨ä¸Šå°±æ˜¯ dispatchActionï¼Œé‚£ä¹ˆå€¼å¾—æ³¨æ„ä¸€ç‚¹æ˜¯ï¼Œå½“å‰çš„ fiber è¢«  bind ç»‘å®šäº†å›ºå®šçš„å‚æ•°ä¼ å…¥ dispatchAction å’Œ queue ï¼Œæ‰€ä»¥å½“ç”¨æˆ·è§¦å‘ setNumber çš„æ—¶å€™ï¼Œèƒ½å¤Ÿç›´è§‚åæ˜ å‡ºæ¥è‡ªå“ªä¸ª fiber çš„æ›´æ–°ã€‚</li>
<li>æœ€åæŠŠ memoizedState dispatch è¿”å›ç»™å¼€å‘è€…ä½¿ç”¨ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥é‡ç‚¹ç ”ç©¶ä¸€ä¸‹ <code>dispatchAction</code> ï¼Œåº•å±‚æ˜¯æ€ä¹ˆå¤„ç†æ›´æ–°é€»è¾‘çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dispatchAction</span>(<span class="params">fiber, queue, action</span>)&#123;</span><br><span class="line">    <span class="comment">/* ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ª update */</span></span><br><span class="line">    <span class="keyword">const</span> update = &#123; ... &#125;</span><br><span class="line">    <span class="keyword">const</span> pending = queue.<span class="property">pending</span>;</span><br><span class="line">    <span class="keyword">if</span> (pending === <span class="literal">null</span>) &#123;  <span class="comment">/* ç¬¬ä¸€ä¸ªå¾…æ›´æ–°ä»»åŠ¡ */</span></span><br><span class="line">        update.<span class="property">next</span> = update;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">/* å·²ç»æœ‰å¸¦æ›´æ–°ä»»åŠ¡ */</span></span><br><span class="line">       update.<span class="property">next</span> = pending.<span class="property">next</span>;</span><br><span class="line">       pending.<span class="property">next</span> = update;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( fiber === currentlyRenderingFiber )&#123;</span><br><span class="line">        <span class="comment">/* è¯´æ˜å½“å‰fiberæ­£åœ¨å‘ç”Ÿè°ƒå’Œæ¸²æŸ“æ›´æ–°ï¼Œé‚£ä¹ˆä¸éœ€è¦æ›´æ–° */</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(fiber.<span class="property">expirationTime</span> === <span class="title class_">NoWork</span> &amp;&amp; (alternate === <span class="literal">null</span> || alternate.<span class="property">expirationTime</span> === <span class="title class_">NoWork</span>))&#123;</span><br><span class="line">            <span class="keyword">const</span> lastRenderedReducer = queue.<span class="property">lastRenderedReducer</span>;</span><br><span class="line">            <span class="keyword">const</span> currentState = queue.<span class="property">lastRenderedState</span>;                 <span class="comment">/* ä¸Šä¸€æ¬¡çš„state */</span></span><br><span class="line">            <span class="keyword">const</span> eagerState = <span class="title function_">lastRenderedReducer</span>(currentState, action); <span class="comment">/* è¿™ä¸€æ¬¡æ–°çš„state */</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">is</span>(eagerState, currentState)) &#123;                           <span class="comment">/* å¦‚æœæ¯ä¸€ä¸ªéƒ½æ”¹å˜ç›¸åŒçš„stateï¼Œé‚£ä¹ˆç»„ä»¶ä¸æ›´æ–° */</span></span><br><span class="line">               <span class="keyword">return</span> </span><br><span class="line">            &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="title function_">scheduleUpdateOnFiber</span>(fiber, expirationTime);    <span class="comment">/* å‘èµ·è°ƒåº¦æ›´æ–° */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸæ¥å½“æ¯ä¸€æ¬¡æ”¹å˜ state ï¼Œåº•å±‚ä¼šåšè¿™äº›äº‹ã€‚</p>
<ul>
<li>é¦–å…ˆç”¨æˆ·æ¯ä¸€æ¬¡è°ƒç”¨ dispatchActionï¼ˆæ¯”å¦‚å¦‚ä¸Šè§¦å‘ setNumber ï¼‰éƒ½ä¼šå…ˆåˆ›å»ºä¸€ä¸ª update ï¼Œç„¶åæŠŠå®ƒæ”¾å…¥å¾…æ›´æ–° pending é˜Ÿåˆ—ä¸­ã€‚</li>
<li>ç„¶ååˆ¤æ–­å¦‚æœå½“å‰çš„ fiber æ­£åœ¨æ›´æ–°ï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸éœ€è¦å†æ›´æ–°äº†ã€‚</li>
<li>åä¹‹ï¼Œè¯´æ˜å½“å‰ fiber æ²¡æœ‰æ›´æ–°ä»»åŠ¡ï¼Œé‚£ä¹ˆä¼šæ‹¿å‡ºä¸Šä¸€æ¬¡ state å’Œ è¿™ä¸€æ¬¡ state è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒï¼Œé‚£ä¹ˆç›´æ¥é€€å‡ºæ›´æ–°ã€‚å¦‚æœä¸ç›¸åŒï¼Œé‚£ä¹ˆå‘èµ·æ›´æ–°è°ƒåº¦ä»»åŠ¡ã€‚<strong>è¿™å°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆå‡½æ•°ç»„ä»¶ useState æ”¹å˜ç›¸åŒçš„å€¼ï¼Œç»„ä»¶ä¸æ›´æ–°äº†ã€‚</strong></li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ›´æ–°çš„ç¯èŠ‚ï¼Œä¸‹é¢æ¨¡æ‹Ÿä¸€ä¸ªæ›´æ–°åœºæ™¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>  <span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [ number , setNumber ] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">        <span class="title function_">setNumber</span>(<span class="function"><span class="params">num</span>=&gt;</span> num + <span class="number">1</span> ) <span class="comment">// num = 1</span></span><br><span class="line">        <span class="title function_">setNumber</span>(<span class="function"><span class="params">num</span>=&gt;</span> num + <span class="number">2</span> ) <span class="comment">// num = 3 </span></span><br><span class="line">        <span class="title function_">setNumber</span>(<span class="function"><span class="params">num</span>=&gt;</span> num + <span class="number">3</span> ) <span class="comment">// num = 6</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleClick() &#125; &gt;ç‚¹å‡» &#123; number &#125; <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šå½“ç‚¹å‡»ä¸€æ¬¡æŒ‰é’®ï¼Œè§¦å‘äº†ä¸‰æ¬¡ setNumberï¼Œç­‰äºè§¦å‘äº†ä¸‰æ¬¡  dispatchAction ï¼Œé‚£ä¹ˆè¿™ä¸‰æ¬¡ update ä¼šåœ¨å½“å‰ hooks çš„ pending é˜Ÿåˆ—ä¸­ï¼Œç„¶åäº‹ä»¶æ‰¹é‡æ›´æ–°çš„æ¦‚å¿µï¼Œä¼šç»Ÿä¸€åˆæˆä¸€æ¬¡æ›´æ–°ã€‚æ¥ä¸‹æ¥å°±æ˜¯ç»„ä»¶æ¸²æŸ“ï¼Œé‚£ä¹ˆå°±åˆ°äº†å†ä¸€æ¬¡æ‰§è¡Œ useStateï¼Œæ­¤æ—¶èµ°çš„æ˜¯æ›´æ–°æµç¨‹ã€‚é‚£ä¹ˆè¯•æƒ³ä¸€ä¸‹ç‚¹å‡» handleClick æœ€å state è¢«æ›´æ–°æˆ 6 ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°é€»è¾‘ä¸­  useState å†…éƒ¨è¦åšçš„äº‹ï¼Œå°±æ˜¯<strong>å¾—åˆ°æœ€æ–°çš„ state ã€‚</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateReducer</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥æŠŠå¾…æ›´æ–°çš„pendingé˜Ÿåˆ—å–å‡ºæ¥ã€‚åˆå¹¶åˆ° baseQueue</span></span><br><span class="line">    <span class="keyword">const</span> first = baseQueue.<span class="property">next</span>;</span><br><span class="line">    <span class="keyword">let</span> update = first;</span><br><span class="line">   <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">/* å¾—åˆ°æ–°çš„ state */</span></span><br><span class="line">        newState = <span class="title function_">reducer</span>(newState, action);</span><br><span class="line">    &#125; <span class="keyword">while</span> (update !== <span class="literal">null</span> &amp;&amp; update !== first);</span><br><span class="line">     hook.<span class="property">memoizedState</span> = newState;</span><br><span class="line">     <span class="keyword">return</span> [hook.<span class="property">memoizedState</span>, dispatch];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å½“å†æ¬¡æ‰§è¡ŒuseStateçš„æ—¶å€™ï¼Œä¼šè§¦å‘æ›´æ–°hooksé€»è¾‘ï¼Œæœ¬è´¨ä¸Šè°ƒç”¨çš„å°±æ˜¯ updateReducerï¼Œå¦‚ä¸Šä¼šæŠŠå¾…æ›´æ–°çš„é˜Ÿåˆ— pendingQueue æ‹¿å‡ºæ¥ï¼Œåˆå¹¶åˆ° <code>baseQueue</code>ï¼Œå¾ªç¯è¿›è¡Œæ›´æ–°ã€‚</li>
<li>å¾ªç¯æ›´æ–°çš„æµç¨‹ï¼Œè¯´ç™½äº†å°±æ˜¯æ‰§è¡Œæ¯ä¸€ä¸ª <code>num =&gt; num + 1</code> ï¼Œå¾—åˆ°æœ€æ–°çš„ state ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ä» useState ä¸­å¾—åˆ°æœ€æ–°çš„å€¼ã€‚</li>
</ul>
<p>ç”¨ä¸€å¹…å›¾æ¥æè¿°æ•´ä¸ªæµç¨‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261715768.jpeg" alt="hook5.jpg"></p>
<h2 id="å››-å¤„ç†å‰¯ä½œç”¨"><a href="#å››-å¤„ç†å‰¯ä½œç”¨" class="headerlink" title="å›› å¤„ç†å‰¯ä½œç”¨"></a>å›› å¤„ç†å‰¯ä½œç”¨</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>åœ¨ fiber ç« èŠ‚è®²äº†ï¼Œåœ¨ render é˜¶æ®µï¼Œå®é™…æ²¡æœ‰è¿›è¡ŒçœŸæ­£çš„ DOM å…ƒç´ çš„å¢åŠ ï¼Œåˆ é™¤ï¼ŒReact æŠŠæƒ³è¦åšçš„ä¸åŒæ“ä½œæ‰“æˆä¸åŒçš„ effectTag ï¼Œç­‰åˆ°commit é˜¶æ®µï¼Œç»Ÿä¸€å¤„ç†è¿™äº›å‰¯ä½œç”¨ï¼ŒåŒ…æ‹¬ DOM å…ƒç´ å¢åˆ æ”¹ï¼Œæ‰§è¡Œä¸€äº›ç”Ÿå‘½å‘¨æœŸç­‰ã€‚hooks ä¸­çš„ useEffect å’Œ useLayoutEffect ä¹Ÿæ˜¯å‰¯ä½œç”¨ï¼Œæ¥ä¸‹æ¥ä»¥ effect ä¸ºä¾‹å­ï¼Œçœ‹ä¸€ä¸‹ React æ˜¯å¦‚ä½•å¤„ç† useEffect å‰¯ä½œç”¨çš„ã€‚</p>
<p>ä¸‹é¢è¿˜æ˜¯ä»¥åˆå§‹åŒ–å’Œæ›´æ–°ä¸¤ä¸ªè§’åº¦æ¥åˆ†æã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountEffect</span>(<span class="params">create,deps</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> hook = <span class="title function_">mountWorkInProgressHook</span>();</span><br><span class="line">    <span class="keyword">const</span> nextDeps = deps === <span class="literal">undefined</span> ? <span class="literal">null</span> : deps;</span><br><span class="line">    currentlyRenderingFiber.<span class="property">effectTag</span> |= <span class="title class_">UpdateEffect</span> | <span class="title class_">PassiveEffect</span>;</span><br><span class="line">    hook.<span class="property">memoizedState</span> = <span class="title function_">pushEffect</span>( </span><br><span class="line">      <span class="title class_">HookHasEffect</span> | hookEffectTag, </span><br><span class="line">      create, <span class="comment">// useEffect ç¬¬ä¸€æ¬¡å‚æ•°ï¼Œå°±æ˜¯å‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line">      <span class="literal">undefined</span>, </span><br><span class="line">      nextDeps, <span class="comment">// useEffect ç¬¬äºŒæ¬¡å‚æ•°ï¼Œdeps    </span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>mountWorkInProgressHook äº§ç”Ÿä¸€ä¸ª hooks ï¼Œå¹¶å’Œ fiber å»ºç«‹èµ·å…³ç³»ã€‚</li>
<li>é€šè¿‡ pushEffect åˆ›å»ºä¸€ä¸ª effectï¼Œå¹¶ä¿å­˜åˆ°å½“å‰ hooks çš„ memoizedState å±æ€§ä¸‹ã€‚</li>
<li>pushEffect é™¤äº†åˆ›å»ºä¸€ä¸ª effect ï¼Œ è¿˜æœ‰ä¸€ä¸ªé‡è¦ä½œç”¨ï¼Œå°±æ˜¯å¦‚æœå­˜åœ¨å¤šä¸ª effect æˆ–è€… layoutEffect ä¼šå½¢æˆä¸€ä¸ªå‰¯ä½œç”¨é“¾è¡¨ï¼Œç»‘å®šåœ¨å‡½æ•°ç»„ä»¶ fiber çš„ updateQueue ä¸Šã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆ React ä¼šè¿™ä¹ˆè®¾è®¡å‘¢ï¼Œé¦–å…ˆå¯¹äºç±»ç»„ä»¶æœ‰componentDidMount&#x2F;componentDidUpdate å›ºå®šçš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œç”¨äºæ‰§è¡Œåˆå§‹åŒ–&#x2F;æ›´æ–°çš„å‰¯ä½œç”¨é€»è¾‘ï¼Œä½†æ˜¯å¯¹äºå‡½æ•°ç»„ä»¶ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ª  useEffect&#x2F;useLayoutEffect ï¼Œhooks æŠŠè¿™äº› effectï¼Œç‹¬ç«‹å½¢æˆé“¾è¡¨ç»“æ„ï¼Œåœ¨ commit é˜¶æ®µç»Ÿä¸€å¤„ç†å’Œæ‰§è¡Œã€‚</p>
<p>å¦‚æœåœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ä¸­è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç¬¬ä¸€ä¸ªeffect&#x27;</span>)</span><br><span class="line">&#125;,[ props.<span class="property">a</span> ])</span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">useLayoutEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç¬¬äºŒä¸ªeffect&#x27;</span>)</span><br><span class="line">&#125;,[])</span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç¬¬ä¸‰ä¸ªeffect&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;,[])</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆåœ¨ updateQueue ä¸­ï¼Œå‰¯ä½œç”¨é“¾è¡¨ä¼šå˜æˆå¦‚ä¸‹æ ·å­ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261715059.jpeg" alt="hook6.jpg"></p>
<h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><p>æ›´æ–°æµç¨‹å¯¹äº effect æ¥è¯´ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆè®¾æƒ³ä¸€ä¸‹ useEffect æ›´æ–°æµç¨‹ï¼Œæ— éåˆ¤æ–­æ˜¯å¦æ‰§è¡Œä¸‹ä¸€æ¬¡çš„ effect å‰¯ä½œç”¨å‡½æ•°ã€‚è¿˜æœ‰ä¸€äº›ç»†ææœ«èŠ‚ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateEffect</span>(<span class="params">create,deps</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> hook = <span class="title function_">updateWorkInProgressHook</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">areHookInputsEqual</span>(nextDeps, prevDeps)) &#123; <span class="comment">/* å¦‚æœdepsé¡¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ›´æ–°effect listå°±å¯ä»¥äº†ï¼Œæ— é¡»è®¾ç½® HookHasEffect */</span></span><br><span class="line">        <span class="title function_">pushEffect</span>(hookEffectTag, create, destroy, nextDeps);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">/* å¦‚æœdepsä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜ï¼Œèµ‹äºˆ effectTag ï¼Œåœ¨commitèŠ‚ç‚¹ï¼Œå°±ä¼šå†æ¬¡æ‰§è¡Œæˆ‘ä»¬çš„effect  */</span></span><br><span class="line">    currentlyRenderingFiber.<span class="property">effectTag</span> |= fiberEffectTag</span><br><span class="line">    hook.<span class="property">memoizedState</span> = <span class="title function_">pushEffect</span>(<span class="title class_">HookHasEffect</span> | hookEffectTag,create,destroy,nextDeps)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´æ–° effect çš„è¿‡ç¨‹éå¸¸ç®€å•ã€‚</p>
<ul>
<li>å°±æ˜¯åˆ¤æ–­ deps é¡¹æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ›´æ–°å‰¯ä½œç”¨é“¾è¡¨å°±å¯ä»¥äº†ï¼›å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œæ›´æ–°é“¾è¡¨åŒæ—¶ï¼Œæ‰“æ‰§è¡Œå‰¯ä½œç”¨çš„æ ‡ç­¾ï¼š<code>fiber =&gt; fiberEffectTagï¼Œhook =&gt; HookHasEffect</code>ã€‚åœ¨ commit é˜¶æ®µå°±ä¼šæ ¹æ®è¿™äº›æ ‡ç­¾ï¼Œé‡æ–°æ‰§è¡Œå‰¯ä½œç”¨ã€‚</li>
</ul>
<h3 id="ä¸åŒçš„effect"><a href="#ä¸åŒçš„effect" class="headerlink" title="ä¸åŒçš„effect"></a>ä¸åŒçš„effect</h3><p>å…³äº <code>EffectTag</code> çš„æ€è€ƒğŸ¤”ï¼š</p>
<ul>
<li><p>React ä¼šç”¨ä¸åŒçš„ EffectTag æ¥æ ‡è®°ä¸åŒçš„ effectï¼Œå¯¹äºuseEffect ä¼šæ ‡è®° UpdateEffect | PassiveEffectï¼Œ UpdateEffect æ˜¯è¯æ˜æ­¤æ¬¡æ›´æ–°éœ€è¦æ›´æ–° effect ï¼ŒHookPassive æ˜¯ useEffect çš„æ ‡è¯†ç¬¦ï¼Œå¯¹äº useLayoutEffect ç¬¬ä¸€æ¬¡æ›´æ–°ä¼šæ‰“ä¸Š  HookLayout  çš„æ ‡è¯†ç¬¦ã€‚<strong>React å°±æ˜¯åœ¨ commit é˜¶æ®µï¼Œé€šè¿‡æ ‡è¯†ç¬¦ï¼Œè¯æ˜æ˜¯ useEffect è¿˜æ˜¯ useLayoutEffect ï¼Œæ¥ä¸‹æ¥ React ä¼šåŒæ­¥å¤„ç† useLayoutEffect ï¼Œå¼‚æ­¥å¤„ç† useEffect</strong> ã€‚</p>
</li>
<li><p>å¦‚æœå‡½æ•°ç»„ä»¶éœ€è¦æ›´æ–°å‰¯ä½œç”¨ï¼Œä¼šæ ‡è®° UpdateEffectï¼Œè‡³äºå“ªä¸ªeffect éœ€è¦æ›´æ–°ï¼Œé‚£å°±çœ‹ hooks ä¸Šæœ‰æ²¡æœ‰ HookHasEffect æ ‡è®°ï¼Œæ‰€ä»¥åˆå§‹åŒ–æˆ–è€… deps ä¸æƒ³ç­‰ï¼Œå°±ä¼šç»™å½“å‰ hooks æ ‡è®°ä¸Š HookHasEffect ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œç»„ä»¶çš„å‰¯ä½œç”¨é’©å­ã€‚</p>
</li>
</ul>
<h2 id="äº”-çŠ¶æ€è·å–ä¸çŠ¶æ€ç¼“å­˜"><a href="#äº”-çŠ¶æ€è·å–ä¸çŠ¶æ€ç¼“å­˜" class="headerlink" title="äº” çŠ¶æ€è·å–ä¸çŠ¶æ€ç¼“å­˜"></a>äº” çŠ¶æ€è·å–ä¸çŠ¶æ€ç¼“å­˜</h2><h3 id="1-å¯¹äº-ref-å¤„ç†"><a href="#1-å¯¹äº-ref-å¤„ç†" class="headerlink" title="1 å¯¹äº ref å¤„ç†"></a>1 å¯¹äº ref å¤„ç†</h3><p>åœ¨ ref ç« èŠ‚è¯¦ç»†ä»‹ç»è¿‡ï¼ŒuseRef å°±æ˜¯åˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ª ref åŸå§‹å¯¹è±¡ã€‚ç”¨äºè·å–åŸç”Ÿ DOM æˆ–è€…ç»„ä»¶å®ä¾‹ï¼Œæˆ–è€…ä¿å­˜ä¸€äº›çŠ¶æ€ç­‰ã€‚</p>
<p>åˆ›å»ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountRef</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hook = <span class="title function_">mountWorkInProgressHook</span>();</span><br><span class="line">  <span class="keyword">const</span> ref = &#123;<span class="attr">current</span>: initialValue&#125;;</span><br><span class="line">  hook.<span class="property">memoizedState</span> = ref; <span class="comment">// åˆ›å»ºrefå¯¹è±¡ã€‚</span></span><br><span class="line">  <span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´æ–°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateRef</span>(<span class="params">initialValue</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> hook = <span class="title function_">updateWorkInProgressHook</span>()</span><br><span class="line">  <span class="keyword">return</span> hook.<span class="property">memoizedState</span> <span class="comment">// å–å‡ºå¤ç”¨refå¯¹è±¡ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Š ref åˆ›å»ºå’Œæ›´æ–°è¿‡ç¨‹ï¼Œå°±æ˜¯ ref å¯¹è±¡çš„åˆ›å»ºå’Œå¤ç”¨è¿‡ç¨‹ã€‚</p>
<h3 id="2-å¯¹äºuseMemoçš„å¤„ç†"><a href="#2-å¯¹äºuseMemoçš„å¤„ç†" class="headerlink" title="2 å¯¹äºuseMemoçš„å¤„ç†"></a>2 å¯¹äºuseMemoçš„å¤„ç†</h3><p>å¯¹äº useMemo ï¼Œé€»è¾‘æ¯” useRef å¤æ‚ç‚¹ï¼Œä½†æ˜¯ç›¸å¯¹äº useState å’Œ useEffect ç®€å•çš„å¤šã€‚</p>
<p>åˆ›å»ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountMemo</span>(<span class="params">nextCreate,deps</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> hook = <span class="title function_">mountWorkInProgressHook</span>();</span><br><span class="line">  <span class="keyword">const</span> nextDeps = deps === <span class="literal">undefined</span> ? <span class="literal">null</span> : deps;</span><br><span class="line">  <span class="keyword">const</span> nextValue = <span class="title function_">nextCreate</span>();</span><br><span class="line">  hook.<span class="property">memoizedState</span> = [nextValue, nextDeps];</span><br><span class="line">  <span class="keyword">return</span> nextValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>useMemo åˆå§‹åŒ–ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°å¾—åˆ°æƒ³è¦ç¼“å­˜çš„å€¼ï¼Œå°†å€¼ç¼“å­˜åˆ° hook çš„ memoizedState ä¸Šã€‚</li>
</ul>
<p>æ›´æ–°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateMemo</span>(<span class="params">nextCreate,nextDeps</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> hook = <span class="title function_">updateWorkInProgressHook</span>();</span><br><span class="line">    <span class="keyword">const</span> prevState = hook.<span class="property">memoizedState</span>; </span><br><span class="line">    <span class="keyword">const</span> prevDeps = prevState[<span class="number">1</span>]; <span class="comment">// ä¹‹å‰ä¿å­˜çš„ deps å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">areHookInputsEqual</span>(nextDeps, prevDeps)) &#123; <span class="comment">//åˆ¤æ–­ä¸¤æ¬¡ deps å€¼</span></span><br><span class="line">        <span class="keyword">return</span> prevState[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> nextValue = <span class="title function_">nextCreate</span>(); <span class="comment">// å¦‚æœdepsï¼Œå‘ç”Ÿæ”¹å˜ï¼Œé‡æ–°æ‰§è¡Œ</span></span><br><span class="line">    hook.<span class="property">memoizedState</span> = [nextValue, nextDeps];</span><br><span class="line">    <span class="keyword">return</span> nextValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>useMemo æ›´æ–°æµç¨‹å°±æ˜¯å¯¹æ¯”ä¸¤æ¬¡çš„ dep æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œç›´æ¥è¿”å›ç¼“å­˜å€¼ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œé‡æ–°ç”Ÿæˆç¼“å­˜å€¼ï¼Œç¼“å­˜ä¸‹æ¥ï¼Œä¾›å¼€å‘è€…ä½¿ç”¨ã€‚</li>
</ul>
<h2 id="å…­-æ€»ç»“"><a href="#å…­-æ€»ç»“" class="headerlink" title="å…­ æ€»ç»“"></a>å…­ æ€»ç»“</h2><p>æœ¬èŠ‚è®²äº†React hooks åŸç†ï¼Œä¹Ÿæ˜¯ React åŸç†ç¯‡æœ€åä¸€ç¯‡ï¼Œåƒé€è¿™ç¯‡ï¼Œå®Œå…¨å¯ä»¥åº”å¯¹React hookså„ç§é¢è¯•é¢˜ã€‚å¸Œæœ›ä¸€æ¬¡æ²¡æœ‰è¯»æ˜ç™½çš„åŒå­¦ï¼Œå¯ä»¥å¤šè¯»å‡ æ¬¡ï¼Œä¸ç§¯ç¡…æ­¥æ— ä»¥è‡³åƒé‡Œã€‚</p>
<p>ä¸‹ä¸€èŠ‚å¼€å§‹è¯¦ç»†ä»‹ç» React ç”Ÿæ€ã€‚</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/book/tags/React/" rel="tag">React</a></li></ul></div><div class="post-nav"><a class="pre" href="/book/2023/chapter-20-architecture-chapter-data-update-process-design/">ç¬¬20ç« â€”æ¶æ„ç¯‡-æ•°æ®æ›´æ–°æµç¨‹è®¾è®¡</a><a class="next" href="/book/2023/chapter-22-ecology-react-router/">ç¬¬22ç« â€”ç”Ÿæ€ç¯‡-React-router</a></div><script src="https://utteranc.es/client.js" repo="Flashcard8009/book" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="https://avatars.githubusercontent.com/Flashcard8009"/></a><p>To be a better man.</p><a class="info-icon" href="https://github.com/Flashcard8009" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/username" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/book/categories/%E9%BB%98%E8%AE%A4/">é»˜è®¤</a><span class="category-list-count">43</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/book/tags/React/" style="font-size: 15px;">React</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/book/2023/book__react-advanced-practice-guide/">React è¿›é˜¶å®è·µæŒ‡å—</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-04-basic-chapter-metaphysics-state/">ç¬¬04ç« â€”åŸºç¡€ç¯‡-ç„å­¦state</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-05-basic-chapter-deep-tips/">ç¬¬05ç« â€”åŸºç¡€ç¯‡-æ·±å…¥props</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-06-basic-chapter-understanding-lifecycle/">ç¬¬06ç« â€”åŸºç¡€ç¯‡-ç†è§£lifeCycle</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-07-basic-chapter-multifunctional-ref/">ç¬¬07ç« â€”åŸºç¡€ç¯‡-å¤šåŠŸèƒ½Ref</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-08-basic-chapter-provider-context/">ç¬¬08ç« â€”åŸºç¡€ç¯‡-æä¾›è€…context</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-09-fundamentals-modular-css/">ç¬¬09ç« â€”åŸºç¡€ç¯‡-æ¨¡å—åŒ–css</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-10-fundamentals-advanced-components/">ç¬¬10ç« â€”åŸºç¡€ç¯‡-é«˜é˜¶ç»„ä»¶</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-11-optimization-rendering-control/">ç¬¬11ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“æ§åˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-12-optimization-chapter-rendering-tuning/">ç¬¬12ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“è°ƒä¼˜</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="/" title="ä¸­æ–‡åšå®¢" target="_blank">ä¸­æ–‡åšå®¢</a><ul></ul><a href="/en" title="EN Blog" target="_blank">EN Blog</a><ul></ul><a href="https://github.com/Flashcard8009" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://www.baidu.com/" title="ç™¾åº¦" target="_blank">ç™¾åº¦</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2023 <a href="/book/." rel="nofollow">æ˜é‡‘å°å†Œ.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/book/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/book/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/book/css/search.css?v=1.0.0"><script type="text/javascript" src="/book/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/book/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/book/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/book/css/copycode.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/book/css/external.css?v=1.0.0"><script type="text/javascript" src="/book/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/book/js/smartresize.js?v=1.0.0"></script></div></body></html>