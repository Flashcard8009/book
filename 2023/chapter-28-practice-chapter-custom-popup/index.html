<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>第28章—实践篇-自定义弹窗 | 掘金小册</title><link rel="stylesheet" type="text/css" href="/book/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/book/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/book/favicon.ico"><link rel="apple-touch-icon" href="/book/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/book/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/book/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第28章—实践篇-自定义弹窗</h1><a id="logo" href="/book/.">掘金小册</a><p class="description">学海无涯，共同进步！</p></div><div id="nav-menu"><a class="current" href="/book/."><i class="fa fa-home"> 首页</i></a><a href="/book/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/book/about/"><i class="fa fa-user"> 关于</i></a><a href="/book/atom.xml"><i class="fa fa-rss"> 订阅</i></a><a href="/book/guestbook/"><i class="fa fa-comments"> 留言</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第28章—实践篇-自定义弹窗</h1><div class="post-meta">2023-09-26<span> | </span><span class="category"><a href="/book/categories/%E9%BB%98%E8%AE%A4/">默认</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.7k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 12</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%89%8D%E8%A8%80"><span class="toc-text">一 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-text">二 设计思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BB%BA%E7%AB%8B%E7%9B%AE%E6%A0%87"><span class="toc-text">1 建立目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-text">2 设计思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-props%E7%9A%84%E8%AE%BE%E5%AE%9A"><span class="toc-text">1 props的设定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BB%84%E4%BB%B6%E4%B9%8B%E5%A4%96%E6%B8%B2%E6%9F%93"><span class="toc-text">2 组件之外渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%B8%8D%E4%BE%9D%E8%B5%96%E7%88%B6%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E6%8C%82%E8%BD%BD-%E5%8D%B8%E8%BD%BD%E7%BB%84%E4%BB%B6"><span class="toc-text">3 不依赖父组件实现挂载&#x2F;卸载组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">三 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BB%84%E4%BB%B6%E5%B1%82%E9%9D%A2"><span class="toc-text">1 组件层面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Modal%E2%80%94%E2%80%94%E5%88%86%E9%85%8D-props-%EF%BC%8C%E6%B8%B2%E6%9F%93%E8%A7%86%E5%9B%BE"><span class="toc-text">Modal——分配 props ，渲染视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dialog%E2%80%94%E2%80%94%E6%8E%A7%E5%88%B6%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F"><span class="toc-text">Dialog——控制显示隐藏</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E6%96%B9%E6%B3%95"><span class="toc-text">2 静态属性方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E9%AA%8C%E8%AF%81%E7%8E%AF%E8%8A%82"><span class="toc-text">四 验证环节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%AC%AC%E4%B8%80%E7%A7%8D%E2%80%94%E2%80%94%E9%80%9A%E8%BF%87%E6%8C%82%E8%BD%BD%E7%BB%84%E4%BB%B6%E6%96%B9%E5%BC%8F"><span class="toc-text">验证第一种——通过挂载组件方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%AC%AC%E4%BA%8C%E7%A7%8D%E2%80%94%E2%80%94%E9%80%9A%E8%BF%87%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E6%96%B9%E5%BC%8F"><span class="toc-text">验证第二种——通过静态属性方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E6%80%BB%E7%BB%93"><span class="toc-text">五 总结</span></a></li></ol></div></div><div class="post-content"><h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一 前言"></a>一 前言</h2><p>本章节，我们一起来设计一个自定义的弹窗组件，会包含如下知识点：</p>
<ul>
<li>弹窗组件设计；</li>
<li>ReactDOM.createPortal 使用；</li>
<li>组件静态方法使用；</li>
<li>不依赖父组件实现挂载&#x2F;卸载组件。</li>
</ul>
<h2 id="二-设计思路"><a href="#二-设计思路" class="headerlink" title="二 设计思路"></a>二 设计思路</h2><h3 id="1-建立目标"><a href="#1-建立目标" class="headerlink" title="1 建立目标"></a>1 建立目标</h3><p>要实现的具体功能下：</p>
<p><strong>编写的自定义 Modal 可以通过两种方式调用：</strong></p>
<ul>
<li>第一种通过挂载组件方式，动态设置 visible 属性。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Modal</span>  title=&#123;<span class="string">&#x27;《React进阶实践指南》&#x27;</span>&#125;  visible=&#123;visible&#125;  &gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> hello,world <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Modal</span>&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>第二种通过 Modal 静态属性方法，控制 Modal 的显示&#x2F;隐藏。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="title class_">Modal</span>.<span class="title function_">show</span>(&#123; <span class="comment">/* 自定义弹窗的显示 */</span></span><br><span class="line">    <span class="attr">content</span>:<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>确定购买《React进阶指南小册》吗<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>,</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&#x27;《React进阶实践指南》&#x27;</span>,</span><br><span class="line">    <span class="attr">onOk</span>:<span class="function">()=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击确定&#x27;</span>),</span><br><span class="line">    <span class="attr">onCancel</span>:<span class="function">()=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击取消&#x27;</span>),</span><br><span class="line">    <span class="attr">onClose</span>:<span class="function">()=&gt;</span> <span class="title class_">Modal</span>.<span class="title function_">hidden</span>() <span class="comment">/* 自定义弹窗的隐藏 */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如上，Modal.show 控制自定义弹窗的显示，可以通过 Modal.hidden 控制弹窗的隐藏，业务层不需要挂载组件。</p>
<p><strong>其他要求：</strong></p>
<ul>
<li>自定义弹窗要有渐变的动画效果。</li>
</ul>
<h3 id="2-设计思路"><a href="#2-设计思路" class="headerlink" title="2 设计思路"></a>2 设计思路</h3><h4 id="1-props的设定"><a href="#1-props的设定" class="headerlink" title="1 props的设定"></a>1 props的设定</h4><p>实现的 Modal 组件需要 props 配置项如下。</p>
<table>
<thead>
<tr>
<th><code>props</code> 属性</th>
<th>属性描述</th>
<th>属性类型</th>
</tr>
</thead>
<tbody><tr>
<td>visible</td>
<td>当前 modal 是否显示</td>
<td>boolean</td>
</tr>
<tr>
<td>onOk 回调函数</td>
<td>当点击确定按钮触发</td>
<td>function</td>
</tr>
<tr>
<td>onCancel 回调函数</td>
<td>当点击取消按钮触发</td>
<td>function</td>
</tr>
<tr>
<td>closeCb 回调函数</td>
<td>当弹窗完全关闭后触发</td>
<td>function</td>
</tr>
<tr>
<td>width</td>
<td>弹窗宽度</td>
<td>number</td>
</tr>
<tr>
<td>okTest</td>
<td>确定按钮文案</td>
<td>string</td>
</tr>
<tr>
<td>cancelText</td>
<td>取消按钮文案</td>
<td>string</td>
</tr>
<tr>
<td>title</td>
<td>Modal标题</td>
<td>string</td>
</tr>
<tr>
<td>footer</td>
<td>自定义底部内容</td>
<td>React Element</td>
</tr>
<tr>
<td>children</td>
<td>Modal 内容（插槽模式）</td>
<td>React Element</td>
</tr>
<tr>
<td>content</td>
<td>Modal 内容（ props 属性模式）</td>
<td>React Element</td>
</tr>
</tbody></table>
<h4 id="2-组件之外渲染"><a href="#2-组件之外渲染" class="headerlink" title="2 组件之外渲染"></a>2 组件之外渲染</h4><p>需要把弹窗组件渲染到挂载的容器之外，这样不受到父组件的影响。这里可以通过 <code>ReactDOM.createPortal</code> API解决这个问题。</p>
<p>Portal 提供了一种将子节点渲染到存在于父组件以外的 DOM 节点的优秀的方案。createPortal 可以把当前组件或 element 元素的子节点，渲染到组件之外的其他地方。</p>
<p>createPortal 接受两个参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createPortal</span>(child, container)</span><br></pre></td></tr></table></figure>

<ul>
<li>第一个： child 是任何可渲染的 React Element元素。 </li>
<li>第二个： container 是一个 DOM 元素。</li>
</ul>
<h4 id="3-不依赖父组件实现挂载-卸载组件"><a href="#3-不依赖父组件实现挂载-卸载组件" class="headerlink" title="3 不依赖父组件实现挂载&#x2F;卸载组件"></a>3 不依赖父组件实现挂载&#x2F;卸载组件</h4><p><strong>挂载组件</strong></p>
<p>一个 React 应用，可以有多个 root Fiber， 所以可以通过 <code> ReactDOM.render</code> 来实现组件的自由挂载。</p>
<p><strong>卸载组件</strong></p>
<p>上面既然完成了挂载组件，下面需要在隐藏 Modal 的时候去卸载组件。 可以通过 <code>ReactDOM.unmountComponentAtNode</code> 来实现这个功能。</p>
<p>unmountComponentAtNode 从 DOM 中卸载组件，会将其事件处理器和 state 一并清除。 如果指定容器上没有对应已挂载的组件，这个函数什么也不会做。如果组件被移除将会返回 true ，如果没有组件可被移除将会返回 false 。</p>
<h2 id="三-代码实现"><a href="#三-代码实现" class="headerlink" title="三 代码实现"></a>三 代码实现</h2><h3 id="1-组件层面"><a href="#1-组件层面" class="headerlink" title="1 组件层面"></a>1 组件层面</h3><h4 id="Modal——分配-props-，渲染视图"><a href="#Modal——分配-props-，渲染视图" class="headerlink" title="Modal——分配 props ，渲染视图"></a>Modal——分配 props ，渲染视图</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Dialog</span> <span class="keyword">from</span> <span class="string">&#x27;./dialog&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Modal</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="comment">/* 渲染底部按钮 */</span></span><br><span class="line">    renderFooter=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; onOk , onCancel , cancelText , okText, footer  &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="comment">/* 触发 onOk / onCancel 回调  */</span></span><br><span class="line">        <span class="keyword">if</span>(footer &amp;&amp; <span class="title class_">React</span>.<span class="title function_">isValidElement</span>(footer)) <span class="keyword">return</span> footer</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;model_bottom&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;model_btn_box&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;searchbtn&quot;</span>  <span class="attr">onClick</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123; onOk &amp;&amp; onOk(e) &#125;&#125; &gt;&#123;okText || &#x27;确定&#x27;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;concellbtn&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123; onCancel &amp;&amp; onCancel(e) &#125;&#125; &gt;&#123;cancelText || &#x27;取消&#x27;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 渲染顶部 */</span></span><br><span class="line">    renderTop=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; title , onClose  &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;model_top&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;model_top_close&quot;</span>  <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> onClose &amp;&amp; onClose()&#125; &gt;x<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 渲染弹窗内容 */</span></span><br><span class="line">    renderContent=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; content , children &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">return</span>  <span class="title class_">React</span>.<span class="title function_">isValidElement</span>(content) ? content</span><br><span class="line">                : children ? children : <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; visible, width = <span class="number">500</span> ,closeCb , onClose  &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Dialog</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">closeCb</span>=<span class="string">&#123;closeCb&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClose</span>=<span class="string">&#123;onClose&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">visible</span>=<span class="string">&#123;visible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">width</span>=<span class="string">&#123;width&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               &gt;</span></span></span><br><span class="line"><span class="language-xml">           &#123;this.renderTop()&#125;</span></span><br><span class="line"><span class="language-xml">           &#123;this.renderContent()&#125;</span></span><br><span class="line"><span class="language-xml">           &#123;this.renderFooter()&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">Dialog</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设计思路：</p>
<ul>
<li>Modal 组件的设计实际很简单，就是接收上述的 props 配置，然后分配给 Top， Foot， Content 等每个部分。</li>
<li>这里通过 Dialog 组件，来实现 Modal 的动态显示&#x2F;隐藏，增加动画效果。</li>
<li>绑定确定 onOk ，取消 onCancel ，关闭 onClose 等回调函数。</li>
<li>通过 PureComponent 做性能优化。</li>
</ul>
<h4 id="Dialog——控制显示隐藏"><a href="#Dialog——控制显示隐藏" class="headerlink" title="Dialog——控制显示隐藏"></a>Dialog——控制显示隐藏</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> , &#123; useMemo , useEffect ,useState  &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/* 控制弹窗隐藏以及动画效果 */</span></span><br><span class="line"> <span class="keyword">const</span> <span class="title function_">controlShow</span> = (<span class="params">f1,f2,value,timer</span>)=&gt; &#123;</span><br><span class="line">    <span class="title function_">f1</span>(value)</span><br><span class="line">    <span class="keyword">return</span>  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">f2</span>(value)</span><br><span class="line">    &#125;,timer)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Dialog</span>(<span class="params">props</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; width , visible , closeCb , onClose  &#125; = props</span><br><span class="line">    <span class="comment">/* 控制 modelShow 动画效果 */</span></span><br><span class="line">    <span class="keyword">const</span> [ modelShow , setModelShow ] = <span class="title function_">useState</span>(visible)</span><br><span class="line">    <span class="keyword">const</span> [ modelShowAync , setModelShowAync ] = <span class="title function_">useState</span>(visible)</span><br><span class="line">    <span class="keyword">const</span> renderChildren = <span class="title function_">useMemo</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">/* 把元素渲染到组件之外的 document.body 上  */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">ReactDOM</span>.<span class="title function_">createPortal</span>(</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">display:modelShow</span> ? &#x27;<span class="attr">block</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">none</span>&#x27;  &#125;&#125; &gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;model_container&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">opacity:modelShowAync</span> ? <span class="attr">1</span> <span class="attr">:</span> <span class="attr">0</span>  &#125;&#125;  &gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;model_wrap&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span>  <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:width</span> + &#x27;<span class="attr">px</span>&#x27;&#125;&#125;  &gt;</span> &#123;props.children&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span>  <span class="attr">className</span>=<span class="string">&quot;model_container mast&quot;</span>  <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> onClose &amp;&amp; onClose()&#125; style=&#123;&#123; opacity:modelShowAync ? 0.6 : 0  &#125;&#125;  /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">          <span class="variable language_">document</span>.<span class="property">body</span></span><br><span class="line">         )</span><br><span class="line">    &#125;,[ modelShowAync, modelShow ])</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> timer</span><br><span class="line">        <span class="keyword">if</span>(visible)&#123;</span><br><span class="line">            <span class="comment">/* 打开弹窗，需要先让 */</span></span><br><span class="line">           timer = <span class="title function_">controlShow</span>(setModelShow,setModelShowAync,visible,<span class="number">30</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           timer = <span class="title function_">controlShow</span>(setModelShowAync,setModelShow,visible,<span class="number">1000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            timer &amp;&amp; <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,[ visible ])</span><br><span class="line">    <span class="comment">/* 执行关闭弹窗后的回调函数 closeCb */</span></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        !modelShow &amp;&amp; <span class="keyword">typeof</span> closeCb  === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="title function_">closeCb</span>()</span><br><span class="line">    &#125;,[ modelShow ])</span><br><span class="line">    <span class="keyword">return</span> renderChildren</span><br></pre></td></tr></table></figure>

<p>设计思路：</p>
<p>需要把元素渲染到组件之外，用 createPortal 把元素直接渲染到 <code>document.body</code> 下，为了防止函数组件每一次执行都触发 <code>createPortal</code>， 所以通过 useMemo 做性能优化。</p>
<p>因为需要渐变的动画效果，所以需要两个变量 modelShow &#x2F; modelShowAync 来控制<strong>显示&#x2F;隐藏</strong>，modelShow 让元素显示&#x2F;隐藏，modelShowAync 控制动画执行。 </p>
<ul>
<li>当弹窗要显示的时候，要先设置 modelShow 让组件显示，然后用 setTimeout 调度让 modelShowAync 触发执行动画。 </li>
<li>当弹窗要隐藏的时候，需要先让动画执行，所以先控制 modelShowAync ，然后通过控制 modelShow 元素隐藏，和上述流程相反。</li>
<li>用一个控制器 controlShow 来流畅执行更新任务。</li>
</ul>
<h3 id="2-静态属性方法"><a href="#2-静态属性方法" class="headerlink" title="2 静态属性方法"></a>2 静态属性方法</h3><p>对于通过组件的静态方法来实现弹窗的显示与隐藏，流程在上述基础上，要更复杂有一些。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">ModalContainer</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> modelSysbol = <span class="title class_">Symbol</span>(<span class="string">&#x27;$$__model__Container_hidden&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 静态属性show——控制 */</span></span><br><span class="line"><span class="title class_">Modal</span>.<span class="property">show</span> = <span class="keyword">function</span>(<span class="params">config</span>)&#123;</span><br><span class="line">    <span class="comment">/* 如果modal已经存在了，那么就不需要第二次show */</span></span><br><span class="line">   <span class="keyword">if</span>(<span class="title class_">ModalContainer</span>) <span class="keyword">return</span></span><br><span class="line">   <span class="keyword">const</span> props = &#123; ...config , <span class="attr">visible</span>: <span class="literal">true</span> &#125;</span><br><span class="line">   <span class="keyword">const</span> container = <span class="title class_">ModalContainer</span> =  <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">   <span class="comment">/* 创建一个管理者，管理moal状态 */</span></span><br><span class="line">   <span class="keyword">const</span> manager =  container[modelSysbol] = &#123;</span><br><span class="line">       <span class="attr">setShow</span>:<span class="literal">null</span>,</span><br><span class="line">       <span class="attr">mounted</span>:<span class="literal">false</span>,</span><br><span class="line">       <span class="title function_">hidden</span>(<span class="params"></span>)&#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; setShow &#125; = manager</span><br><span class="line">          setShow &amp;&amp; <span class="title function_">setShow</span>(<span class="literal">false</span>)</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="title function_">destory</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="comment">/* 卸载组件 */</span></span><br><span class="line">           <span class="title class_">ReactDOM</span>.<span class="title function_">unmountComponentAtNode</span>(container)</span><br><span class="line">          <span class="comment">/* 移除节点 */</span></span><br><span class="line">          <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(container)</span><br><span class="line">          <span class="comment">/* 置空元素 */</span></span><br><span class="line">          <span class="title class_">ModalContainer</span> = <span class="literal">null</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">const</span> <span class="title function_">ModelApp</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">       <span class="keyword">const</span> [ show , setShow ] = <span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">       manager.<span class="property">setShow</span> = setShow</span><br><span class="line">       <span class="keyword">const</span> &#123; visible,...trueProps &#125; = props</span><br><span class="line">       <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">           <span class="comment">/* 加载完成，设置状态 */</span></span><br><span class="line">           manager.<span class="property">mounted</span> = <span class="literal">true</span></span><br><span class="line">           <span class="title function_">setShow</span>(visible)</span><br><span class="line">        &#125;,[])</span><br><span class="line">       <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Modal</span>  &#123;<span class="attr">...trueProps</span>&#125; <span class="attr">closeCb</span>=<span class="string">&#123;()</span> =&gt;</span> manager.mounted &amp;&amp;  manager.destory()&#125;  visible=&#123;show&#125;  /&gt;</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* 插入到body中 */</span></span><br><span class="line">   <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container)</span><br><span class="line">   <span class="comment">/* 渲染React元素 */</span></span><br><span class="line">   <span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">ModelApp</span>  &#123;<span class="attr">...props</span>&#125;  /&gt;</span></span>,container)</span><br><span class="line">   <span class="keyword">return</span> manager</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 静态属性——hidden控制隐藏 */</span></span><br><span class="line"><span class="title class_">Modal</span>.<span class="property">hidden</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">if</span>(!<span class="title class_">ModalContainer</span>) <span class="keyword">return</span></span><br><span class="line">   <span class="comment">/* 如果存在 ModalContainer 那么隐藏 ModalContainer  */</span></span><br><span class="line">   <span class="title class_">ModalContainer</span>[modelSysbol] &amp;&amp; <span class="title class_">ModalContainer</span>[modelSysbol].<span class="title function_">hidden</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Modal</span></span><br></pre></td></tr></table></figure>
<p>接下来，描述一下流程和细节：</p>
<ul>
<li><p>第一点：因为要通过调用 Modal 的静态属性来实现组件的显示与隐藏。所以用 <code>Modal.show</code> 来控制显示，<code>Modal.hidden</code>来控制隐藏。但是两者要建立起关联，所以通过全局<code>ModalContainer</code>属性，能够隐藏掉<code>Modal.show</code> 产生的元素与组件。</p>
</li>
<li><p>第二点：如果调用 <code>Modal.show</code>，首先会创建一个元素容器 container ，用来挂载 Modal 组件，通过 ReactDOM.render 挂载，这里需要把 contianer 插入到 document.body 上。   </p>
</li>
<li><p>第三点：因为 Modal 组件要动态混入 visible 属性，并且做一些初始化的工作，比如提供隐藏弹窗的方法，所以创建一个 ModelApp 容器组件包裹 Modal。</p>
</li>
<li><p>第四点：因为要在弹窗消失的动画执行后，再统一卸载组件和元素，所以到了本模块难点，就是创建一个 modal manager 管理者，通过 <code>Symbol(&#39;$$__model__Container_hidden&#39;)</code> 把管理者和容器之间建立起关联。容器下有 hidden 只是隐藏组件，并没有销毁组件，当组件隐藏动画执行完毕，会执行 closeCb 回调函数，在回调函数中再统一卸载元素和组件。</p>
</li>
<li><p>第五点：调用<code>Modal.hidden</code> 本质上调用的是 manager 上的 hidden 方法 ，然后执行动画，执行隐藏元素。然后再触发 destory ，用 unmountComponentAtNode 和 removeChild 做一些收尾工作。完成整个流程。</p>
</li>
</ul>
<p>创建弹窗流程图：</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261725299.jpeg" alt="3.jpg"></p>
<p>关闭弹窗流程图：</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261725501.jpeg" alt="4.jpg"></p>
<h2 id="四-验证环节"><a href="#四-验证环节" class="headerlink" title="四 验证环节"></a>四 验证环节</h2><h3 id="验证第一种——通过挂载组件方式"><a href="#验证第一种——通过挂载组件方式" class="headerlink" title="验证第一种——通过挂载组件方式"></a>验证第一种——通过挂载组件方式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 挂载方式调用modal */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [ visible , setVisible ] = <span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> [ nameShow , setNameShow ] = <span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击&#x27;</span>)</span><br><span class="line">        <span class="title function_">setVisible</span>(!visible)</span><br><span class="line">        <span class="title function_">setNameShow</span>(!nameShow)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 防止 Model 的 PureComponent 失去作用 */</span></span><br><span class="line">    <span class="keyword">const</span> [ handleClose ,handleOk, handleCancel ] = <span class="title function_">useMemo</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">Ok</span> = (<span class="params"></span>) =&gt;  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击确定按钮&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">Close</span> = (<span class="params"></span>) =&gt; <span class="title function_">setVisible</span>(<span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">Cancel</span> = (<span class="params"></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击取消按钮&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> [ <span class="title class_">Close</span> , <span class="title class_">Ok</span> , <span class="title class_">Cancel</span>  ]</span><br><span class="line">    &#125;,[])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onCancel</span>=<span class="string">&#123;handleCancel&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClose</span>=<span class="string">&#123;handleClose&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onOk</span>=<span class="string">&#123;handleOk&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">title</span>=<span class="string">&#123;</span>&#x27;《<span class="attr">React进阶实践指南</span>》&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">visible</span>=<span class="string">&#123;visible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">width</span>=<span class="string">&#123;700&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;feel&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">              小册阅读感受： <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;写下你的感受&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;nameShow &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>作者： 我不是外星人<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            setVisible(!visible)</span></span><br><span class="line"><span class="language-xml">            setNameShow(false)</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt; model show <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> &gt;</span> model show ( 显示作者 ) <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如上就是挂载的方式使用 Modal，注意 Modal 用的是 PureComponent ，父组件是函数组件在给 PureComponent 绑定方法的时候 ，要用 useMemo 或 useCallback 处理。</li>
</ul>
<p>效果：</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261726017.gif" alt="1.gif"></p>
<h3 id="验证第二种——通过静态属性方式"><a href="#验证第二种——通过静态属性方式" class="headerlink" title="验证第二种——通过静态属性方式"></a>验证第二种——通过静态属性方式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span> =(<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="title class_">Modal</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">            <span class="attr">content</span>:<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>确定购买《React进阶指南小册》吗<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>,</span><br><span class="line">            <span class="attr">title</span>:<span class="string">&#x27;《React进阶实践指南》&#x27;</span>,</span><br><span class="line">            <span class="attr">onOk</span>:<span class="function">()=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击确定&#x27;</span>),</span><br><span class="line">            <span class="attr">onCancel</span>:<span class="function">()=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击取消&#x27;</span>),</span><br><span class="line">            <span class="attr">onClose</span>:<span class="function">()=&gt;</span> <span class="title class_">Modal</span>.<span class="title function_">hidden</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleClick()&#125; &gt;静态方式调用，显示modal<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这种方式用起来比上一种要简单。流程我就不细说了。</li>
</ul>
<p>效果：</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261725680.gif" alt="2.gif"></p>
<h2 id="五-总结"><a href="#五-总结" class="headerlink" title="五 总结"></a>五 总结</h2><p>本章节的知识点总结：</p>
<ul>
<li>自定义弹窗组件的编写——挂载组件&#x2F;调用静态属性两种方式。</li>
<li>ReactDOM.createPortal 使用。</li>
<li>ReactDOM.unmountComponentAtNode 和 ReactDOM.render 实现自由挂载&#x2F;卸载组件。</li>
<li>hooks 的使用与性能优化。</li>
</ul>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/book/tags/React/" rel="tag">React</a></li></ul></div><div class="post-nav"><a class="pre" href="/book/2023/chapter-27-practice-chapter-form-verification-part/">第27章—实践篇-表单验证下</a><a class="next" href="/book/2023/chapter-29-wip-practice-chapter-custom-hooks-design/">第29章—[WIP]实践篇-自定义Hooks设计</a></div><script src="https://utteranc.es/client.js" repo="Flashcard8009/book" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="https://avatars.githubusercontent.com/Flashcard8009"/></a><p>To be a better man.</p><a class="info-icon" href="https://github.com/Flashcard8009" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/username" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/book/categories/%E9%BB%98%E8%AE%A4/">默认</a><span class="category-list-count">43</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/book/tags/React/" style="font-size: 15px;">React</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/book/2023/book__react-advanced-practice-guide/">React 进阶实践指南</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-05-basic-chapter-deep-tips/">第05章—基础篇-深入props</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-04-basic-chapter-metaphysics-state/">第04章—基础篇-玄学state</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-07-basic-chapter-multifunctional-ref/">第07章—基础篇-多功能Ref</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-06-basic-chapter-understanding-lifecycle/">第06章—基础篇-理解lifeCycle</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-08-basic-chapter-provider-context/">第08章—基础篇-提供者context</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-09-fundamentals-modular-css/">第09章—基础篇-模块化css</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-10-fundamentals-advanced-components/">第10章—基础篇-高阶组件</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-12-optimization-chapter-rendering-tuning/">第12章—优化篇-渲染调优</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-11-optimization-rendering-control/">第11章—优化篇-渲染控制</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="/" title="中文博客" target="_blank">中文博客</a><ul></ul><a href="/en" title="EN Blog" target="_blank">EN Blog</a><ul></ul><a href="https://github.com/Flashcard8009" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://www.baidu.com/" title="百度" target="_blank">百度</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/book/." rel="nofollow">掘金小册.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/book/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/book/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/book/css/search.css?v=1.0.0"><script type="text/javascript" src="/book/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/book/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/book/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/book/css/copycode.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/book/css/external.css?v=1.0.0"><script type="text/javascript" src="/book/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/book/js/smartresize.js?v=1.0.0"></script></div></body></html>