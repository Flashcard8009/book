<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>ç¬¬11ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“æ§åˆ¶ | æ˜é‡‘å°å†Œ</title><link rel="stylesheet" type="text/css" href="/book/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/book/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/book/favicon.ico"><link rel="apple-touch-icon" href="/book/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/book/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/book/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ç¬¬11ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“æ§åˆ¶</h1><a id="logo" href="/book/.">æ˜é‡‘å°å†Œ</a><p class="description">å­¦æµ·æ— æ¶¯ï¼Œå…±åŒè¿›æ­¥ï¼</p></div><div id="nav-menu"><a class="current" href="/book/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/book/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/book/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/book/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a><a href="/book/guestbook/"><i class="fa fa-comments"> ç•™è¨€</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ç¬¬11ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“æ§åˆ¶</h1><div class="post-meta">2023-09-26<span> | </span><span class="category"><a href="/book/categories/%E9%BB%98%E8%AE%A4/">é»˜è®¤</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5.8k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 23</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%89%8D%E8%A8%80"><span class="toc-text">ä¸€ å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%86%8D%E8%B0%88-React-%E6%B8%B2%E6%9F%93"><span class="toc-text">äºŒ å†è°ˆ React æ¸²æŸ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#render%E9%98%B6%E6%AE%B5%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">renderé˜¶æ®µä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-React-%E5%87%A0%E7%A7%8D%E6%8E%A7%E5%88%B6-render-%E6%96%B9%E6%B3%95"><span class="toc-text">ä¸‰ React å‡ ç§æ§åˆ¶ render æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%93%E5%AD%98React-element%E5%AF%B9%E8%B1%A1"><span class="toc-text">1 ç¼“å­˜React.elementå¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-PureComponent"><span class="toc-text">2 PureComponent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-shouldComponentUpdate"><span class="toc-text">3 shouldComponentUpdate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-React-memo"><span class="toc-text">4 React.memo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%89%93%E7%A0%B4%E6%B8%B2%E6%9F%93%E9%99%90%E5%88%B6"><span class="toc-text">5 æ‰“ç ´æ¸²æŸ“é™åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B8%B2%E6%9F%93%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-text">6 æ¸²æŸ“æ§åˆ¶æµç¨‹å›¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E5%AF%B9%E4%BA%8Erender%E7%9A%84%E6%80%9D%E8%80%83"><span class="toc-text">å›› å¯¹äºrenderçš„æ€è€ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9C%89%E6%B2%A1%E6%9C%89%E5%BF%85%E8%A6%81%E5%9C%A8%E4%B9%8E%E7%BB%84%E4%BB%B6%E4%B8%8D%E5%BF%85%E8%A6%81%E6%B8%B2%E6%9F%93%E3%80%82"><span class="toc-text">1 æœ‰æ²¡æœ‰å¿…è¦åœ¨ä¹ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“ã€‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E6%B8%B2%E6%9F%93%E8%8A%82%E6%B5%81%E3%80%82"><span class="toc-text">2 ä»€ä¹ˆæ—¶å€™éœ€è¦æ³¨æ„æ¸²æŸ“èŠ‚æµã€‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%80%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98"><span class="toc-text">3 ä¸€äº›å¼€å‘ä¸­çš„ç»†èŠ‚é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E6%80%BB%E7%BB%93"><span class="toc-text">äº” æ€»ç»“</span></a></li></ol></div></div><div class="post-content"><h2 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="headerlink" title="ä¸€ å‰è¨€"></a>ä¸€ å‰è¨€</h2><p>ä»æœ¬èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬å°†å¼€å§‹æ­£å¼ä»‹ç» React ä¼˜åŒ–ç¯èŠ‚ï¼ŒReact ä¼˜åŒ–ä¼šä»<strong>æ¸²æŸ“ã€åŠ è½½ã€æµ·é‡æ•°æ®ã€ç»†èŠ‚</strong>å››ä¸ªæ–¹å‘å…¥æ‰‹ï¼Œè¯¦ç»†ä»‹ç» React ä¼˜åŒ–è¿‡ç¨‹ä¸­çš„æ–¹æ³•å’ŒæŠ€å·§ã€‚æœ¬ç« èŠ‚å°†é‡ç‚¹è°ˆè°ˆ React çš„æ¸²æŸ“ä»¥åŠä¼˜åŒ–æ‰‹æ®µã€‚</p>
<p>é€šè¿‡æœ¬ç« èŠ‚çš„å­¦ä¹ ï¼Œä½ å°†æ”¶è· React æ¸²æŸ“æ§åˆ¶çš„å¸¸è§„æ–¹æ³•ä»¥åŠåŸç†ï¼Œå¹¶ä¸”å­¦ä¼šæ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ‰‹æ®µã€‚</p>
<h2 id="äºŒ-å†è°ˆ-React-æ¸²æŸ“"><a href="#äºŒ-å†è°ˆ-React-æ¸²æŸ“" class="headerlink" title="äºŒ å†è°ˆ React æ¸²æŸ“"></a>äºŒ å†è°ˆ React æ¸²æŸ“</h2><p>å¯¹äº React æ¸²æŸ“ï¼Œä½ ä¸è¦ä»…ä»…ç†è§£æˆç±»ç»„ä»¶è§¦å‘ render å‡½æ•°ï¼Œå‡½æ•°ç»„ä»¶æœ¬èº«æ‰§è¡Œï¼Œäº‹å®ä¸Šï¼Œä»è°ƒåº¦æ›´æ–°ä»»åŠ¡åˆ°è°ƒå’Œ fiberï¼Œå†åˆ°æµè§ˆå™¨æ¸²æŸ“çœŸå® DOMï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½æ˜¯æ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼Œè‡³äºå¯¹äºæ¯ä¸ªç¯èŠ‚çš„æ€§èƒ½ä¼˜åŒ–ï¼ŒReact åœ¨åº•å±‚å·²ç»å¤„ç†äº†å¤§éƒ¨åˆ†ä¼˜åŒ–ç»†èŠ‚ï¼ŒåŒ…æ‹¬è®¾ç«‹ä»»åŠ¡ä¼˜å…ˆçº§ã€å¼‚æ­¥è°ƒåº¦ã€diffç®—æ³•ã€æ—¶é—´åˆ†ç‰‡éƒ½æ˜¯ React ä¸ºäº†æé«˜æ€§èƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒé‡‡å–çš„æ‰‹æ®µã€‚æ‰€ä»¥ï¼Œå¼€å‘è€…åªéœ€è¦å‘Šè¯‰ React å“ªäº›ç»„ä»¶éœ€è¦æ›´æ–°ï¼Œå“ªäº›ç»„ä»¶ä¸éœ€è¦æ›´æ–°ã€‚äºæ˜¯ï¼ŒReact æä¾›äº† PureComponentï¼ŒshouldComponentUpdatedï¼Œmemo ç­‰ä¼˜åŒ–æ‰‹æ®µã€‚è¿™äº›æ‰‹æ®µæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h3 id="renderé˜¶æ®µä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#renderé˜¶æ®µä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="renderé˜¶æ®µä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>renderé˜¶æ®µä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>é¦–å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œç»„ä»¶åœ¨ä¸€æ¬¡æ›´æ–°ä¸­ï¼Œç±»ç»„ä»¶æ‰§è¡Œ render ï¼Œæ‰§è¡Œå‡½æ•°ç»„ä»¶ renderWithHooks ï¼ˆ renderWithHook å†…éƒ¨æ‰§è¡Œ React å‡½æ•°ç»„ä»¶æœ¬èº«ï¼‰ï¼Œä»–ä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ä»–ä»¬çœŸå®æ¸²æŸ“äº† DOM äº†å—ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼ŒçœŸå® DOM æ˜¯åœ¨ commit é˜¶æ®µæŒ‚è½½çš„ï¼Œä¹‹å‰ç« èŠ‚æ‰“å°è¿‡ render åçš„å†…å®¹ã€‚</p>
<p>é‚£ä¹ˆ<strong>renderçš„ä½œç”¨</strong>æ˜¯æ ¹æ®ä¸€æ¬¡æ›´æ–°ä¸­äº§ç”Ÿçš„æ–°çŠ¶æ€å€¼ï¼Œé€šè¿‡ React.createElement ï¼Œæ›¿æ¢æˆæ–°çš„çŠ¶æ€ï¼Œå¾—åˆ°æ–°çš„ React element å¯¹è±¡ï¼Œæ–°çš„ element å¯¹è±¡ä¸Šï¼Œä¿å­˜äº†æœ€æ–°çŠ¶æ€å€¼ã€‚ createElement ä¼šäº§ç”Ÿä¸€ä¸ªå…¨æ–°çš„propsã€‚åˆ°æ­¤ render å‡½æ•°ä½¿å‘½å®Œæˆäº†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼ŒReact ä¼šè°ƒå’Œç”± render å‡½æ•°äº§ç”Ÿ chidlrenï¼Œå°†å­ä»£ element å˜æˆ  fiberï¼ˆè¿™ä¸ªè¿‡ç¨‹å¦‚æœå­˜åœ¨ alternateï¼Œä¼šå¤ç”¨ alternate è¿›è¡Œå…‹éš†ï¼Œå¦‚æœæ²¡æœ‰ alternate ï¼Œé‚£ä¹ˆå°†åˆ›å»ºä¸€ä¸ªï¼‰ï¼Œå°† props å˜æˆ pendingProps ï¼Œè‡³æ­¤å½“å‰ç»„ä»¶æ›´æ–°å®Œæ¯•ã€‚ç„¶åå¦‚æœ children æ˜¯ç»„ä»¶ï¼Œä¼šç»§ç»­é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ°å…¨éƒ¨ fiber è°ƒå’Œå®Œæ¯•ã€‚å®Œæˆ render é˜¶æ®µã€‚</p>
<h2 id="ä¸‰-React-å‡ ç§æ§åˆ¶-render-æ–¹æ³•"><a href="#ä¸‰-React-å‡ ç§æ§åˆ¶-render-æ–¹æ³•" class="headerlink" title="ä¸‰ React å‡ ç§æ§åˆ¶ render æ–¹æ³•"></a>ä¸‰ React å‡ ç§æ§åˆ¶ render æ–¹æ³•</h2><p>React æä¾›äº†å‡ ç§æ§åˆ¶ render çš„æ–¹å¼ã€‚æˆ‘è¿™é‡Œä¼šä»‹ç»åŸç†å’Œä½¿ç”¨ã€‚è¯´åˆ°å¯¹render çš„æ§åˆ¶ï¼Œç©¶å…¶æœ¬è´¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§å°±æ˜¯ä»çˆ¶ç»„ä»¶ç›´æ¥éš”æ–­å­ç»„ä»¶çš„æ¸²æŸ“ï¼Œç»å…¸çš„å°±æ˜¯ memoï¼Œç¼“å­˜ element å¯¹è±¡ã€‚</li>
<li>ç¬¬äºŒç§å°±æ˜¯ç»„ä»¶ä»è‡ªèº«æ¥æ§åˆ¶æ˜¯å¦ render ï¼Œæ¯”å¦‚ï¼šPureComponent ï¼ŒshouldComponentUpdate ã€‚</li>
</ul>
<h3 id="1-ç¼“å­˜React-elementå¯¹è±¡"><a href="#1-ç¼“å­˜React-elementå¯¹è±¡" class="headerlink" title="1 ç¼“å­˜React.elementå¯¹è±¡"></a>1 ç¼“å­˜React.elementå¯¹è±¡</h3><p>ç¬¬ä¸€ç§æ˜¯å¯¹ React.element å¯¹è±¡çš„ç¼“å­˜ã€‚è¿™æ˜¯ä¸€ç§çˆ¶å¯¹å­çš„æ¸²æŸ“æ§åˆ¶æ–¹æ¡ˆï¼Œæ¥æºäºä¸€ç§æƒ…å†µï¼Œçˆ¶ç»„ä»¶ render ï¼Œå­ç»„ä»¶æœ‰æ²¡æœ‰å¿…è¦è·Ÿç€çˆ¶ç»„ä»¶ä¸€èµ· render ï¼Œå¦‚æœæ²¡æœ‰å¿…è¦ï¼Œåˆ™å°±éœ€è¦é˜»æ–­æ›´æ–°æµï¼Œå¦‚ä¸‹å…ˆä¸¾ä¸¤ä¸ªå°ä¾‹å­ğŸŒ°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å­ç»„ä»¶ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Children</span> (&#123; number &#125;)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å­ç»„ä»¶æ¸²æŸ“&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>let us learn React!  &#123; number &#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* çˆ¶ç»„ä»¶ */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Index</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    state=&#123;</span><br><span class="line">        <span class="attr">numberA</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">numberB</span>:<span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Children</span> <span class="attr">number</span>=<span class="string">&#123;</span> <span class="attr">this.state.numberA</span> &#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> this.setState(&#123; numberA:this.state.numberA + 1 &#125;) &#125; &gt;æ”¹å˜numberA -&#123; this.state.numberA &#125; <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> this.setState(&#123; numberB:this.state.numberB + 1 &#125;) &#125; &gt;æ”¹å˜numberB -&#123; this.state.numberB &#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå­ç»„ä»¶ Children ï¼Œåªæœ‰ props ä¸­ numberA æ›´æ–°æ‰æ˜¯æœ‰ç”¨çš„ï¼Œ numberB æ›´æ–°å¸¦æ¥æ¸²æŸ“ï¼ŒChildren æ ¹æœ¬ä¸éœ€è¦ã€‚ä½†æ˜¯å¦‚æœä¸å¤„ç†å­ç»„ä»¶çš„è¯ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µã€‚æ— è®ºæ”¹å˜ numberA è¿˜æ˜¯æ”¹å˜ numberB ï¼Œå­ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯æƒ³è¦çš„ç»“æœã€‚</p>
<p><strong>æ•ˆæœ</strong></p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261655105.gif" alt="1.gif"></p>
<p>é‚£ä¹ˆæ€ä¹ˆæ ·ç”¨ç¼“å­˜ element æ¥é¿å… children æ²¡æœ‰å¿…è¦çš„æ›´æ–°å‘¢ï¼Ÿå°†å¦‚ä¸Šçˆ¶ç»„ä»¶åšå¦‚ä¸‹ä¿®æ”¹ã€‚ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Index</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span>=&#123;</span><br><span class="line">            <span class="attr">numberA</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">numberB</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component</span> =  <span class="language-xml"><span class="tag">&lt;<span class="name">Children</span> <span class="attr">number</span>=<span class="string">&#123;this.state.numberA&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    controllComponentRender=<span class="function">()=&gt;</span>&#123; <span class="comment">/* é€šè¿‡æ­¤å‡½æ•°åˆ¤æ–­ */</span></span><br><span class="line">        <span class="keyword">const</span> &#123; props &#125; = <span class="variable language_">this</span>.<span class="property">component</span></span><br><span class="line">        <span class="keyword">if</span>(props.<span class="property">number</span> !== <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">numberA</span> )&#123; <span class="comment">/* åªæœ‰ numberA å˜åŒ–çš„æ—¶å€™ï¼Œé‡æ–°åˆ›å»º element å¯¹è±¡  */</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">component</span> = <span class="title class_">React</span>.<span class="title function_">cloneElement</span>(<span class="variable language_">this</span>.<span class="property">component</span>,&#123; <span class="attr">number</span>:<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">numberA</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">component</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123; this.controllComponentRender()  &#125; </span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> this.setState(&#123; numberA:this.state.numberA + 1 &#125;) &#125; &gt;æ”¹å˜numberA<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> this.setState(&#123; numberB:this.state.numberB + 1 &#125;) &#125;  &gt;æ”¹å˜numberB<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆæŠŠ Children ç»„ä»¶å¯¹åº”çš„ element å¯¹è±¡ï¼ŒæŒ‚è½½åˆ°ç»„ä»¶å®ä¾‹çš„ component å±æ€§ä¸‹ã€‚</li>
<li>é€šè¿‡ controllComponentRender æ§åˆ¶æ¸²æŸ“ Children ç»„ä»¶ï¼Œå¦‚æœ numberA å˜åŒ–äº†ï¼Œè¯æ˜ Childrençš„props å˜åŒ–äº†ï¼Œé‚£ä¹ˆé€šè¿‡ cloneElement  è¿”å›æ–°çš„ element å¯¹è±¡ï¼Œå¹¶é‡æ–°èµ‹å€¼ç»™ component ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç¼“å­˜çš„ component ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261655418.gif" alt="2.gif"></p>
<p><strong>å®Œç¾è¾¾åˆ°æ•ˆæœ</strong></p>
<p>ä½†æ˜¯åœ¨è¿™é‡Œä¸æ¨èåœ¨ React ç±»ç»„ä»·ä¸­è¿™ä¹ˆå†™ï¼Œå¯¹äºåŸºç¡€ä¸å¤Ÿæ‰å®çš„åŒå­¦ï¼Œå¾ˆå®¹æ˜“å‡ºç°é”™è¯¯ã€‚æˆ‘è¿˜æ˜¯æ¨èå¤§å®¶åœ¨å‡½æ•°ç»„ä»¶é‡Œç”¨ <code>useMemo</code> è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [ numberA , setNumberA ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [ numberB , setNumberB ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123; useMemo(()=&gt; <span class="tag">&lt;<span class="name">Children</span> <span class="attr">number</span>=<span class="string">&#123;numberA&#125;</span> /&gt;</span>,[ numberA ]) &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> setNumberA(numberA + 1) &#125; &gt;æ”¹å˜numberA<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> setNumberB(numberB + 1) &#125; &gt;æ”¹å˜numberB<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”¨ React.useMemo å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œ éœ€è¦æ›´æ–°çš„å€¼ numberA æ”¾åœ¨ deps ä¸­ï¼ŒnumberA æ”¹å˜ï¼Œé‡æ–°å½¢æˆelementå¯¹è±¡ï¼Œå¦åˆ™é€šè¿‡ useMemo æ‹¿åˆ°ä¸Šæ¬¡çš„ç¼“å­˜å€¼ã€‚è¾¾åˆ°å¦‚ä¸ŠåŒæ ·æ•ˆæœã€‚æ¯”èµ·ç±»ç»„ä»¶ï¼Œæˆ‘æ›´æ¨èå‡½æ•°ç»„ä»¶ç”¨ useMemo è¿™ç§æ–¹å¼ã€‚</li>
</ul>
<p><strong>ï½œâ€”â€”â€“é—®ä¸ç­”â€”â€”â€”ï½œ</strong><br/><br>è¯¦ç»†ä»‹ç»ä¸€ä¸‹ useMemo ï¼Ÿ</p>
<p><strong>useMemo ç”¨æ³•ï¼š</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cacheSomething = <span class="title function_">useMemo</span>(create,deps)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>create</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºç¼“å­˜å€¼ï¼Œå¦‚ä¸Š demo ä¸­æŠŠ Children å¯¹åº”çš„ element å¯¹è±¡ï¼Œç¼“å­˜èµ·æ¥ã€‚</li>
<li><code>deps</code>ï¼š ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾å½“å‰ useMemo çš„ä¾èµ–é¡¹ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå¯¹æ¯” deps ä¾èµ–é¡¹é‡Œé¢çš„çŠ¶æ€ï¼Œæ˜¯å¦æœ‰æ”¹å˜ï¼Œå¦‚æœæœ‰æ”¹å˜é‡æ–°æ‰§è¡Œ create ï¼Œå¾—åˆ°æ–°çš„ç¼“å­˜å€¼ã€‚</li>
<li><code>cacheSomething</code>ï¼šè¿”å›å€¼ï¼Œæ‰§è¡Œ create çš„è¿”å›å€¼ã€‚å¦‚æœ deps ä¸­æœ‰ä¾èµ–é¡¹æ”¹å˜ï¼Œè¿”å›çš„é‡æ–°æ‰§è¡Œ create äº§ç”Ÿçš„å€¼ï¼Œå¦åˆ™å–ä¸Šä¸€æ¬¡ç¼“å­˜å€¼ã€‚</li>
</ul>
<p><strong>useMemoåŸç†ï¼š</strong></p>
<p> useMemo ä¼šè®°å½•ä¸Šä¸€æ¬¡æ‰§è¡Œ create çš„è¿”å›å€¼ï¼Œå¹¶æŠŠå®ƒç»‘å®šåœ¨å‡½æ•°ç»„ä»¶å¯¹åº”çš„ fiber å¯¹è±¡ä¸Šï¼Œåªè¦ç»„ä»¶ä¸é”€æ¯ï¼Œç¼“å­˜å€¼å°±ä¸€ç›´å­˜åœ¨ï¼Œä½†æ˜¯ deps ä¸­å¦‚æœæœ‰ä¸€é¡¹æ”¹å˜ï¼Œå°±ä¼šé‡æ–°æ‰§è¡Œ create ï¼Œè¿”å›å€¼ä½œä¸ºæ–°çš„å€¼è®°å½•åˆ° fiber å¯¹è±¡ä¸Šã€‚</p>
<p><strong>useMemoåº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¯ä»¥ç¼“å­˜ element å¯¹è±¡ï¼Œä»è€Œè¾¾åˆ°æŒ‰æ¡ä»¶æ¸²æŸ“ç»„ä»¶ï¼Œä¼˜åŒ–æ€§èƒ½çš„ä½œç”¨ã€‚</li>
<li>å¦‚æœç»„ä»¶ä¸­ä¸æœŸæœ›æ¯æ¬¡ render éƒ½é‡æ–°è®¡ç®—ä¸€äº›å€¼,å¯ä»¥åˆ©ç”¨ useMemo æŠŠå®ƒç¼“å­˜èµ·æ¥ã€‚</li>
<li>å¯ä»¥æŠŠå‡½æ•°å’Œå±æ€§ç¼“å­˜èµ·æ¥ï¼Œä½œä¸º PureComponent çš„ç»‘å®šæ–¹æ³•ï¼Œæˆ–è€…é…åˆå…¶ä»–Hooksä¸€èµ·ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>ï½œâ€”â€”â€“endâ€”â€”â€”ï½œ</strong><br/></p>
<p><strong>åŸç†æ­ç§˜</strong></p>
<p>å¦‚ä¸Šè®²äº†åˆ©ç”¨ element çš„ç¼“å­˜ï¼Œå®ç°äº†æ§åˆ¶å­ç»„ä»¶ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œç©¶å…¶åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ </p>
<p>åŸç†å…¶å®å¾ˆç®€å•ï¼Œä¸Šè¿°æ¯æ¬¡æ‰§è¡Œ render æœ¬è´¨ä¸Š createElement ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ propsï¼Œè¿™ä¸ª props å°†ä½œä¸ºå¯¹åº” fiber çš„ <code>pendingProps</code> ï¼Œåœ¨æ­¤ fiber æ›´æ–°è°ƒå’Œé˜¶æ®µï¼ŒReact ä¼šå¯¹æ¯” fiber ä¸Šè€ oldProps å’Œæ–°çš„ newProp ï¼ˆ pendingProps ï¼‰æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰å‡½æ•°ç»„ä»¶å°±ä¼šæ”¾å¼ƒå­ç»„ä»¶çš„è°ƒå’Œæ›´æ–°ï¼Œä»è€Œå­ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼›å¦‚æœä¸Šè¿°æŠŠ element å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œä¸Šé¢ props ä¹Ÿå°±å’Œ fiber ä¸Š oldProps æŒ‡å‘ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ç›¸ç­‰ï¼Œä»è€Œè·³è¿‡äº†æœ¬æ¬¡æ›´æ–°ã€‚</p>
<h3 id="2-PureComponent"><a href="#2-PureComponent" class="headerlink" title="2 PureComponent"></a>2 PureComponent</h3><p>çº¯ç»„ä»¶æ˜¯ä¸€ç§å‘è‡ªç»„ä»¶æœ¬èº«çš„æ¸²æŸ“ä¼˜åŒ–ç­–ç•¥ï¼Œå½“å¼€å‘ç±»ç»„ä»¶é€‰æ‹©äº†ç»§æ‰¿ PureComponent ï¼Œå°±æ„å‘³è¿™è¦éµå¾ªå…¶æ¸²æŸ“è§„åˆ™ã€‚è§„åˆ™å°±æ˜¯<strong>æµ…æ¯”è¾ƒ state å’Œ props æ˜¯å¦ç›¸ç­‰</strong>ã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ PureComponent çš„åŸºæœ¬ä½¿ç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* çº¯ç»„ä»¶æœ¬èº« */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Children</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    state=&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;alien&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>:<span class="number">18</span>,</span><br><span class="line">        <span class="attr">obj</span>:&#123;</span><br><span class="line">            <span class="attr">number</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    changeObjNumber=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; obj &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        obj.<span class="property">number</span>++</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; obj &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç»„ä»¶æ¸²æŸ“&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>  &gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">div</span>&gt;</span> ç»„ä»¶æœ¬èº«æ”¹å˜state <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.setState(&#123; name:&#x27;alien&#x27; &#125;) &#125; &gt;stateç›¸åŒæƒ…å†µ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.setState(&#123; age:this.state.age + 1  &#125;) &#125;&gt;stateä¸åŒæƒ…å†µ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">this.changeObjNumber</span> &#125; &gt;</span>stateä¸ºå¼•ç”¨æ•°æ®ç±»å‹æ—¶å€™<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">div</span>&gt;</span>hello,my name is alien,let us learn React!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* çˆ¶ç»„ä»¶ */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span> ()&#123;</span><br><span class="line">    <span class="keyword">const</span> [ numberA , setNumberA ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [ numberB , setNumberB ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span> çˆ¶ç»„ä»¶æ”¹å˜props <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> setNumberA(numberA + 1) &#125; &gt;æ”¹å˜numberA<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> setNumberB(numberB + 1) &#125; &gt;æ”¹å˜numberB<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Children</span> <span class="attr">number</span>=<span class="string">&#123;numberA&#125;</span>  /&gt;</span> </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœï¼š</p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261655197.gif" alt="3.gif"></p>
<ul>
<li>å¯¹äº props ï¼ŒPureComponent ä¼šæµ…æ¯”è¾ƒ props æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œå†å†³å®šæ˜¯å¦æ¸²æŸ“ç»„ä»¶ï¼Œæ‰€ä»¥åªæœ‰ç‚¹å‡» numberA æ‰ä¼šä¿ƒä½¿ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</li>
<li>å¯¹äº state ï¼Œå¦‚ä¸Šä¹Ÿä¼šæµ…æ¯”è¾ƒå¤„ç†ï¼Œå½“ä¸Šè¿°è§¦å‘ â€˜ state ç›¸åŒæƒ…å†µâ€™ æŒ‰é’®æ—¶ï¼Œç»„ä»¶æ²¡æœ‰æ¸²æŸ“ã€‚</li>
<li>æµ…æ¯”è¾ƒåªä¼šæ¯”è¾ƒåŸºç¡€æ•°æ®ç±»å‹ï¼Œå¯¹äºå¼•ç”¨ç±»å‹ï¼Œæ¯”å¦‚ demo ä¸­ state çš„ obj ï¼Œå•çº¯çš„æ”¹å˜ obj ä¸‹å±æ€§æ˜¯ä¸ä¼šä¿ƒä½¿ç»„ä»¶æ›´æ–°çš„ï¼Œå› ä¸ºæµ…æ¯”è¾ƒä¸¤æ¬¡ obj è¿˜æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œæƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå®¹æ˜“ï¼Œæµ…æ‹·è´å°±å¯ä»¥è§£å†³ï¼Œå°†å¦‚ä¸Š changeObjNumber è¿™ä¹ˆä¿®æ”¹ã€‚è¿™æ ·å°±æ˜¯é‡æ–°åˆ›å»ºäº†ä¸€ä¸ª obj ï¼Œæ‰€ä»¥æµ…æ¯”è¾ƒä¼šä¸ç›¸ç­‰ï¼Œç»„ä»¶å°±ä¼šæ›´æ–°äº†ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">changeObjNumber=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; obj &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">      obj.<span class="property">number</span>++</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">obj</span>:&#123;...obj&#125; &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>PureComponent åŸç†åŠå…¶æµ…æ¯”è¾ƒåŸåˆ™</strong></p>
<p>PureComponent å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Œé¦–å…ˆå½“é€‰æ‹©åŸºäº PureComponent ç»§æ‰¿çš„ç»„ä»¶ã€‚åŸå‹é“¾ä¸Šä¼šæœ‰ isPureReactComponent å±æ€§ã€‚ä¸€èµ·çœ‹ä¸€ä¸‹åˆ›å»º PureComponent æ—¶å€™ï¼š</p>
<blockquote>
<p>react&#x2F;src&#x2F;ReactBaseClasses.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pureComponentPrototype çº¯ç»„ä»¶æ„é€ å‡½æ•°çš„ prototype å¯¹è±¡ï¼Œç»‘å®šisPureReactComponent å±æ€§ã€‚ */</span></span><br><span class="line">pureComponentPrototype.<span class="property">isPureReactComponent</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p><code>isPureReactComponent</code> è¿™ä¸ªå±æ€§åœ¨æ›´æ–°ç»„ä»¶ <code>updateClassInstance</code> æ–¹æ³•ä¸­ä½¿ç”¨çš„ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸç« èŠ‚ä¸­å·²ç»è®²è¿‡ï¼Œç›¸ä¿¡çœ‹è¿‡çš„åŒå­¦éƒ½ä¼šæœ‰å°è±¡ï¼Œè¿™ä¸ªå‡½æ•°åœ¨æ›´æ–°ç»„ä»¶çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨è´Ÿè´£æ£€æŸ¥æ˜¯å¦æ›´æ–°çš„å‡½æ•°  <code>checkShouldComponentUpdate</code> ã€‚</p>
<blockquote>
<p>react&#x2F;react-reconciler&#x2F;ReactFiberClassComponent.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkShouldComponentUpdate</span>(<span class="params"></span>)&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">typeof</span> instance.<span class="property">shouldComponentUpdate</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> instance.<span class="title function_">shouldComponentUpdate</span>(newProps,newState,nextContext)  <span class="comment">/* shouldComponentUpdate é€»è¾‘ */</span></span><br><span class="line">     &#125; </span><br><span class="line">    <span class="keyword">if</span> (ctor.<span class="property"><span class="keyword">prototype</span></span> &amp;&amp; ctor.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">isPureReactComponent</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>  !<span class="title function_">shallowEqual</span>(oldProps, newProps) || !<span class="title function_">shallowEqual</span>(oldState, newState)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>isPureReactComponent å°±æ˜¯åˆ¤æ–­å½“å‰ç»„ä»¶æ˜¯ä¸æ˜¯çº¯ç»„ä»¶çš„ï¼Œå¦‚æœæ˜¯ PureComponent ä¼šæµ…æ¯”è¾ƒ props å’Œ state æ˜¯å¦ç›¸ç­‰ã€‚</li>
<li>è¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„çš„å°±æ˜¯ shouldComponentUpdate çš„æƒé‡ï¼Œä¼šå¤§äº PureComponentã€‚</li>
<li>shallowEqual æ˜¯å¦‚ä½•æµ…æ¯”è¾ƒçš„å‘¢ï¼Œç”±äºæˆ‘ä¸æƒ³åœ¨ç« èŠ‚ä¸­å†™è¿‡å¤šçš„æºç ï¼Œæˆ‘åœ¨è¿™é‡Œå°±ç›´æ¥æè¿°è¿‡ç¨‹äº†ã€‚</li>
</ul>
<p>shallowEqual æµ…æ¯”è¾ƒæµç¨‹ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼Œé¦–å…ˆä¼šç›´æ¥æ¯”è¾ƒæ–°è€ props æˆ–è€…æ–°è€ state æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰é‚£ä¹ˆä¸æ›´æ–°ç»„ä»¶ã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼Œåˆ¤æ–­æ–°è€ state æˆ–è€… props ï¼Œæœ‰ä¸æ˜¯å¯¹è±¡æˆ–è€…ä¸º null çš„ï¼Œé‚£ä¹ˆç›´æ¥è¿”å› false ï¼Œæ›´æ–°ç»„ä»¶ã€‚</li>
<li>ç¬¬ä¸‰æ­¥ï¼Œé€šè¿‡ Object.keys å°†æ–°è€ props æˆ–è€…æ–°è€ state çš„å±æ€§å key å˜æˆæ•°ç»„ï¼Œåˆ¤æ–­æ•°ç»„çš„é•¿åº¦æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œè¯æ˜æœ‰å±æ€§å¢åŠ æˆ–è€…å‡å°‘ï¼Œé‚£ä¹ˆæ›´æ–°ç»„ä»¶ã€‚</li>
<li>ç¬¬å››æ­¥ï¼Œéå†è€ props æˆ–è€…è€ state ï¼Œåˆ¤æ–­å¯¹åº”çš„æ–° props æˆ–æ–° state ï¼Œæœ‰æ²¡æœ‰ä¸ä¹‹å¯¹åº”å¹¶ä¸”ç›¸ç­‰çš„ï¼ˆè¿™ä¸ªç›¸ç­‰æ˜¯æµ…æ¯”è¾ƒï¼‰ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸å¯¹åº”æˆ–è€…ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆç›´æ¥è¿”å› false ï¼Œæ›´æ–°ç»„ä»¶ã€‚<br>åˆ°æ­¤ä¸ºæ­¢ï¼Œæµ…æ¯”è¾ƒæµç¨‹ç»“æŸï¼Œ PureComponent å°±æ˜¯è¿™ä¹ˆåšæ¸²æŸ“èŠ‚æµä¼˜åŒ–çš„ã€‚</li>
</ul>
<p><strong>PureComponentæ³¨æ„äº‹é¡¹</strong></p>
<p>PureComponent å¯ä»¥è®©ç»„ä»¶è‡ªå‘çš„åšä¸€å±‚æ€§èƒ½ä¸Šçš„è°ƒä¼˜ï¼Œä½†æ˜¯ï¼Œçˆ¶ç»„ä»¶ç»™æ˜¯ PureComponent çš„å­ç»„ä»¶ç»‘å®šäº‹ä»¶è¦æ ¼å¤–å°å¿ƒï¼Œé¿å…ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼š</p>
<p>1 é¿å…ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚ä¸è¦ç»™æ˜¯ PureComponent å­ç»„ä»¶ç»‘å®šç®­å¤´å‡½æ•°ï¼Œå› ä¸ºçˆ¶ç»„ä»¶æ¯ä¸€æ¬¡ render ï¼Œå¦‚æœæ˜¯ç®­å¤´å‡½æ•°ç»‘å®šçš„è¯ï¼Œéƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ç®­å¤´å‡½æ•°ï¼Œ PureComponent å¯¹æ¯”æ–°è€ props æ—¶å€™ï¼Œå› ä¸ºæ˜¯æ–°çš„å‡½æ•°ï¼Œæ‰€ä»¥ä¼šåˆ¤æ–­ä¸æƒ³ç­‰ï¼Œè€Œè®©ç»„ä»¶ç›´æ¥æ¸²æŸ“ï¼ŒPureComponent ä½œç”¨ç»ˆä¼šå¤±æ•ˆã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Index</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Father</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    render=<span class="function">()=&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Index</span> <span class="attr">callback</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;&#125;&#125;   /&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2 PureComponent çš„çˆ¶ç»„ä»¶æ˜¯å‡½æ•°ç»„ä»¶çš„æƒ…å†µï¼Œç»‘å®šå‡½æ•°è¦ç”¨ useCallback æˆ–è€… useMemo å¤„ç†ã€‚è¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå®¹æ˜“å‘ç”Ÿçš„ï¼Œå°±æ˜¯åœ¨ç”¨ class + function  ç»„ä»¶å¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œå¦‚æœçˆ¶ç»„ä»¶æ˜¯å‡½æ•°ï¼Œå­ç»„ä»¶æ˜¯ PureComponent ï¼Œé‚£ä¹ˆç»‘å®šå‡½æ•°è¦å°å¿ƒï¼Œå› ä¸ºå‡½æ•°ç»„ä»¶æ¯ä¸€æ¬¡æ‰§è¡Œï¼Œå¦‚æœä¸å¤„ç†ï¼Œè¿˜ä¼šå£°æ˜ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ‰€ä»¥ PureComponent å¯¹æ¯”åŒæ ·ä¼šå¤±æ•ˆï¼Œå¦‚ä¸‹æƒ…å†µï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Index</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> callback = <span class="keyword">function</span> <span class="title function_">handerCallback</span>(<span class="params"></span>)&#123;&#125; <span class="comment">/* æ¯ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œé‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„callbackï¼ŒPureComponentæµ…æ¯”è¾ƒä¼šè®¤ä¸ºä¸æƒ³ç­‰ï¼Œä¿ƒä½¿ç»„ä»¶æ›´æ–°  */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Index</span> <span class="attr">callback</span>=<span class="string">&#123;callback&#125;</span>  /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»¼ä¸Šå¯ä»¥ç”¨ useCallback æˆ–è€… useMemo è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒuseCallback é¦–é€‰ï¼Œè¿™ä¸ª hooks åˆè¡·å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µçš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> callback = <span class="title class_">React</span>.<span class="title function_">useCallback</span>(<span class="keyword">function</span> <span class="title function_">handerCallback</span>(<span class="params"></span>)&#123;&#125;,[])</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Index</span> <span class="attr">callback</span>=<span class="string">&#123;callback&#125;</span>  /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>useCallback æ¥å—äºŒä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯éœ€è¦ç¼“å­˜çš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºdeps, deps ä¸­ä¾èµ–é¡¹æ”¹å˜è¿”å›æ–°çš„å‡½æ•°ã€‚å¦‚ä¸Šå¤„ç†ä¹‹åï¼Œå°±èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³ PureComponent å¤±æ•ˆé—®é¢˜ã€‚ </p>
<p><strong>ï½œâ€”â€”â€“é—®ä¸ç­”â€”â€”â€”ï½œ</strong><br/></p>
<p><code>useCallback</code> å’Œ <code>useMemo</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>ç­”ï¼šuseCallback ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç¼“å­˜çš„å†…å®¹ï¼ŒuseMemo éœ€è¦æ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å€¼ä¸ºç¼“å­˜çš„å†…å®¹ï¼Œæ¯”èµ· useCallback ï¼Œ useMemo æ›´åƒæ˜¯ç¼“å­˜äº†ä¸€æ®µé€»è¾‘ï¼Œæˆ–è€…è¯´æ‰§è¡Œè¿™æ®µé€»è¾‘è·å–çš„ç»“æœã€‚é‚£ä¹ˆå¯¹äºç¼“å­˜ element ç”¨ useCallback å¯ä»¥å—ï¼Œç­”æ¡ˆæ˜¯å½“ç„¶å¯ä»¥äº†ã€‚</p>
<p><strong>ï½œâ€”â€”â€”â€”â€”â€”â€”-ï½œ</strong><br/></p>
<h3 id="3-shouldComponentUpdate"><a href="#3-shouldComponentUpdate" class="headerlink" title="3 shouldComponentUpdate"></a>3 shouldComponentUpdate</h3><p>æœ‰çš„æ—¶å€™ï¼ŒæŠŠæ§åˆ¶æ¸²æŸ“ï¼Œæ€§èƒ½è°ƒä¼˜äº¤ç»™ React ç»„ä»¶æœ¬èº«å¤„ç†æ˜¾ç„¶æ˜¯é ä¸ä½çš„ï¼ŒReact éœ€è¦æä¾›ç»™ä½¿ç”¨è€…ä¸€ç§æ›´çµæ´»é…ç½®çš„è‡ªå®šä¹‰æ¸²æŸ“æ–¹æ¡ˆï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå·±å†³å®šæ˜¯å¦æ›´æ–°å½“å‰ç»„ä»¶ï¼ŒshouldComponentUpdate å°±èƒ½è¾¾åˆ°è¿™ç§æ•ˆæœã€‚åœ¨ç”Ÿå‘½å‘¨æœŸç« èŠ‚ä»‹ç»äº† shouldComponentUpdate çš„ç”¨æ³•ï¼Œæ¥ä¸‹æ¥è¯•ä¸€ä¸‹ shouldComponentUpdate å¦‚ä½•ä½¿ç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Index</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123; <span class="comment">//å­ç»„ä»¶</span></span><br><span class="line">    state=&#123;</span><br><span class="line">        <span class="attr">stateNumA</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">stateNumB</span>:<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">shouldComponentUpdate</span>(<span class="params">newProp,newState,newContext</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(newProp.<span class="property">propsNumA</span> !== <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">propsNumA</span> || newState.<span class="property">stateNumA</span> !== <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">stateNumA</span> )&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">/* åªæœ‰å½“ props ä¸­ propsNumA å’Œ state ä¸­ stateNumA å˜åŒ–æ—¶ï¼Œæ›´æ–°ç»„ä»¶  */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç»„ä»¶æ¸²æŸ“&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; stateNumA ,stateNumB &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> this.setState(&#123; stateNumA: stateNumA + 1 &#125;) &#125; &gt;æ”¹å˜stateä¸­numA<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> this.setState(&#123; stateNumB: stateNumB + 1 &#125;) &#125; &gt;æ”¹å˜stataä¸­numB<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>hello,let us learn React!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>)&#123; <span class="comment">// çˆ¶ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">const</span> [ numberA , setNumberA ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [ numberB , setNumberB ] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> setNumberA(numberA + 1) &#125; &gt;æ”¹å˜propsä¸­numA<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span> setNumberB(numberB + 1) &#125; &gt;æ”¹å˜propsä¸­numB<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Index</span> <span class="attr">propsNumA</span>=<span class="string">&#123;numberA&#125;</span>  <span class="attr">propsNumB</span>=<span class="string">&#123;numberB&#125;</span>   /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ•ˆæœ</strong></p>
<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261656844.gif" alt="4.gif"></p>
<p>shouldComponentUpdate å¯ä»¥æ ¹æ®ä¼ å…¥çš„æ–°çš„ props å’Œ state ï¼Œæˆ–è€…  newContext æ¥ç¡®å®šæ˜¯å¦æ›´æ–°ç»„ä»¶ï¼Œå¦‚ä¸Šé¢ä¾‹å­ğŸŒ°ï¼Œåªæœ‰å½“ props ä¸­ propsNumA å±æ€§å’Œ state ä¸­ stateNumA æ”¹å˜çš„æ—¶å€™ï¼Œç»„ä»¶æ‰æ¸²æŸ“ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å¦‚æœå­ç»„ä»¶çš„ props æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ object ï¼Œè¿˜æ˜¯ä¸èƒ½ç›´è§‚æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚é‚£ä¹ˆå¦‚æœæƒ³æœ‰å¯¹æ¯”æ–°è€å±æ€§ç›¸ç­‰ï¼Œæ€ä¹ˆå¯¹æ¯”å‘¢ï¼Œè€Œä¸”å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸­æ•°æ®å¯èƒ½æ¥æºäºæœåŠ¡ç«¯äº¤äº’ï¼Œå¯¹äºå±æ€§ç»“æ„æ˜¯æœªçŸ¥çš„ã€‚</p>
<p><code>immutable.js</code> å¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼Œimmutable.js ä¸å¯å˜çš„çŠ¶æ€ï¼Œå¯¹ Immutable å¯¹è±¡çš„ä»»ä½•ä¿®æ”¹æˆ–æ·»åŠ åˆ é™¤æ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Immutable å¯¹è±¡ã€‚é‰´äºè¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥æŠŠéœ€è¦å¯¹æ¯”çš„ props æˆ–è€… state æ•°æ®å˜æˆ Immutable å¯¹è±¡ï¼Œé€šè¿‡å¯¹æ¯” Immutable æ˜¯å¦ç›¸ç­‰ï¼Œæ¥è¯æ˜çŠ¶æ€æ˜¯å¦æ”¹å˜ï¼Œä»è€Œç¡®å®šæ˜¯å¦æ›´æ–°ç»„ä»¶ã€‚</p>
<p>å¯¹äº shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸç¯‡ç« å’Œä¸Šé¢éƒ½æœ‰æåŠï¼Œå®ƒçš„æ‰§è¡Œæ˜¯åœ¨ checkShouldComponentUpdateï¼Œä¼šæ‰§è¡Œæ­¤ç”Ÿå‘½å‘¨æœŸã€‚</p>
<h3 id="4-React-memo"><a href="#4-React-memo" class="headerlink" title="4 React.memo"></a>4 React.memo</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">Component</span>,compare)</span><br></pre></td></tr></table></figure>

<p>React.memo å¯ä½œä¸ºä¸€ç§å®¹å™¨åŒ–çš„æ§åˆ¶æ¸²æŸ“æ–¹æ¡ˆï¼Œå¯ä»¥å¯¹æ¯” props å˜åŒ–ï¼Œæ¥å†³å®šæ˜¯å¦æ¸²æŸ“ç»„ä»¶ï¼Œé¦–å…ˆå…ˆæ¥çœ‹ä¸€ä¸‹ memo çš„åŸºæœ¬ç”¨æ³•ã€‚React.memo æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•° Component åŸå§‹ç»„ä»¶æœ¬èº«ï¼Œç¬¬äºŒä¸ªå‚æ•° compare æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ ¹æ®ä¸€æ¬¡æ›´æ–°ä¸­ props æ˜¯å¦ç›¸åŒå†³å®šåŸå§‹ç»„ä»¶æ˜¯å¦é‡æ–°æ¸²æŸ“ã€‚</p>
<p>memoçš„å‡ ä¸ªç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>React.memo: ç¬¬äºŒä¸ªå‚æ•° è¿”å› true ç»„ä»¶ä¸æ¸²æŸ“ ï¼Œ è¿”å› false ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚å’Œ shouldComponentUpdate ç›¸åï¼ŒshouldComponentUpdate : è¿”å› true ç»„ä»¶æ¸²æŸ“ ï¼Œ è¿”å› false ç»„ä»¶ä¸æ¸²æŸ“ã€‚</li>
<li>memo å½“äºŒä¸ªå‚æ•° compare ä¸å­˜åœ¨æ—¶ï¼Œä¼šç”¨<strong>æµ…æ¯”è¾ƒåŸåˆ™</strong>å¤„ç† props ï¼Œç›¸å½“äºä»…æ¯”è¾ƒ props ç‰ˆæœ¬çš„ pureComponent ã€‚</li>
<li>memo åŒæ ·é€‚åˆç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶ã€‚</li>
</ul>
<p>è¢« memo åŒ…è£¹çš„ç»„ä»¶ï¼Œelement ä¼šè¢«æ‰“æˆ <code>REACT_MEMO_TYPE</code> ç±»å‹çš„ element æ ‡ç­¾ï¼Œåœ¨ element å˜æˆ fiber çš„æ—¶å€™ï¼Œ fiber ä¼šè¢«æ ‡è®°æˆ MemoComponent çš„ç±»å‹ã€‚</p>
<blockquote>
<p>react&#x2F;src&#x2F;ReactMemo.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">memo</span>(<span class="params">type,compare</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> elementType = &#123;</span><br><span class="line">    <span class="attr">$$typeof</span>: <span class="variable constant_">REACT_MEMO_TYPE</span>, </span><br><span class="line">    type,  <span class="comment">// æˆ‘ä»¬çš„ç»„ä»¶</span></span><br><span class="line">    <span class="attr">compare</span>: compare === <span class="literal">undefined</span> ? <span class="literal">null</span> : compare,  <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸€ä¸ªå‡½æ•°ç”¨äºåˆ¤æ–­propï¼Œæ§åˆ¶æ›´æ–°æ–¹å‘ã€‚</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> elementType</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiber.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="attr">REACT_MEMO_TYPE</span>:</span><br><span class="line">fiberTag = <span class="title class_">MemoComponent</span>;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¯¹äº MemoComponent React å†…éƒ¨åˆæ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿé¦–å…ˆ React å¯¹ MemoComponent ç±»å‹çš„ fiber æœ‰å•ç‹¬çš„æ›´æ–°å¤„ç†é€»è¾‘ updateMemoComponent ã€‚é¦–å…ˆä¸€èµ·çœ‹ä¸€ä¸‹ä¸»è¦é€»è¾‘ï¼š</p>
<blockquote>
<p>react-reconciler&#x2F;src&#x2F;ReactFiberBeginWork.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateMemoComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (updateExpirationTime &lt; renderExpirationTime) &#123;</span><br><span class="line">         <span class="keyword">let</span> compare = <span class="title class_">Component</span>.<span class="property">compare</span>;</span><br><span class="line">         compare = compare !== <span class="literal">null</span> ? compare : shallowEqual <span class="comment">//å¦‚æœ memo æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ç”¨äºŒä¸ªå‚æ•°åˆ¤å®šï¼Œæ²¡æœ‰åˆ™æµ…æ¯”è¾ƒpropsæ˜¯å¦ç›¸ç­‰ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">compare</span>(prevProps, nextProps) &amp;&amp; current.<span class="property">ref</span> === workInProgress.<span class="property">ref</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">bailoutOnAlreadyFinishedWork</span>(current,workInProgress,renderExpirationTime); <span class="comment">//å·²ç»å®Œæˆå·¥ä½œåœæ­¢å‘ä¸‹è°ƒå’ŒèŠ‚ç‚¹ã€‚</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿”å›å°†è¦æ›´æ–°ç»„ä»¶,memoåŒ…è£…çš„ç»„ä»¶å¯¹åº”çš„fiberï¼Œç»§ç»­å‘ä¸‹è°ƒå’Œæ›´æ–°ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>memo ä¸»è¦é€»è¾‘æ˜¯</p>
<ul>
<li>é€šè¿‡ memo ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦æ‰§è¡Œæ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰é‚£ä¹ˆç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä»¥æµ…æ¯”è¾ƒ props ä¸º diff è§„åˆ™ã€‚å¦‚æœç›¸ç­‰ï¼Œå½“å‰ fiber å®Œæˆå·¥ä½œï¼Œåœæ­¢å‘ä¸‹è°ƒå’ŒèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¢«åŒ…è£¹çš„ç»„ä»¶å³å°†ä¸æ›´æ–°ã€‚</li>
<li>memo å¯ä»¥ç†è§£ä¸ºåŒ…äº†ä¸€å±‚çš„é«˜é˜¶ç»„ä»¶ï¼Œå®ƒçš„é˜»æ–­æ›´æ–°æœºåˆ¶ï¼Œæ˜¯é€šè¿‡æ§åˆ¶ä¸‹ä¸€çº§ children ï¼Œä¹Ÿå°±æ˜¯ memo åŒ…è£…çš„ç»„ä»¶ï¼Œæ˜¯å¦ç»§ç»­è°ƒå’Œæ¸²æŸ“ï¼Œæ¥è¾¾åˆ°ç›®çš„çš„ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥åšä¸€ä¸ªå°æ¡ˆä¾‹ï¼Œåˆ©ç”¨ memo åšåˆ°è‡ªå®šä¹‰ props æ¸²æŸ“ã€‚<br>è§„åˆ™ï¼š æ§åˆ¶ props ä¸­çš„ number ã€‚</p>
<ul>
<li>1 åªæœ‰ number æ›´æ”¹ï¼Œç»„ä»¶æ¸²æŸ“ã€‚</li>
<li>2 åªæœ‰ number å°äº 5 ï¼Œç»„ä»¶æ¸²æŸ“ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">TextMemo</span>(<span class="params">props</span>)&#123; <span class="regexp">/ /</span>å­ç»„ä»¶</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å­ç»„ä»¶æ¸²æŸ“&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello,world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">controlIsRender</span> = (<span class="params">pre,next</span>)=&gt;&#123;</span><br><span class="line">   <span class="keyword">return</span> ( pre.<span class="property">number</span> === next.<span class="property">number</span> ) ||  (pre.<span class="property">number</span> !== next.<span class="property">number</span> &amp;&amp; next.<span class="property">number</span> &gt; <span class="number">5</span>) <span class="comment">// numberä¸æ”¹å˜æˆ–number æ”¹å˜ä½†å€¼å¤§äº5-&gt;ä¸æ¸²æŸ“ç»„ä»¶ | å¦åˆ™æ¸²æŸ“ç»„ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewTexMemo</span> = <span class="title function_">memo</span>(<span class="title class_">TextMemo</span>,controlIsRender)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Index</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span>=&#123;</span><br><span class="line">            <span class="attr">number</span>:<span class="number">1</span>,</span><br><span class="line">            <span class="attr">num</span>:<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; num , number &#125;  = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                æ”¹å˜numï¼šå½“å‰å€¼ &#123; num &#125;  </span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span>this.setState(&#123; num:num + 1 &#125;) &#125; &gt;num++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span>this.setState(&#123; num:num - 1 &#125;) &#125; &gt;num--<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                æ”¹å˜numberï¼š å½“å‰å€¼ &#123; number &#125; </span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span>this.setState(&#123; number:number + 1 &#125;) &#125; &gt; number ++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> ()=&gt;</span>this.setState(&#123; number:number - 1 &#125;) &#125; &gt; number -- <span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">NewTexMemo</span> <span class="attr">num</span>=<span class="string">&#123;</span> <span class="attr">num</span> &#125; <span class="attr">number</span>=<span class="string">&#123;number&#125;</span>  /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261655671.gif" alt="memo.gif"></p>
<p><strong>å®Œç¾è¾¾åˆ°æ•ˆæœ</strong></p>
<p>memo æ³¨æ„äº‹é¡¹ï¼Œåƒå¦‚ä¸‹è¿™æ ·ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦è¯•å›¾ç»„ä»¶é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ç›´æ¥è¿”å› true æ¥é˜»æ–­æ¸²æŸ“ã€‚è¿™æ ·å¯èƒ½ä¼šé€ æˆå¾ˆå¤šéº»çƒ¦ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°½é‡ä¸è¦è¿™ä¹ˆå°è¯•</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewIndex</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">Index</span>,<span class="function">() =&gt;</span> <span class="literal">true</span> )</span><br></pre></td></tr></table></figure>

<h3 id="5-æ‰“ç ´æ¸²æŸ“é™åˆ¶"><a href="#5-æ‰“ç ´æ¸²æŸ“é™åˆ¶" class="headerlink" title="5 æ‰“ç ´æ¸²æŸ“é™åˆ¶"></a>5 æ‰“ç ´æ¸²æŸ“é™åˆ¶</h3><ul>
<li><p>1 forceUpdateã€‚ç±»ç»„ä»¶æ›´æ–°å¦‚æœè°ƒç”¨çš„æ˜¯ forceUpdate è€Œä¸æ˜¯  setState ï¼Œä¼šè·³è¿‡ PureComponent çš„æµ…æ¯”è¾ƒå’Œ shouldComponentUpdate è‡ªå®šä¹‰æ¯”è¾ƒã€‚å…¶åŸç†æ˜¯ç»„ä»¶ä¸­è°ƒç”¨ forceUpdate æ—¶å€™ï¼Œå…¨å±€ä¼šå¼€å¯ä¸€ä¸ª hasForceUpdate çš„å¼€å…³ã€‚å½“ç»„ä»¶æ›´æ–°çš„æ—¶å€™ï¼Œæ£€æŸ¥è¿™ä¸ªå¼€å…³æ˜¯å¦æ‰“å¼€ï¼Œå¦‚æœæ‰“å¼€ï¼Œå°±ç›´æ¥è·³è¿‡ shouldUpdate ã€‚</p>
</li>
<li><p>2 contextç©¿é€ï¼Œä¸Šè¿°çš„å‡ ç§æ–¹å¼ï¼Œéƒ½ä¸èƒ½æœ¬è´¨ä¸Šé˜»æ–­ context æ”¹å˜ï¼Œè€Œå¸¦æ¥çš„æ¸²æŸ“ç©¿é€ï¼Œæ‰€ä»¥å¼€å‘è€…åœ¨ä½¿ç”¨ Context è¦æ ¼å¤–å°å¿ƒï¼Œæ—¢ç„¶é€‰æ‹©äº†æ¶ˆè´¹ context ï¼Œå°±è¦æ‰¿æ‹… context æ”¹å˜ï¼Œå¸¦æ¥çš„æ›´æ–°ä½œç”¨ã€‚</p>
</li>
</ul>
<h3 id="6-æ¸²æŸ“æ§åˆ¶æµç¨‹å›¾"><a href="#6-æ¸²æŸ“æ§åˆ¶æµç¨‹å›¾" class="headerlink" title="6 æ¸²æŸ“æ§åˆ¶æµç¨‹å›¾"></a>6 æ¸²æŸ“æ§åˆ¶æµç¨‹å›¾</h3><p><img src="https://raw.githubusercontent.com/Flashcard8009/image/main/img/202309261655029.jpeg" alt="5.jpg"></p>
<h2 id="å››-å¯¹äºrenderçš„æ€è€ƒ"><a href="#å››-å¯¹äºrenderçš„æ€è€ƒ" class="headerlink" title="å›› å¯¹äºrenderçš„æ€è€ƒ"></a>å›› å¯¹äºrenderçš„æ€è€ƒ</h2><h3 id="1-æœ‰æ²¡æœ‰å¿…è¦åœ¨ä¹ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“ã€‚"><a href="#1-æœ‰æ²¡æœ‰å¿…è¦åœ¨ä¹ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“ã€‚" class="headerlink" title="1 æœ‰æ²¡æœ‰å¿…è¦åœ¨ä¹ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“ã€‚"></a>1 æœ‰æ²¡æœ‰å¿…è¦åœ¨ä¹ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“ã€‚</h3><p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ— é¡»è¿‡åˆ†åœ¨ä¹ React æ²¡æœ‰å¿…è¦çš„æ¸²æŸ“ï¼Œè¦ç†è§£æ‰§è¡Œ render ä¸ç­‰äºçœŸæ­£çš„æµè§ˆå™¨æ¸²æŸ“è§†å›¾ï¼Œrender é˜¶æ®µæ‰§è¡Œæ˜¯åœ¨ js å½“ä¸­ï¼Œjs ä¸­è¿è¡Œä»£ç è¿œå¿«äºæµè§ˆå™¨çš„ Rendering å’Œ Painting çš„ï¼Œæ›´ä½•å†µ React è¿˜æä¾›äº† diff ç®—æ³•ç­‰æ‰‹æ®µï¼Œå»å¤ç”¨çœŸå® DOM ã€‚</p>
<h3 id="2-ä»€ä¹ˆæ—¶å€™éœ€è¦æ³¨æ„æ¸²æŸ“èŠ‚æµã€‚"><a href="#2-ä»€ä¹ˆæ—¶å€™éœ€è¦æ³¨æ„æ¸²æŸ“èŠ‚æµã€‚" class="headerlink" title="2 ä»€ä¹ˆæ—¶å€™éœ€è¦æ³¨æ„æ¸²æŸ“èŠ‚æµã€‚"></a>2 ä»€ä¹ˆæ—¶å€™éœ€è¦æ³¨æ„æ¸²æŸ“èŠ‚æµã€‚</h3><p>ä½†æ˜¯å¯¹äºä»¥ä¸‹æƒ…å†µï¼Œå€¼å¾—å¼€å‘è€…æ³¨æ„ï¼Œéœ€è¦é‡‡ç”¨æ¸²æŸ“èŠ‚æµï¼š</p>
<ul>
<li><p>ç¬¬ä¸€ç§æƒ…å†µæ•°æ®å¯è§†åŒ–çš„æ¨¡å—ç»„ä»¶ï¼ˆå±•ç¤ºäº†å¤§é‡çš„æ•°æ®ï¼‰ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒå°å¿ƒå› ä¸ºä¸€æ¬¡æ›´æ–°ï¼Œå¯èƒ½ä¼´éšå¤§é‡çš„ diff ï¼Œæ•°æ®é‡è¶Šå¤§ä¹Ÿå°±è¶Šæµªè´¹æ€§èƒ½ï¼Œæ‰€ä»¥å¯¹äºæ•°æ®å±•ç¤ºæ¨¡å—ç»„ä»¶ï¼Œæœ‰å¿…è¦é‡‡å– memo ï¼Œ shouldComponentUpdate ç­‰æ–¹æ¡ˆæ§åˆ¶è‡ªèº«ç»„ä»¶æ¸²æŸ“ã€‚</p>
</li>
<li><p>ç¬¬äºŒç§æƒ…å†µå«æœ‰å¤§é‡è¡¨å•çš„é¡µé¢ï¼ŒReact ä¸€èˆ¬ä¼šé‡‡ç”¨å—æ§ç»„ä»¶çš„æ¨¡å¼å»ç®¡ç†è¡¨å•æ•°æ®å±‚ï¼Œè¡¨å•æ•°æ®å±‚å®Œå…¨æ‰˜ç®¡äº props æˆ–æ˜¯ state ï¼Œè€Œç”¨æˆ·æ“ä½œè¡¨å•å¾€å¾€æ˜¯é¢‘ç¹çš„ï¼Œéœ€è¦é¢‘ç¹æ”¹å˜æ•°æ®å±‚ï¼Œæ‰€ä»¥å¾ˆæœ‰å¯èƒ½è®©æ•´ä¸ªé¡µé¢ç»„ä»¶é«˜é¢‘ç‡ render ã€‚</p>
</li>
<li><p>ç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯è¶Šæ˜¯é è¿‘ app root æ ¹ç»„ä»¶è¶Šå€¼å¾—æ³¨æ„ï¼Œæ ¹ç»„ä»¶æ¸²æŸ“ä¼šæ³¢åŠåˆ°æ•´ä¸ªç»„ä»¶æ ‘é‡æ–° render ï¼Œå­ç»„ä»¶ render ï¼Œä¸€æ˜¯æµªè´¹æ€§èƒ½ï¼ŒäºŒæ˜¯å¯èƒ½æ‰§è¡Œ useEffect ï¼ŒcomponentWillReceiveProps ç­‰é’©å­ï¼Œé€ æˆæ„æƒ³ä¸åˆ°çš„æƒ…å†µå‘ç”Ÿã€‚</p>
</li>
</ul>
<h3 id="3-ä¸€äº›å¼€å‘ä¸­çš„ç»†èŠ‚é—®é¢˜"><a href="#3-ä¸€äº›å¼€å‘ä¸­çš„ç»†èŠ‚é—®é¢˜" class="headerlink" title="3 ä¸€äº›å¼€å‘ä¸­çš„ç»†èŠ‚é—®é¢˜"></a>3 ä¸€äº›å¼€å‘ä¸­çš„ç»†èŠ‚é—®é¢˜</h3><ul>
<li>å¼€å‘è¿‡ç¨‹ä¸­å¯¹äºå¤§é‡æ•°æ®å±•ç¤ºçš„æ¨¡å—ï¼Œå¼€å‘è€…æœ‰å¿…è¦ç”¨ shouldComponentUpdate ï¼ŒPureComponentæ¥ä¼˜åŒ–æ€§èƒ½ã€‚</li>
<li>å¯¹äºè¡¨å•æ§ä»¶ï¼Œæœ€å¥½åŠæ³•å•ç‹¬æŠ½ç¦»ç»„ä»¶ï¼Œç‹¬è‡ªç®¡ç†è‡ªå·±çš„æ•°æ®å±‚ï¼Œè¿™æ ·å¯ä»¥è®© state æ”¹å˜ï¼Œæ³¢åŠçš„èŒƒå›´æ›´å°ã€‚</li>
<li>å¦‚æœéœ€è¦æ›´ç²¾è‡´åŒ–æ¸²æŸ“ï¼Œå¯ä»¥é…åˆ immutable.js ã€‚</li>
<li>ç»„ä»¶é¢—ç²’åŒ–ï¼Œé…åˆ memo ç­‰ api ï¼Œå¯ä»¥åˆ¶å®šç§æœ‰åŒ–çš„æ¸²æŸ“ç©ºé—´ã€‚</li>
</ul>
<h2 id="äº”-æ€»ç»“"><a href="#äº”-æ€»ç»“" class="headerlink" title="äº” æ€»ç»“"></a>äº” æ€»ç»“</h2><p>æœ¬èŠ‚ä¸»è¦è®²äº†ï¼š</p>
<ol>
<li>è¯¦ç»†ä»‹ç»Reactçš„å‡ ç§æ§åˆ¶æ¸²æŸ“ï¼Œä¼˜åŒ–æ¸²æŸ“çš„æ‰‹æ®µåŠå…¶åŸç†ã€‚</li>
<li>å…³äºReactä»€ä¹ˆæƒ…å†µä¸‹é€‚åˆåšæ¸²æŸ“ä¼˜åŒ–ã€‚åŠå…¶å¼€å‘è¿‡ç¨‹ä¸­ä¸€äº›ç»†èŠ‚é—®é¢˜ã€‚</li>
</ol>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/book/tags/React/" rel="tag">React</a></li></ul></div><div class="post-nav"><a class="pre" href="/book/2023/chapter-10-fundamentals-advanced-components/">ç¬¬10ç« â€”åŸºç¡€ç¯‡-é«˜é˜¶ç»„ä»¶</a><a class="next" href="/book/2023/chapter-12-optimization-chapter-rendering-tuning/">ç¬¬12ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“è°ƒä¼˜</a></div><script src="https://utteranc.es/client.js" repo="Flashcard8009/book" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="https://avatars.githubusercontent.com/Flashcard8009"/></a><p>To be a better man.</p><a class="info-icon" href="https://github.com/Flashcard8009" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/username" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/book/categories/%E9%BB%98%E8%AE%A4/">é»˜è®¤</a><span class="category-list-count">43</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/book/tags/React/" style="font-size: 15px;">React</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/book/2023/book__react-advanced-practice-guide/">React è¿›é˜¶å®è·µæŒ‡å—</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-04-basic-chapter-metaphysics-state/">ç¬¬04ç« â€”åŸºç¡€ç¯‡-ç„å­¦state</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-05-basic-chapter-deep-tips/">ç¬¬05ç« â€”åŸºç¡€ç¯‡-æ·±å…¥props</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-06-basic-chapter-understanding-lifecycle/">ç¬¬06ç« â€”åŸºç¡€ç¯‡-ç†è§£lifeCycle</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-07-basic-chapter-multifunctional-ref/">ç¬¬07ç« â€”åŸºç¡€ç¯‡-å¤šåŠŸèƒ½Ref</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-08-basic-chapter-provider-context/">ç¬¬08ç« â€”åŸºç¡€ç¯‡-æä¾›è€…context</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-09-fundamentals-modular-css/">ç¬¬09ç« â€”åŸºç¡€ç¯‡-æ¨¡å—åŒ–css</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-10-fundamentals-advanced-components/">ç¬¬10ç« â€”åŸºç¡€ç¯‡-é«˜é˜¶ç»„ä»¶</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-11-optimization-rendering-control/">ç¬¬11ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“æ§åˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/book/2023/chapter-12-optimization-chapter-rendering-tuning/">ç¬¬12ç« â€”ä¼˜åŒ–ç¯‡-æ¸²æŸ“è°ƒä¼˜</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="/" title="ä¸­æ–‡åšå®¢" target="_blank">ä¸­æ–‡åšå®¢</a><ul></ul><a href="/en" title="EN Blog" target="_blank">EN Blog</a><ul></ul><a href="https://github.com/Flashcard8009" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://www.baidu.com/" title="ç™¾åº¦" target="_blank">ç™¾åº¦</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2023 <a href="/book/." rel="nofollow">æ˜é‡‘å°å†Œ.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/book/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/book/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/book/css/search.css?v=1.0.0"><script type="text/javascript" src="/book/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/book/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/book/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/book/css/copycode.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/book/css/external.css?v=1.0.0"><script type="text/javascript" src="/book/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/book/js/smartresize.js?v=1.0.0"></script></div></body></html>